(()=>{"use strict";function wn(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,i)}function ot(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(l){wn(s,r,i,o,a,"next",l)}function a(l){wn(s,r,i,o,a,"throw",l)}o(void 0)})}}const U=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,z=Object.keys,X=Array.isArray;function ee(e,t){return"object"!=typeof t||z(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise<"u"&&!U.Promise&&(U.Promise=Promise);const He=Object.getPrototypeOf,dr={}.hasOwnProperty;function ie(e,t){return dr.call(e,t)}function Te(e,t){"function"==typeof t&&(t=t(He(e))),(typeof Reflect>"u"?z:Reflect.ownKeys)(t).forEach(n=>{ce(e,n,t[n])})}const _n=Object.defineProperty;function ce(e,t,n,r){_n(e,t,ee(n&&ie(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function De(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ce(e.prototype,"constructor",e),{extend:Te.bind(null,e.prototype)}}}}const mr=Object.getOwnPropertyDescriptor;function Tt(e,t){let r;return mr(e,t)||(r=He(e))&&Tt(r,t)}const pr=[].slice;function at(e,t,n){return pr.call(e,t,n)}function En(e,t){return t(e)}function je(e){if(!e)throw new Error("Assertion Failed")}function Sn(e){U.setImmediate?setImmediate(e):setTimeout(e,0)}function xn(e,t){return e.reduce((n,r,i)=>{var s=t(r,i);return s&&(n[s[0]]=s[1]),n},{})}function ue(e,t){if(ie(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var s=ue(e,t[r]);n.push(s)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:ue(a,t.substr(o+1))}}function se(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){je("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)se(e,t[r],n[r])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),a=t.substr(s+1);if(""===a)void 0===n?X(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var l=e[o];l||(l=e[o]={}),se(l,a,n)}}else void 0===n?X(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Cn(e){var t={};for(var n in e)ie(e,n)&&(t[n]=e[n]);return t}const vr=[].concat;function An(e){return vr.apply([],e)}const In="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(An([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>U[e]),br=In.map(e=>U[e]);xn(In,e=>[e,!0]);let ye=null;function qe(e){ye=typeof WeakMap<"u"&&new WeakMap;const t=Dt(e);return ye=null,t}function Dt(e){if(!e||"object"!=typeof e)return e;let t=ye&&ye.get(e);if(t)return t;if(X(e)){t=[],ye&&ye.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Dt(e[n]))}else if(br.indexOf(e.constructor)>=0)t=e;else{const s=He(e);for(var i in t=s===Object.prototype?{}:Object.create(s),ye&&ye.set(e,t),e)ie(e,i)&&(t[i]=Dt(e[i]))}return t}const{toString:wr}={};function Pt(e){return wr.call(e).slice(8,-1)}const Mt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",_r="symbol"==typeof Mt?function(e){var t;return null!=e&&(t=e[Mt])&&t.apply(e)}:function(){return null},Pe={};function he(e){var t,n,r,i;if(1===arguments.length){if(X(e))return e.slice();if(this===Pe&&"string"==typeof e)return[e];if(i=_r(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const Nt=typeof Symbol<"u"?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var ae=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function kn(e,t){ae=e,Rn=t}var Rn=()=>!0;const Er=!new Error("").stack;function Ee(){if(Er)try{throw new Error}catch(e){return e}return new Error}function Kt(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(Rn).map(r=>"\n"+r).join("")):""}var On=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Bt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(On),xr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Me(e,t){this._e=Ee(),this.name=e,this.message=t}function Tn(e,t){return e+". Errors: "+Object.keys(t).map(n=>t[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join("\n")}function lt(e,t,n,r){this._e=Ee(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Tn(e,t)}function Ue(e,t){this._e=Ee(),this.name="BulkError",this.failures=Object.keys(t).map(n=>t[n]),this.failuresByPos=t,this.message=Tn(e,t)}De(Me).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Kt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),De(lt).from(Me),De(Ue).from(Me);var Cr=Bt.reduce((e,t)=>(e[t]=t+"Error",e),{});const Ar=Me;var K=Bt.reduce((e,t)=>{var n=t+"Error";function r(i,s){this._e=Ee(),this.name=n,i?"string"==typeof i?(this.message=`${i}${s?"\n "+s:""}`,this.inner=s||null):"object"==typeof i&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=xr[t]||n,this.inner=null)}return De(r).from(Ar),e[t]=r,e},{});K.Syntax=SyntaxError,K.Type=TypeError,K.Range=RangeError;var Dn=On.reduce((e,t)=>(e[t+"Error"]=K[t],e),{}),ct=Bt.reduce((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=K[t]),e),{});function q(){}function Ge(e){return e}function kr(e,t){return null==e||e===Ge?t:function(n){return t(e(n))}}function Se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Rr(e,t){return e===q?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Se(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Se(i,this.onerror):i),void 0!==s?s:n}}function Or(e,t){return e===q?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Se(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Se(r,this.onerror):r)}}function Tr(e,t){return e===q?t:function(n){var r=e.apply(this,arguments);ee(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Se(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Se(s,this.onerror):s),void 0===r?void 0===o?void 0:o:ee(r,o)}}function Dr(e,t){return e===q?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Lt(e,t){return e===q?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return t.apply(r,s)})}return t.apply(this,arguments)}}ct.ModifyError=lt,ct.DexieError=Me,ct.BulkError=Ue;var Ye={};const[Wt,ut,Ft]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,He(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,He(t),e]})(),Mn=ut&&ut.then,ht=Wt&&Wt.constructor,Vt=!!Ft;var Ht=!1,Nr=Ft?()=>{Ft.then(pt)}:U.setImmediate?setImmediate.bind(null,pt):U.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{pt(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(pt,0)},ze=function(e,t){$e.push([e,t]),ft&&(Nr(),ft=!1)},jt=!0,ft=!0,xe=[],dt=[],qt=null,Ut=Ge,Ne={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:qn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{qn(e[0],e[1])}catch{}})}},M=Ne,$e=[],Ce=0,mt=[];function T(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=q,this._lib=!1;var t=this._PSD=M;if(ae&&(this._stackHolder=Ee(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Ye)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Yt(this,this._value))}this._state=null,this._value=null,++t.ref,Kn(this,e)}const Gt={get:function(){var e=M,t=vt;function n(r,i){var s=!e.global&&(e!==M||t!==vt);const o=s&&!fe();var a=new T((l,c)=>{zt(this,new Nn(wt(r,e,s,o),wt(i,e,s,o),l,c,e))});return ae&&Wn(a,this),a}return n.prototype=Ye,n},set:function(e){ce(this,"then",e&&e.prototype===Ye?Gt:{get:function(){return e},set:Gt.set})}};function Nn(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Kn(e,t){try{t(n=>{if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Je();n&&"function"==typeof n.then?Kn(e,(i,s)=>{n instanceof T?n._then(i,s):n.then(i,s)}):(e._state=!0,e._value=n,Bn(e)),r&&Xe()}},Yt.bind(null,e))}catch(n){Yt(e,n)}}function Yt(e,t){if(dt.push(t),null===e._state){var n=e._lib&&Je();t=Ut(t),e._state=!1,e._value=t,ae&&null!==t&&"object"==typeof t&&!t._promise&&function yr(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}(()=>{var r=Tt(t,"stack");t._promise=e,ce(t,"stack",{get:()=>Ht?r&&(r.get?r.get.apply(t):r.value):e.stack})}),function Lr(e){xe.some(t=>t._value===e._value)||xe.push(e)}(e),Bn(e),n&&Xe()}}function Bn(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)zt(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Ce&&(++Ce,ze(()=>{0==--Ce&&$t()},[]))}function zt(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ce,ze(Kr,[n,e,t])}else e._listeners.push(t)}function Kr(e,t,n){try{qt=t;var r,i=t._value;t._state?r=e(i):(dt.length&&(dt=[]),r=e(i),-1===dt.indexOf(i)&&function Wr(e){for(var t=xe.length;t;)if(xe[--t]._value===e._value)return void xe.splice(t,1)}(t)),n.resolve(r)}catch(s){n.reject(s)}finally{qt=null,0==--Ce&&$t(),--n.psd.ref||n.psd.finalize()}}function Ln(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var s,o,i=e._value;null!=i?(s=i.name||"Error",o=i.message||i,r=Kt(i,0)):(s=i,o=""),t.push(s+(o?": "+o:"")+r)}return ae&&((r=Kt(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Ln(e._prev,t,n)),t}function Wn(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function pt(){Je()&&Xe()}function Je(){var e=jt;return jt=!1,ft=!1,e}function Xe(){var e,t,n;do{for(;$e.length>0;)for(e=$e,$e=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while($e.length>0);jt=!0,ft=!0}function $t(){var e=xe;xe=[],e.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var t=mt.slice(0),n=t.length;n;)t[--n]()}function yt(e){return new T(Ye,!1,e)}function G(e,t){var n=M;return function(){var r=Je(),i=M;try{return ve(n,!0),e.apply(this,arguments)}catch(s){t&&t(s)}finally{ve(i,!1),r&&Xe()}}}Te(T.prototype,{then:Gt,_then:function(e,t){zt(this,new Nn(null,null,e,t,M))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return this.then(null,"function"==typeof t?r=>r instanceof t?n(r):yt(r):r=>r&&r.name===t?n(r):yt(r))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),yt(t)))},stack:{get:function(){if(this._stack)return this._stack;try{Ht=!0;var t=Ln(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{Ht=!1}}},timeout:function(e,t){return e<1/0?new T((n,r)=>{var i=setTimeout(()=>r(new K.Timeout(t)),e);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ce(T.prototype,Symbol.toStringTag,"Dexie.Promise"),Ne.env=Fn(),Te(T,{all:function(){var e=he.apply(null,arguments).map(bt);return new T(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((i,s)=>T.resolve(i).then(o=>{e[s]=o,--r||t(e)},n))})},resolve:e=>{if(e instanceof T)return e;if(e&&"function"==typeof e.then)return new T((n,r)=>{e.then(n,r)});var t=new T(Ye,!0,e);return Wn(t,qt),t},reject:yt,race:function(){var e=he.apply(null,arguments).map(bt);return new T((t,n)=>{e.map(r=>T.resolve(r).then(t,n))})},PSD:{get:()=>M,set:e=>M=e},totalEchoes:{get:()=>vt},newPSD:ge,usePSD:Be,scheduler:{get:()=>ze,set:e=>{ze=e}},rejectionMapper:{get:()=>Ut,set:e=>{Ut=e}},follow:(e,t)=>new T((n,r)=>ge((i,s)=>{var o=M;o.unhandleds=[],o.onunhandled=s,o.finalize=Se(function(){!function Br(e){mt.push(function t(){e(),mt.splice(mt.indexOf(t),1)}),++Ce,ze(()=>{0==--Ce&&$t()},[])}(()=>{0===this.unhandleds.length?i():s(this.unhandleds[0])})},o.finalize),e()},t,n,r))}),ht&&(ht.allSettled&&ce(T,"allSettled",function(){const e=he.apply(null,arguments).map(bt);return new T(t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach((i,s)=>T.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||t(r)))})}),ht.any&&typeof AggregateError<"u"&&ce(T,"any",function(){const e=he.apply(null,arguments).map(bt);return new T((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach((s,o)=>T.resolve(s).then(a=>t(a),a=>{i[o]=a,--r||n(new AggregateError(i))}))})}));const Q={awaits:0,echoes:0,id:0};var Fr=0,gt=[],Jt=0,vt=0,Vr=0;function ge(e,t,n,r){var i=M,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Vr;var o=Ne.env;s.env=Vt?{Promise:T,PromiseProp:{value:T,configurable:!0,writable:!0},all:T.all,race:T.race,allSettled:T.allSettled,any:T.any,resolve:T.resolve,reject:T.reject,nthen:Hn(o.nthen,s),gthen:Hn(o.gthen,s)}:{},t&&ee(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Be(s,e,n,r);return 0===s.ref&&s.finalize(),a}function Ke(){return Q.id||(Q.id=++Fr),++Q.awaits,Q.echoes+=100,Q.id}function fe(){return!!Q.awaits&&(0==--Q.awaits&&(Q.id=0),Q.echoes=100*Q.awaits,!0)}function bt(e){return Q.echoes&&e&&e.constructor===ht?(Ke(),e.then(t=>(fe(),t),t=>(fe(),$(t)))):e}function Hr(e){++vt,(!Q.echoes||0==--Q.echoes)&&(Q.echoes=Q.id=0),gt.push(M),ve(e,!0)}function jr(){var e=gt[gt.length-1];gt.pop(),ve(e,!1)}function ve(e,t){var n=M;if((t?Q.echoes&&(!Jt++||e!==M):Jt&&(!--Jt||e!==M))&&Vn(t?Hr.bind(null,e):jr),e!==M&&(M=e,n===Ne&&(Ne.env=Fn()),Vt)){var r=Ne.env.Promise,i=e.env;ut.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(U,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Fn(){var e=U.Promise;return Vt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(U,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ut.then,gthen:e.prototype.then}:{}}function Be(e,t,n,r,i){var s=M;try{return ve(e,!0),t(n,r,i)}finally{ve(s,!1)}}function Vn(e){Mn.call(Wt,e)}function wt(e,t,n,r){return"function"!=typeof e?e:function(){var i=M;n&&Ke(),ve(t,!0);try{return e.apply(this,arguments)}finally{ve(i,!1),r&&Vn(fe)}}}function Hn(e,t){return function(n,r){return e.call(this,wt(n,t),wt(r,t))}}-1===(""+Mn).indexOf("[native code]")&&(Ke=fe=q);const jn="unhandledrejection";function qn(e,t){var n;try{n=t.onuncatched(e)}catch{}if(!1!==n)try{var r,i={promise:t,reason:e};if(U.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(jn,!0,!0),ee(r,i)):U.CustomEvent&&ee(r=new CustomEvent(jn,{detail:i}),i),r&&U.dispatchEvent&&(dispatchEvent(r),!U.PromiseRejectionEvent&&U.onunhandledrejection))try{U.onunhandledrejection(r)}catch{}ae&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var $=T.reject;function Un(e,t,n,r){if(e.idbdb&&(e._state.openComplete||M.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create()}catch(s){return $(s)}return i._promise(t,(s,o)=>ge(()=>(M.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}if(e._state.openComplete)return $(new K.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return $(new K.DatabaseClosed);e.open().catch(q)}return e._state.dbReadyPromise.then(()=>Un(e,t,n,r))}const Ae=String.fromCharCode(65535),Xt=-1/0,de="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Yn="String expected.",Qe=[],_t=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),qr=_t,Ur=_t,zn=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),Et="__dbnames",Qt="readonly",Zt="readwrite";function Ie(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const $n={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function St(e){return"string"!=typeof e||/\./.test(e)?t=>t:t=>(void 0===t[e]&&e in t&&delete(t=qe(t))[e],t)}class Gr{_trans(t,n,r){const i=this._tx||M.trans,s=this.name;function o(l,c,f){if(!f.schema[s])throw new K.NotFound("Table "+s+" not part of transaction");return n(f.idbtrans,f)}const a=Je();try{return i&&i.db===this.db?i===M.trans?i._promise(t,o,r):ge(()=>i._promise(t,o,r),{trans:i,transless:M.transless||M}):Un(this.db,t,[this.name],o)}finally{a&&Xe()}}get(t,n){return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:t}).then(i=>this.hook.reading.fire(i))).then(n)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(X(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const n=z(t);if(1===n.length)return this.where(n[0]).equals(t[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&n.every(f=>c.keyPath.indexOf(f)>=0)&&c.keyPath.every(f=>n.indexOf(f)>=0))[0];if(r&&this.db._maxKey!==Ae)return this.where(r.name).equals(r.keyPath.map(c=>t[c]));!r&&ae&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(c,f){try{return 0===s.cmp(c,f)}catch{return!1}}const[a,l]=n.reduce(([c,f],u)=>{const h=i[u],d=t[u];return[c||h,c||!h?Ie(f,h&&h.multi?E=>{const m=ue(E,u);return X(m)&&m.some(_=>o(d,_))}:E=>o(d,ue(E,u))):f]},[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,X(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const n=r=>{if(!r)return r;const i=Object.create(t.prototype);for(var s in r)if(ie(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),t}defineClass(){return this.mapToClass(function t(n){ee(this,n)})}add(t,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=t;return i&&r&&(s=St(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:null!=n?[n]:null,values:[s]})).then(o=>o.numFailures?T.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{se(t,i,o)}catch{}return o})}update(t,n){if("object"!=typeof t||X(t))return this.where(":id").equals(t).modify(n);{const r=ue(t,this.schema.primKey.keyPath);if(void 0===r)return $(new K.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof n?z(n).forEach(i=>{se(t,i,n[i])}):n(t,{value:t,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(t,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=t;return i&&r&&(s=St(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:null!=n?[n]:null})).then(o=>o.numFailures?T.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{se(t,i,o)}catch{}return o})}delete(t){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[t]})).then(n=>n.numFailures?T.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:$n})).then(t=>t.numFailures?T.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",n=>this.core.getMany({keys:t,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(t,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let f=l&&a?t.map(St(l)):t;return this.core.mutate({trans:o,type:"add",keys:i,values:f,wantResults:s}).then(({numFailures:u,results:h,lastResult:d,failures:E})=>{if(0===u)return s?h:d;throw new Ue(`${this.name}.bulkAdd(): ${u} of ${c} operations failed`,E)})})}bulkPut(t,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let f=l&&a?t.map(St(l)):t;return this.core.mutate({trans:o,type:"put",keys:i,values:f,wantResults:s}).then(({numFailures:u,results:h,lastResult:d,failures:E})=>{if(0===u)return s?h:d;throw new Ue(`${this.name}.bulkPut(): ${u} of ${c} operations failed`,E)})})}bulkDelete(t){const n=t.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:t})).then(({numFailures:r,lastResult:i,failures:s})=>{if(0===r)return i;throw new Ue(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}}function Ze(e){var t={},n=function(a,l){if(l){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return t[a].subscribe.apply(null,f),e}if("string"==typeof a)return t[a]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(a,l,c){if("object"==typeof a)return o(a);l||(l=Dr),c||(c=q);var f={subscribers:[],fire:c,subscribe:function(u){-1===f.subscribers.indexOf(u)&&(f.subscribers.push(u),f.fire=l(f.fire,u))},unsubscribe:function(u){f.subscribers=f.subscribers.filter(function(h){return h!==u}),f.fire=f.subscribers.reduce(l,c)}};return t[a]=n[a]=f,f}function o(a){z(a).forEach(function(l){var c=a[l];if(X(c))s(l,a[l][0],a[l][1]);else{if("asap"!==c)throw new K.InvalidArgument("Invalid event config");var f=s(l,Ge,function(){for(var h=arguments.length,d=new Array(h);h--;)d[h]=arguments[h];f.subscribers.forEach(function(E){Sn(function(){E.apply(null,d)})})})}})}}function et(e,t){return De(t).from({prototype:e}),t}function Le(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function en(e,t){e.filter=Ie(e.filter,t)}function tn(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Ie(r(),t()):t,e.justLimit=n&&!r}function xt(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new K.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Jn(e,t,n){const r=xt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ct(e,t,n,r){const i=e.replayFilter?Ie(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(a,l,c)=>{if(!i||i(l,c,h=>l.stop(h),h=>l.fail(h))){var f=l.primaryKey,u=""+f;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(f)),ie(s,u)||(s[u]=!0,t(a,l,c))}};return Promise.all([e.or._iterate(o,n),Xn(Jn(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Xn(Jn(e,r,n),Ie(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Xn(e,t,n,r){var s=G(r?(o,a,l)=>n(r(o),a,l):n);return e.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!t||t(o,l=>a=l,l=>{o.stop(l),a=q},l=>{o.fail(l),a=q}))&&s(o.value,o,l=>a=l),a()})})}function te(e,t){try{const n=Qn(e),r=Qn(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function Jr(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let s=0;s<i;++s)if(e[s]!==t[s])return e[s]<t[s]?-1:1;return n===r?0:n<r?-1:1}(Zn(e),Zn(t));case"Array":return function $r(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let s=0;s<i;++s){const o=te(e[s],t[s]);if(0!==o)return o}return n===r?0:n<r?-1:1}(e,t)}}catch{}return NaN}function Qn(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=Pt(e);return"ArrayBuffer"===n?"binary":n}function Zn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Xr{_read(t,n){var r=this._ctx;return r.error?r.table._trans(null,$.bind(null,r.error)):r.table._trans("readonly",t).then(n)}_write(t){var n=this._ctx;return n.error?n.table._trans(null,$.bind(null,n.error)):n.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var n=this._ctx;n.algorithm=Ie(n.algorithm,t)}_iterate(t,n){return Ct(this._ctx,t,n,this._ctx.table.core)}clone(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&ee(r,t),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(t){var n=this._ctx;return this._read(r=>Ct(n,t,r,n.table.core))}count(t){return this._read(n=>{const r=this._ctx,i=r.table.core;if(Le(r,!0))return i.count({trans:n,query:{index:xt(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return Ct(r,()=>(++s,!1),n,i).then(()=>s)}).then(t)}sortBy(t,n){const r=t.split(".").reverse(),i=r[0],s=r.length-1;function o(c,f){return f?o(c[r[f]],f-1):c[i]}var a="next"===this._ctx.dir?1:-1;function l(c,f){var u=o(c,s),h=o(f,s);return u<h?-a:u>h?a:0}return this.toArray(function(c){return c.sort(l)}).then(n)}toArray(t){return this._read(n=>{var r=this._ctx;if("next"===r.dir&&Le(r,!0)&&r.limit>0){const{valueMapper:i}=r,s=xt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return Ct(r,s=>i.push(s),n,r.table.core).then(()=>i)}},t)}offset(t){var n=this._ctx;return t<=0||(n.offset+=t,Le(n)?tn(n,()=>{var r=t;return(i,s)=>0===r||(1===r?(--r,!1):(s(()=>{i.advance(r),r=0}),!1))}):tn(n,()=>{var r=t;return()=>--r<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),tn(this._ctx,()=>{var n=t;return function(r,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(t,n){return en(this._ctx,function(r,i,s){return!t(r.value)||(i(s),n)}),this}first(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){return en(this._ctx,function(n){return t(n.value)}),function zr(e,t){e.isMatch=Ie(e.isMatch,t)}(this._ctx,t),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.primaryKey,i)})}keys(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(t)}primaryKeys(t){var n=this._ctx;if("next"===n.dir&&Le(n,!0)&&n.limit>0)return this._read(i=>{var s=xt(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(n){return n[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return en(this._ctx,function(i){var s=i.primaryKey.toString(),o=ie(r,s);return r[s]=!0,!o}),this}modify(t){var n=this._ctx;return this._write(r=>{var i;if("function"==typeof t)i=t;else{var s=z(t),o=s.length;i=function(m){for(var _=!1,y=0;y<o;++y){var I=s[y],S=t[I];ue(m,I)!==S&&(se(m,I,S),_=!0)}return _}}const a=n.table.core,{outbound:l,extractKey:c}=a.schema.primaryKey,f=this.db._options.modifyChunkSize||200,u=[];let h=0;const d=[],E=(m,_)=>{const{failures:y,numFailures:I}=_;h+=m-I;for(let S of z(y))u.push(y[S])};return this.clone().primaryKeys().then(m=>{const _=y=>{const I=Math.min(f,m.length-y);return a.getMany({trans:r,keys:m.slice(y,y+I),cache:"immutable"}).then(S=>{const w=[],k=[],R=l?[]:null,D=[];for(let p=0;p<I;++p){const A=S[p],O={value:qe(A),primKey:m[y+p]};!1!==i.call(O,O.value,O)&&(null==O.value?D.push(m[y+p]):l||0===te(c(A),c(O.value))?(k.push(O.value),l&&R.push(m[y+p])):(D.push(m[y+p]),w.push(O.value)))}const b=Le(n)&&n.limit===1/0&&("function"!=typeof t||t===nn)&&{index:n.index,range:n.range};return Promise.resolve(w.length>0&&a.mutate({trans:r,type:"add",values:w}).then(p=>{for(let A in p.failures)D.splice(parseInt(A),1);E(w.length,p)})).then(()=>(k.length>0||b&&"object"==typeof t)&&a.mutate({trans:r,type:"put",keys:R,values:k,criteria:b,changeSpec:"function"!=typeof t&&t}).then(p=>E(k.length,p))).then(()=>(D.length>0||b&&t===nn)&&a.mutate({trans:r,type:"delete",keys:D,criteria:b}).then(p=>E(D.length,p))).then(()=>m.length>y+I&&_(y+f))})};return _(0).then(()=>{if(u.length>0)throw new lt("Error modifying one or more objects",u,h,d);return m.length})})})}delete(){var t=this._ctx,n=t.range;return Le(t)&&(t.isPrimKey&&!Ur||3===n.type)?this._write(r=>{const{primaryKey:i}=t.table.core.schema,s=n;return t.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>t.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,numFailures:f})=>{if(f)throw new lt("Could not delete some values",Object.keys(a).map(u=>a[u]),o-f);return o-f}))}):this.modify(nn)}}const nn=(e,t)=>t.value=null;function Zr(e,t){return e<t?-1:e===t?0:1}function ei(e,t){return e>t?-1:e===t?0:1}function re(e,t,n){var r=e instanceof tr?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function We(e){return new e.Collection(e,()=>er("")).limit(0)}function ri(e,t,n,r,i,s){for(var o=Math.min(e.length,r.length),a=-1,l=0;l<o;++l){var c=t[l];if(c!==r[l])return i(e[l],n[l])<0?e.substr(0,l)+n[l]+n.substr(l+1):i(e[l],r[l])<0?e.substr(0,l)+r[l]+n.substr(l+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[l],c)<0&&(a=l)}return o<r.length&&"next"===s?e+n.substr(e.length):o<e.length&&"prev"===s?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function At(e,t,n,r){var i,s,o,a,l,c,f,u=n.length;if(!n.every(m=>"string"==typeof m))return re(e,Yn);function h(m){i=function ti(e){return"next"===e?t=>t.toUpperCase():t=>t.toLowerCase()}(m),s=function ni(e){return"next"===e?t=>t.toLowerCase():t=>t.toUpperCase()}(m),o="next"===m?Zr:ei;var _=n.map(function(y){return{lower:s(y),upper:i(y)}}).sort(function(y,I){return o(y.lower,I.lower)});a=_.map(function(y){return y.upper}),l=_.map(function(y){return y.lower}),c=m,f="next"===m?"":r}h("next");var d=new e.Collection(e,()=>be(a[0],l[u-1]+r));d._ondirectionchange=function(m){h(m)};var E=0;return d._addAlgorithm(function(m,_,y){var I=m.key;if("string"!=typeof I)return!1;var S=s(I);if(t(S,l,E))return!0;for(var w=null,k=E;k<u;++k){var R=ri(I,S,a[k],l[k],o,c);null===R&&null===w?E=k+1:(null===w||o(w,R)>0)&&(w=R)}return _(null!==w?function(){m.continue(w+f)}:y),!1}),d}function be(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function er(e){return{type:1,lower:e,upper:e}}class tr{get Collection(){return this._ctx.table.db.Collection}between(t,n,r,i){r=!1!==r,i=!0===i;try{return this._cmp(t,n)>0||0===this._cmp(t,n)&&(r||i)&&(!r||!i)?We(this):new this.Collection(this,()=>be(t,n,!r,!i))}catch{return re(this,de)}}equals(t){return null==t?re(this,de):new this.Collection(this,()=>er(t))}above(t){return null==t?re(this,de):new this.Collection(this,()=>be(t,void 0,!0))}aboveOrEqual(t){return null==t?re(this,de):new this.Collection(this,()=>be(t,void 0,!1))}below(t){return null==t?re(this,de):new this.Collection(this,()=>be(void 0,t,!1,!0))}belowOrEqual(t){return null==t?re(this,de):new this.Collection(this,()=>be(void 0,t))}startsWith(t){return"string"!=typeof t?re(this,Yn):this.between(t,t+Ae,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):At(this,(n,r)=>0===n.indexOf(r[0]),[t],Ae)}equalsIgnoreCase(t){return At(this,(n,r)=>n===r[0],[t],"")}anyOfIgnoreCase(){var t=he.apply(Pe,arguments);return 0===t.length?We(this):At(this,(n,r)=>-1!==r.indexOf(n),t,"")}startsWithAnyOfIgnoreCase(){var t=he.apply(Pe,arguments);return 0===t.length?We(this):At(this,(n,r)=>r.some(i=>0===n.indexOf(i)),t,Ae)}anyOf(){const t=he.apply(Pe,arguments);let n=this._cmp;try{t.sort(n)}catch{return re(this,de)}if(0===t.length)return We(this);const r=new this.Collection(this,()=>be(t[0],t[t.length-1]));r._ondirectionchange=s=>{n="next"===s?this._ascending:this._descending,t.sort(n)};let i=0;return r._addAlgorithm((s,o,a)=>{const l=s.key;for(;n(l,t[i])>0;)if(++i,i===t.length)return o(a),!1;return 0===n(l,t[i])||(o(()=>{s.continue(t[i])}),!1)}),r}notEqual(t){return this.inAnyRange([[Xt,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=he.apply(Pe,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch{return re(this,de)}const n=t.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[Xt,i]],null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,n){const r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(0===t.length)return We(this);if(!t.every(w=>void 0!==w[0]&&void 0!==w[1]&&i(w[0],w[1])<=0))return re(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);const l=!n||!1!==n.includeLowers,c=n&&!0===n.includeUppers;let d,u=i;function h(w,k){return u(w[0],k[0])}try{d=t.reduce(function f(w,k){let R=0,D=w.length;for(;R<D;++R){const b=w[R];if(r(k[0],b[1])<0&&r(k[1],b[0])>0){b[0]=o(b[0],k[0]),b[1]=a(b[1],k[1]);break}}return R===D&&w.push(k),w},[]),d.sort(h)}catch{return re(this,de)}let E=0;const m=c?w=>i(w,d[E][1])>0:w=>i(w,d[E][1])>=0,_=l?w=>s(w,d[E][0])>0:w=>s(w,d[E][0])>=0;let I=m;const S=new this.Collection(this,()=>be(d[0][0],d[d.length-1][1],!l,!c));return S._ondirectionchange=w=>{"next"===w?(I=m,u=i):(I=_,u=s),d.sort(h)},S._addAlgorithm((w,k,R)=>{for(var D=w.key;I(D);)if(++E,E===d.length)return k(R),!1;return!!function y(w){return!m(w)&&!_(w)}(D)||(0===this._cmp(D,d[E][1])||0===this._cmp(D,d[E][0])||k(()=>{w.continue(u===i?d[E][0]:d[E][1])}),!1)}),S}startsWithAnyOf(){const t=he.apply(Pe,arguments);return t.every(n=>"string"==typeof n)?0===t.length?We(this):this.inAnyRange(t.map(n=>[n,n+Ae])):re(this,"startsWithAnyOf() only works with strings")}}function le(e){return G(function(t){return tt(t),e(t.target.error),!1})}function tt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const nt="storagemutated",we="x-storagemutated-1",_e=Ze(null,nt);class si{_lock(){return je(!M.global),++this._reculock,1===this._reculock&&!M.global&&(M.lockOwnerFor=this),this}_unlock(){if(je(!M.global),0==--this._reculock)for(M.global||(M.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Be(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&M.lockOwnerFor!==this}create(t){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(je(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new K.DatabaseClosed(r);case"MissingAPIError":throw new K.MissingAPI(r.message,r);default:throw new K.OpenFailed(r)}if(!this.active)throw new K.TransactionInactive;return je(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=G(i=>{tt(i),this._reject(t.error)}),t.onabort=G(i=>{tt(i),this.active&&this._reject(new K.Abort(t.error)),this.active=!1,this.on("abort").fire(i)}),t.oncomplete=G(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&_e.storagemutated.fire(t.mutatedParts)}),this}_promise(t,n,r){if("readwrite"===t&&"readwrite"!==this.mode)return $(new K.ReadOnly("Transaction is readonly"));if(!this.active)return $(new K.TransactionInactive);if(this._locked())return new T((s,o)=>{this._blockedFuncs.push([()=>{this._promise(t,n,r).then(s,o)},M])});if(r)return ge(()=>{var s=new T((o,a)=>{this._lock();const l=n(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new T((s,o)=>{var a=n(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var n=this._root();const r=T.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);!function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)}()}var s=n._waitingFor;return new T((o,a)=>{r.then(l=>n._waitingQueue.push(G(o.bind(null,l))),l=>n._waitingQueue.push(G(a.bind(null,l)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))}table(t){const n=this._memoizedTables||(this._memoizedTables={});if(ie(n,t))return n[t];const r=this.schema[t];if(!r)throw new K.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,r,this);return i.core=this.db.core.table(t),n[t]=i,i}}function rn(e,t,n,r,i,s,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+nr(t)}}function nr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function rr(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:xn(n,r=>[r.name,r])}}let rt=e=>{try{return e.only([[]]),rt=()=>[[]],[[]]}catch{return rt=()=>Ae,Ae}};function sn(e){return null==e?()=>{}:"string"==typeof e?function li(e){return 1===e.split(".").length?n=>n[e]:n=>ue(n,e)}(e):t=>ue(t,e)}function ir(e){return[].slice.call(e)}let ci=0;function it(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function ui(e,t,n){function i(f){if(3===f.type)return null;if(4===f.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:h,lowerOpen:d,upperOpen:E}=f;return void 0===u?void 0===h?null:t.upperBound(h,!!E):void 0===h?t.lowerBound(u,!!d):t.bound(u,h,!!d,!!E)}const{schema:o,hasGetAll:a}=function r(f,u){const h=ir(f.objectStoreNames);return{schema:{name:f.name,tables:h.map(d=>u.objectStore(d)).map(d=>{const{keyPath:E,autoIncrement:m}=d,_=X(E),I={},S={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==E,compound:_,keyPath:E,autoIncrement:m,unique:!0,extractKey:sn(E)},indexes:ir(d.indexNames).map(w=>d.index(w)).map(w=>{const{name:k,unique:R,multiEntry:D,keyPath:b}=w,A={name:k,compound:X(b),keyPath:b,unique:R,multiEntry:D,extractKey:sn(b)};return I[it(b)]=A,A}),getIndexByKeyPath:w=>I[it(w)]};return I[":id"]=S.primaryKey,null!=E&&(I[it(E)]=S.primaryKey),S})},hasGetAll:h.length>0&&"getAll"in u.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),l=o.tables.map(f=>function s(f){const u=f.name;return{name:u,schema:f,mutate:function h({trans:m,type:_,keys:y,values:I,range:S}){return new Promise((w,k)=>{w=G(w);const R=m.objectStore(u),D=null==R.keyPath,b="put"===_||"add"===_;if(!b&&"delete"!==_&&"deleteRange"!==_)throw new Error("Invalid operation type: "+_);const{length:p}=y||I||{length:1};if(y&&I&&y.length!==I.length)throw new Error("Given keys array must have same length as given values array.");if(0===p)return w({numFailures:0,failures:{},results:[],lastResult:void 0});let A;const O=[],B=[];let C=0;const j=V=>{++C,tt(V)};if("deleteRange"===_){if(4===S.type)return w({numFailures:C,failures:B,results:[],lastResult:void 0});O.push(A=3===S.type?R.clear():R.delete(i(S)))}else{const[V,H]=b?D?[I,y]:[I,null]:[y,null];if(b)for(let L=0;L<p;++L)O.push(A=H&&void 0!==H[L]?R[_](V[L],H[L]):R[_](V[L])),A.onerror=j;else for(let L=0;L<p;++L)O.push(A=R[_](V[L])),A.onerror=j}const g=V=>{const H=V.target.result;O.forEach((L,F)=>null!=L.error&&(B[F]=L.error)),w({numFailures:C,failures:B,results:"delete"===_?y:O.map(L=>L.result),lastResult:H})};A.onerror=V=>{j(V),g(V)},A.onsuccess=g})},getMany:({trans:m,keys:_})=>new Promise((y,I)=>{y=G(y);const S=m.objectStore(u),w=_.length,k=new Array(w);let b,R=0,D=0;const p=O=>{const B=O.target;k[B._pos]=B.result,++D===R&&y(k)},A=le(I);for(let O=0;O<w;++O)null!=_[O]&&(b=S.get(_[O]),b._pos=O,b.onsuccess=p,b.onerror=A,++R);0===R&&y(k)}),get:({trans:m,key:_})=>new Promise((y,I)=>{y=G(y);const w=m.objectStore(u).get(_);w.onsuccess=k=>y(k.target.result),w.onerror=le(I)}),query:function E(m){return _=>new Promise((y,I)=>{y=G(y);const{trans:S,values:w,limit:k,query:R}=_,D=k===1/0?void 0:k,{index:b,range:p}=R,A=S.objectStore(u),O=b.isPrimaryKey?A:A.index(b.name),B=i(p);if(0===k)return y({result:[]});if(m){const C=w?O.getAll(B,D):O.getAllKeys(B,D);C.onsuccess=j=>y({result:j.target.result}),C.onerror=le(I)}else{let C=0;const j=w||!("openKeyCursor"in O)?O.openCursor(B):O.openKeyCursor(B),g=[];j.onsuccess=V=>{const H=j.result;return H?(g.push(w?H.value:H.primaryKey),++C===k?y({result:g}):void H.continue()):y({result:g})},j.onerror=le(I)}})}(a),openCursor:function d({trans:m,values:_,query:y,reverse:I,unique:S}){return new Promise((w,k)=>{w=G(w);const{index:R,range:D}=y,b=m.objectStore(u),p=R.isPrimaryKey?b:b.index(R.name),A=I?S?"prevunique":"prev":S?"nextunique":"next",O=_||!("openKeyCursor"in p)?p.openCursor(i(D),A):p.openKeyCursor(i(D),A);O.onerror=le(k),O.onsuccess=G(B=>{const C=O.result;if(!C)return void w(null);C.___id=++ci,C.done=!1;const j=C.continue.bind(C);let g=C.continuePrimaryKey;g&&(g=g.bind(C));const V=C.advance.bind(C),L=()=>{throw new Error("Cursor not stopped")};C.trans=m,C.stop=C.continue=C.continuePrimaryKey=C.advance=()=>{throw new Error("Cursor not started")},C.fail=G(k),C.next=function(){let F=1;return this.start(()=>F--?this.continue():this.stop()).then(()=>this)},C.start=F=>{const J=new Promise((Y,Ve)=>{Y=G(Y),O.onerror=le(Ve),C.fail=Ve,C.stop=rs=>{C.stop=C.continue=C.continuePrimaryKey=C.advance=L,Y(rs)}}),ne=()=>{if(O.result)try{F()}catch(Y){C.fail(Y)}else C.done=!0,C.start=()=>{throw new Error("Cursor behind last entry")},C.stop()};return O.onsuccess=G(Y=>{O.onsuccess=ne,ne()}),C.continue=j,C.continuePrimaryKey=g,C.advance=V,ne(),J},w(C)},k)})},count({query:m,trans:_}){const{index:y,range:I}=m;return new Promise((S,w)=>{const k=_.objectStore(u),R=y.isPrimaryKey?k:k.index(y.name),D=i(I),b=D?R.count(D):R.count();b.onsuccess=G(p=>S(p.target.result)),b.onerror=le(w)})}}}(f)),c={};return l.forEach(f=>c[f.name]=f),{stack:"dbcore",transaction:e.transaction.bind(e),table(f){if(!c[f])throw new Error(`Table '${f}' not found`);return c[f]},MIN_KEY:-1/0,MAX_KEY:rt(t),schema:o}}function hi(e,t){return t.reduce((n,{create:r})=>({...n,...r(n)}),e)}function on({_novip:e},t){const r=function fi(e,t,{IDBKeyRange:n},i){return{dbcore:hi(ui(t,n,i),e.dbcore)}}(e._middlewares,t.db,e._deps,t);e.core=r.dbcore,e.tables.forEach(i=>{const s=i.name;e.core.schema.tables.some(o=>o.name===s)&&(i.core=e.core.table(s),e[s]instanceof e.Table&&(e[s].core=i.core))})}function It({_novip:e},t,n,r){n.forEach(i=>{const s=r[i];t.forEach(o=>{const a=Tt(o,i);(!a||"value"in a&&void 0===a.value)&&(o===e.Transaction.prototype||o instanceof e.Transaction?ce(o,i,{get(){return this.table(i)},set(l){_n(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new e.Table(i,s))})})}function an({_novip:e},t){t.forEach(n=>{for(let r in n)n[r]instanceof e.Table&&delete n[r]})}function di(e,t){return e._cfg.version-t._cfg.version}function sr(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],s=t[r];if(i){const o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!_t)o.recreate=!0,n.change.push(o);else{const a=i.idxByName,l=s.idxByName;let c;for(c in a)l[c]||o.del.push(c);for(c in l){const f=a[c],u=l[c];f?f.src!==u.src&&o.change.push(u):o.add.push(u)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,s])}return n}function ln(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>cn(i,s)),i}function cn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function un(e,t,n){const r={};return at(t.objectStoreNames,0).forEach(s=>{const o=n.objectStore(s);let a=o.keyPath;const l=rn(nr(a),a||"",!1,!1,!!o.autoIncrement,a&&"string"!=typeof a,!0),c=[];for(let u=0;u<o.indexNames.length;++u){const h=o.index(o.indexNames[u]);a=h.keyPath;var f=rn(h.name,a,!!h.unique,!!h.multiEntry,!1,a&&"string"!=typeof a,!1);c.push(f)}r[s]=rr(s,l,c)}),r}function hn({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);e._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const l=o.indexNames[a],c=o.index(l).keyPath,f="string"==typeof c?c:"["+at(c).join("+")+"]";if(t[s]){const u=t[s].idxByName[f];u&&(u.name=l,delete t[s].idxByName[f],t[s].idxByName[l]=u)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&U.WorkerGlobalScope&&U instanceof U.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class _i{_parseStoresSpec(t,n){z(t).forEach(r=>{if(null!==t[r]){var i=function wi(e){return e.split(",").map((t,n)=>{const r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return rn(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),X(i),0===n)})}(t[r]),s=i.shift();if(s.multi)throw new K.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")}),n[r]=rr(r,s,i)}})}stores(t){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?ee(this._cfg.storesSource,t):t;const i={};let s={};return n._versions.forEach(o=>{ee(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),n._dbSchema=s,an(n,[n._allTables,n,n.Transaction.prototype]),It(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],z(s),s),n._storeNames=z(s),this}upgrade(t){return this._cfg.contentUpgrade=Lt(this._cfg.contentUpgrade||q,t),this}}function fn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ke(Et,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function dn(e){return e&&"function"==typeof e.databases}function mn(e){return ge(function(){return M.letThrough=!0,e()})}function Ai(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function Ii(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?$(t.dbOpenError):e);ae&&(t.openCanceller._stackHolder=Ee()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new K.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,a=!1;return T.race([r,(typeof navigator>"u"?T.resolve():Ai()).then(()=>new T((l,c)=>{if(i(),!n)throw new K.MissingAPI;const f=e.name,u=t.autoSchema?n.open(f):n.open(f,Math.round(10*e.verno));if(!u)throw new K.MissingAPI;u.onerror=le(c),u.onblocked=G(e._fireOnBlocked),u.onupgradeneeded=G(h=>{if(o=u.transaction,t.autoSchema&&!e._options.allowEmptyDB){u.onerror=tt,o.abort(),u.result.close();const E=n.deleteDatabase(f);E.onsuccess=E.onerror=G(()=>{c(new K.NoSuchDatabase(`Database ${f} doesnt exist`))})}else{o.onerror=le(c);var d=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;a=d<1,e._novip.idbdb=u.result,function mi(e,t,n,r){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),a=M.transless||M;ge(()=>{M.trans=s,M.transless=a,0===t?(z(i).forEach(l=>{ln(n,l,i[l].primKey,i[l].indexes)}),on(e,n),T.follow(()=>e.on.populate.fire(s)).catch(o)):function pi({_novip:e},t,n,r){const i=[],s=e._versions;let o=e._dbSchema=un(0,e.idbdb,r),a=!1;return s.filter(f=>f._cfg.version>=t).forEach(f=>{i.push(()=>{const u=o,h=f._cfg.dbschema;hn(e,u,r),hn(e,h,r),o=e._dbSchema=h;const d=sr(u,h);d.add.forEach(m=>{ln(r,m[0],m[1].primKey,m[1].indexes)}),d.change.forEach(m=>{if(m.recreate)throw new K.Upgrade("Not yet support for changing primary key");{const _=r.objectStore(m.name);m.add.forEach(y=>cn(_,y)),m.change.forEach(y=>{_.deleteIndex(y.name),cn(_,y)}),m.del.forEach(y=>_.deleteIndex(y))}});const E=f._cfg.contentUpgrade;if(E&&f._cfg.version>t){on(e,r),n._memoizedTables={},a=!0;let m=Cn(h);d.del.forEach(S=>{m[S]=u[S]}),an(e,[e.Transaction.prototype]),It(e,[e.Transaction.prototype],z(m),m),n.schema=m;const _=Nt(E);let y;_&&Ke();const I=T.follow(()=>{if(y=E(n),y&&_){var S=fe.bind(null,null);y.then(S,S)}});return y&&"function"==typeof y.then?T.resolve(y):I.then(()=>y)}}),i.push(u=>{a&&qr||function gi(e,t){[].slice.call(t.db.objectStoreNames).forEach(n=>null==e[n]&&t.db.deleteObjectStore(n))}(f._cfg.dbschema,u),an(e,[e.Transaction.prototype]),It(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema})}),function c(){return i.length?T.resolve(i.shift()(n.idbtrans)).then(c):T.resolve()}().then(()=>{!function yi(e,t){z(e).forEach(n=>{t.db.objectStoreNames.contains(n)||ln(t,n,e[n].primKey,e[n].indexes)})}(o,r)})}(e,t,s,n).catch(o)})}(e,d/10,o,c)}},c),u.onsuccess=G(()=>{o=null;const h=e._novip.idbdb=u.result,d=at(h.objectStoreNames);if(d.length>0)try{const E=h.transaction(function ai(e){return 1===e.length?e[0]:e}(d),"readonly");t.autoSchema?function vi({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=un(0,t,n);e._storeNames=at(t.objectStoreNames,0),It(e,[e._allTables],z(r),r)}(e,h,E):(hn(e,e._dbSchema,E),function bi(e,t){const r=sr(un(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}(e,E)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),on(e,E)}catch{}Qe.push(e),h.onversionchange=G(E=>{t.vcFired=!0,e.on("versionchange").fire(E)}),h.onclose=G(E=>{e.on("close").fire(E)}),a&&function xi({indexedDB:e,IDBKeyRange:t},n){!dn(e)&&n!==Et&&fn(e,t).put({name:n}).catch(q)}(e._deps,f),l()},c)}))]).then(()=>(i(),t.onReadyBeingFired=[],T.resolve(mn(()=>e.on.ready.fire(e.vip))).then(function l(){if(t.onReadyBeingFired.length>0){let c=t.onReadyBeingFired.reduce(Lt,q);return t.onReadyBeingFired=[],T.resolve(mn(()=>c(e.vip))).then(l)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(l=>{t.dbOpenError=l;try{o&&o.abort()}catch{}return r===t.openCanceller&&e._close(),$(l)}).finally(()=>{t.openComplete=!0,s()})}function pn(e){var t=o=>e.next(o),r=s(t),i=s(o=>e.throw(o));function s(o){return a=>{var l=o(a),c=l.value;return l.done?c:c&&"function"==typeof c.then?c.then(r,i):X(c)?Promise.all(c).then(r,i):r(c)}}return s(t)()}function ki(e,t,n){var r=arguments.length;if(r<2)throw new K.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var s=An(i);return[e,s,n]}function Ri(e,t,n,r,i){return T.resolve().then(()=>{const s=M.transless||M,o=e._createTransaction(t,n,e._dbSchema,r),a={trans:o,transless:s};r?o.idbtrans=r.idbtrans:o.create();const l=Nt(i);let c;l&&Ke();const f=T.follow(()=>{if(c=i.call(o,o),c)if(l){var u=fe.bind(null,null);c.then(u,u)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=pn(c))},a);return(c&&"function"==typeof c.then?T.resolve(c).then(u=>o.active?u:$(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):f.then(()=>c)).then(u=>(r&&o._resolve(),o._completion.then(()=>u))).catch(u=>(o._reject(u),$(u)))})}function kt(e,t,n){const r=X(e)?e.slice():[e];for(let i=0;i<n;++i)r.push(t);return r}const Ti={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function Oi(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},s=[];function o(h,d,E){const m=it(h),_=i[m]=i[m]||[],y=null==h?0:"string"==typeof h?1:h.length,I=d>0,S={...E,isVirtual:I,keyTail:d,keyLength:y,extractKey:sn(h),unique:!I&&E.unique};return _.push(S),S.isPrimaryKey||s.push(S),y>1&&o(2===y?h[0]:h.slice(0,y-1),d+1,E),_.sort((w,k)=>w.keyTail-k.keyTail),S}const a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const h of r.indexes)o(h.keyPath,0,h);function c(h,d){return{type:1===h.type?2:h.type,lower:kt(h.lower,h.lowerOpen?e.MAX_KEY:e.MIN_KEY,d),lowerOpen:!0,upper:kt(h.upper,h.upperOpen?e.MIN_KEY:e.MAX_KEY,d),upperOpen:!0}}function f(h){const d=h.query.index;return d.isVirtual?{...h,query:{index:d,range:c(h.query.range,d.keyTail)}}:h}return{...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:function l(h){const d=i[it(h)];return d&&d[0]}},count:h=>n.count(f(h)),query:h=>n.query(f(h)),openCursor(h){const{keyTail:d,isVirtual:E,keyLength:m}=h.query.index;return E?n.openCursor(f(h)).then(y=>y&&function _(y){return Object.create(y,{continue:{value:function I(w){null!=w?y.continue(kt(w,h.reverse?e.MAX_KEY:e.MIN_KEY,d)):h.unique?y.continue(y.key.slice(0,m).concat(h.reverse?e.MIN_KEY:e.MAX_KEY,d)):y.continue()}},continuePrimaryKey:{value(w,k){y.continuePrimaryKey(kt(w,e.MAX_KEY,d),k)}},primaryKey:{get:()=>y.primaryKey},key:{get(){const w=y.key;return 1===m?w[0]:w.slice(0,m)}},value:{get:()=>y.value}})}(y)):n.openCursor(h)}}}}}};function yn(e,t,n,r){return n=n||{},r=r||"",z(e).forEach(i=>{if(ie(t,i)){var s=e[i],o=t[i];if("object"==typeof s&&"object"==typeof o&&s&&o){const a=Pt(s);a!==Pt(o)?n[r+i]=t[i]:"Object"===a?yn(s,o,n,r+i+"."):s!==o&&(n[r+i]=t[i])}else s!==o&&(n[r+i]=t[i])}else n[r+i]=void 0}),z(t).forEach(i=>{ie(e,i)||(n[r+i]=t[i])}),n}const Pi={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema;return{...n,mutate(s){const o=M.trans,{deleting:a,creating:l,updating:c}=o.table(t).hook;switch(s.type){case"add":if(l.fire===q)break;return o._promise("readwrite",()=>f(s),!0);case"put":if(l.fire===q&&c.fire===q)break;return o._promise("readwrite",()=>f(s),!0);case"delete":if(a.fire===q)break;return o._promise("readwrite",()=>f(s),!0);case"deleteRange":if(a.fire===q)break;return o._promise("readwrite",()=>function u(d){return h(d.trans,d.range,1e4)}(s),!0)}return n.mutate(s);function f(d){const E=M.trans,m=d.keys||function Di(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,d);if(!m)throw new Error("Keys missing");return"delete"!==(d="add"===d.type||"put"===d.type?{...d,keys:m}:{...d}).type&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function Mi(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,d,m).then(_=>{const y=m.map((I,S)=>{const w=_[S],k={onerror:null,onsuccess:null};if("delete"===d.type)a.fire.call(k,I,w,E);else if("add"===d.type||void 0===w){const R=l.fire.call(k,I,d.values[S],E);null==I&&null!=R&&(d.keys[S]=I=R,r.outbound||se(d.values[S],r.keyPath,I))}else{const R=yn(w,d.values[S]),D=c.fire.call(k,R,I,w,E);if(D){const b=d.values[S];Object.keys(D).forEach(p=>{ie(b,p)?b[p]=D[p]:se(b,p,D[p])})}}return k});return n.mutate(d).then(({failures:I,results:S,numFailures:w,lastResult:k})=>{for(let R=0;R<m.length;++R){const D=S?S[R]:m[R],b=y[R];null==D?b.onerror&&b.onerror(I[R]):b.onsuccess&&b.onsuccess("put"===d.type&&_[R]?d.values[R]:D)}return{failures:I,results:S,numFailures:w,lastResult:k}}).catch(I=>(y.forEach(S=>S.onerror&&S.onerror(I)),Promise.reject(I)))})}function h(d,E,m){return n.query({trans:d,values:!1,query:{index:r,range:E},limit:m}).then(({result:_})=>f({type:"delete",keys:_,trans:d}).then(y=>y.numFailures>0?Promise.reject(y.failures[0]):_.length<m?{failures:[],numFailures:0,lastResult:void 0}:h(d,{...E,lower:_[_.length-1],lowerOpen:!0},m)))}}}}})};function or(e,t,n){try{if(!t||t.keys.length<e.length)return null;const r=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)0===te(t.keys[i],e[s])&&(r.push(n?qe(t.values[i]):t.values[i]),++s);return r.length===e.length?r:null}catch{return null}}const Ni={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const i=or(r.keys,r.trans._cache,"clone"===r.cache);return i?T.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:"clone"===r.cache?qe(s):s},s))},mutate:r=>("add"!==r.type&&(r.trans._cache=null),n.mutate(r))}}})};function gn(e){return!("from"in e)}const me=function(e,t){if(!this){const n=new me;return e&&"d"in e&&ee(n,e),n}ee(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function st(e,t,n){const r=te(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(gn(e))return ee(e,{from:t,to:n,d:1});const i=e.l,s=e.r;if(te(n,e.from)<0)return i?st(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},ar(e);if(te(t,e.to)>0)return s?st(s,t,n):e.r={from:t,to:n,d:1,l:null,r:null},ar(e);te(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),te(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&Rt(e,i),s&&o&&Rt(e,s)}function Rt(e,t){gn(t)||function n(r,{from:i,to:s,l:o,r:a}){st(r,i,s),o&&n(r,o),a&&n(r,a)}(e,t)}function vn(e){let t=gn(e)?null:{s:0,n:e};return{next(n){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&te(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||te(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ar(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const s="r"===i?"l":"r",o={...e},a=e[i];e.from=a.from,e.to=a.to,e[i]=a[i],o[i]=a[s],e[s]=o,o.d=lr(o)}e.d=lr(e)}function lr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}Te(me.prototype,{add(e){return Rt(this,e),this},addKey(e){return st(this,e,e),this},addKeys(e){return e.forEach(t=>st(this,t,t)),this},[Mt](){return vn(this)}});const Bi={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new me(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const i=e.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,c={...i,mutate:h=>{const d=h.trans,E=d.mutatedParts||(d.mutatedParts={}),m=R=>{const D=`idb://${t}/${r}/${R}`;return E[D]||(E[D]=new me)},_=m(""),y=m(":dels"),{type:I}=h;let[S,w]="deleteRange"===h.type?[h.range]:"delete"===h.type?[h.keys]:h.values.length<50?[[],h.values]:[];const k=h.trans._cache;return i.mutate(h).then(R=>{if(X(S)){"delete"!==I&&(S=R.results),_.addKeys(S);const D=or(S,k);!D&&"add"!==I&&y.addKeys(S),(D||w)&&function Li(e,t,n,r){t.indexes.forEach(function i(s){const o=e(s.name||"");function a(c){return null!=c?s.extractKey(c):null}const l=c=>s.multiEntry&&X(c)?c.forEach(f=>o.addKey(f)):o.addKey(c);(n||r).forEach((c,f)=>{const u=n&&a(n[f]),h=r&&a(r[f]);0!==te(u,h)&&(null!=u&&l(u),null!=h&&l(h))})})}(m,s,D,w)}else if(S){const D={from:S.lower,to:S.upper};y.add(D),_.add(D)}else _.add(n),y.add(n),s.indexes.forEach(D=>m(D.name).add(n));return R})}},f=({query:{index:h,range:d}})=>{var E,m;return[h,new me(null!==(E=d.lower)&&void 0!==E?E:e.MIN_KEY,null!==(m=d.upper)&&void 0!==m?m:e.MAX_KEY)]},u={get:h=>[o,new me(h.key)],getMany:h=>[o,(new me).addKeys(h.keys)],count:f,query:f,openCursor:f};return z(u).forEach(h=>{c[h]=function(d){const{subscr:E}=M;if(E){const m=w=>{const k=`idb://${t}/${r}/${w}`;return E[k]||(E[k]=new me)},_=m(""),y=m(":dels"),[I,S]=u[h](d);if(m(I.name||"").add(S),!I.isPrimaryKey){if("count"!==h){const w="query"===h&&l&&d.values&&i.query({...d,values:!1});return i[h].apply(this,arguments).then(k=>{if("query"===h){if(l&&d.values)return w.then(({result:D})=>(_.addKeys(D),k));const R=d.values?k.result.map(a):k.result;d.values?_.addKeys(R):y.addKeys(R)}else if("openCursor"===h){const R=k,D=d.values;return R&&Object.create(R,{key:{get:()=>(y.addKey(R.primaryKey),R.key)},primaryKey:{get(){const b=R.primaryKey;return y.addKey(b),b}},value:{get:()=>(D&&_.addKey(R.primaryKey),R.value)}})}return k})}y.add(n)}}return i[h].apply(this,arguments)}}),c}}}};class ke{constructor(t,n){this._middlewares={},this.verno=0;const r=ke.dependencies;this._options=n={addons:ke.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:q,dbReadyPromise:null,cancelOpen:q,openCanceller:null,autoSchema:!0};s.dbReadyPromise=new T(o=>{s.dbReadyResolve=o}),s.openCanceller=new T((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=t,this.on=Ze(this,"populate","blocked","versionchange","close",{ready:[Lt,q]}),this.on.ready.subscribe=En(this.on.ready.subscribe,o=>(a,l)=>{ke.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||T.resolve().then(a),l&&o(a);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(a),l&&o(a);else{o(a);const f=this;l||o(function u(){f.on.ready.unsubscribe(a),f.on.ready.unsubscribe(u)})}})}),this.Collection=function Qr(e){return et(Xr.prototype,function(n,r){this.db=e;let i=$n,s=null;if(r)try{i=r()}catch(c){s=c}const o=n._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==Ge?l:null}})}(this),this.Table=function Yr(e){return et(Gr.prototype,function(n,r,i){this.db=e,this._tx=i,this.name=n,this.schema=r,this.hook=e._allTables[n]?e._allTables[n].hook:Ze(null,{creating:[Rr,q],reading:[kr,Ge],updating:[Tr,q],deleting:[Or,q]})})}(this),this.Transaction=function oi(e){return et(si.prototype,function(n,r,i,s,o){this.db=e,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=Ze(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new T((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),$(a)})})}(this),this.Version=function Ei(e){return et(_i.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function ii(e){return et(tr.prototype,function(n,r,i){this.db=e,this._ctx={table:n,index:":id"===r?null:r,or:i};const s=e._deps.indexedDB;if(!s)throw new K.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=e._deps.IDBKeyRange})}(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=rt(n.IDBKeyRange),this._createTransaction=(o,a,l,c)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,c),this._fireOnBlocked=o=>{this.on("blocked").fire(o),Qe.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Ti),this.use(Pi),this.use(Bi),this.use(Ni),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(t){if(isNaN(t)||t<.1)throw new K.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const n=this._versions;var r=n.filter(i=>i._cfg.version===t)[0];return r||(r=new this.Version(t),n.push(r),n.sort(di),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(t){return this.idbdb&&(this._state.openComplete||M.letThrough||this._vip)?t():new T((n,r)=>{if(this._state.openComplete)return r(new K.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new K.DatabaseClosed);this.open().catch(q)}this._state.dbReadyPromise.then(n,r)}).then(t)}use({stack:t,create:n,level:r,name:i}){i&&this.unuse({stack:t,name:i});const s=this._middlewares[t]||(this._middlewares[t]=[]);return s.push({stack:t,create:n,level:r??10,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:t,name:n,create:r}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(i=>r?i.create!==r:!!n&&i.name!==n)),this}open(){return Ii(this)}_close(){const t=this._state,n=Qe.indexOf(this);if(n>=0&&Qe.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new T(r=>{t.dbReadyResolve=r}),t.openCanceller=new T((r,i)=>{t.cancelOpen=i})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new K.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,n=this._state;return new T((r,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=G(()=>{(function Ci({indexedDB:e,IDBKeyRange:t},n){!dn(e)&&n!==Et&&fn(e,t).delete(n).catch(q)})(this._deps,this.name),r()}),o.onerror=le(i),o.onblocked=this._fireOnBlocked};if(t)throw new K.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return z(this._allTables).map(t=>this._allTables[t])}transaction(){const t=ki.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,n,r){let i=M.trans;(!i||i.db!==this||-1!==t.indexOf("!"))&&(i=null);const s=-1!==t.indexOf("?");let o,a;t=t.replace("!","").replace("?","");try{if(a=n.map(c=>{var f=c instanceof this.Table?c.name:c;if("string"!=typeof f)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),"r"==t||t===Qt)o=Qt;else{if("rw"!=t&&t!=Zt)throw new K.InvalidArgument("Invalid transaction mode: "+t);o=Zt}if(i){if(i.mode===Qt&&o===Zt){if(!s)throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(c=>{if(i&&-1===i.storeNames.indexOf(c)){if(!s)throw new K.SubTransaction("Table "+c+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(f,u)=>{u(c)}):$(c)}const l=Ri.bind(null,this,o,a,i,r);return i?i._promise(o,l,"lock"):M.trans?Be(M.transless,()=>this._whenReady(l)):this._whenReady(l)}table(t){if(!ie(this._allTables,t))throw new K.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Wi=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Fi{constructor(t){this._subscribe=t}subscribe(t,n,r){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:n,complete:r})}[Wi](){return this}}function cr(e,t){return z(t).forEach(n=>{Rt(e[n]||(e[n]=new me),t[n])}),e}let bn;try{bn={indexedDB:U.indexedDB||U.mozIndexedDB||U.webkitIndexedDB||U.msIndexedDB,IDBKeyRange:U.IDBKeyRange||U.webkitIDBKeyRange}}catch{bn={indexedDB:null,IDBKeyRange:null}}const Re=ke;function Ot(e){let t=pe;try{pe=!0,_e.storagemutated.fire(e)}finally{pe=t}}Te(Re,{...ct,delete:e=>new Re(e,{addons:[]}).delete(),exists:e=>new Re(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function Si({indexedDB:e,IDBKeyRange:t}){return dn(e)?Promise.resolve(e.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==Et)):fn(e,t).toCollection().primaryKeys()}(Re.dependencies).then(e)}catch{return $(new K.MissingAPI)}},defineClass:()=>function e(t){ee(this,t)},ignoreTransaction:e=>M.trans?Be(M.transless,e):e(),vip:mn,async:function(e){return function(){try{var t=pn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:T.resolve(t)}catch(n){return $(n)}}},spawn:function(e,t,n){try{var r=pn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:T.resolve(r)}catch(i){return $(i)}},currentTransaction:{get:()=>M.trans||null},waitFor:function(e,t){const n=T.resolve("function"==typeof e?Re.ignoreTransaction(e):e).timeout(t||6e4);return M.trans?M.trans.waitFor(n):n},Promise:T,debug:{get:()=>ae,set:e=>{kn(e,"dexie"===e?()=>!0:zn)}},derive:De,extend:ee,props:Te,override:En,Events:Ze,on:_e,liveQuery:function Vi(e){return new Fi(t=>{const n=Nt(e);let i=!1,s={},o={};const a={get closed(){return i},unsubscribe:()=>{i=!0,_e.storagemutated.unsubscribe(u)}};t.start&&t.start(a);let l=!1,c=!1;function f(){return z(o).some(d=>s[d]&&function Ki(e,t){const n=vn(t);let r=n.next();if(r.done)return!1;let i=r.value;const s=vn(e);let o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(te(a.from,i.to)<=0&&te(a.to,i.from)>=0)return!0;te(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}(s[d],o[d]))}const u=d=>{cr(s,d),f()&&h()},h=()=>{if(l||i)return;s={};const d={},E=function r(d){n&&Ke();const E=()=>ge(e,{subscr:d,trans:null}),m=M.trans?Be(M.transless,E):E();return n&&m.then(fe,fe),m}(d);c||(_e(nt,u),c=!0),l=!0,Promise.resolve(E).then(m=>{l=!1,!i&&(f()?h():(s={},o=d,t.next&&t.next(m)))},m=>{l=!1,t.error&&t.error(m),a.unsubscribe()})};return h(),a})},extendObservabilitySet:cr,getByKeyPath:ue,setByKeyPath:se,delByKeyPath:function gr(e,t){"string"==typeof t?se(e,t,void 0):"length"in t&&[].map.call(t,function(n){se(e,n,void 0)})},shallowClone:Cn,deepClone:qe,getObjectDiff:yn,cmp:te,asap:Sn,minKey:Xt,addons:[],connections:Qe,errnames:Cr,dependencies:bn,semVer:"3.2.0",version:"3.2.0".split(".").map(e=>parseInt(e)).reduce((e,t,n)=>e+t/Math.pow(10,2*n))}),Re.maxKey=rt(Re.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(_e(nt,e=>{if(!pe){let t;_t?(t=document.createEvent("CustomEvent"),t.initCustomEvent(we,!0,!0,e)):t=new CustomEvent(we,{detail:e}),pe=!0,dispatchEvent(t),pe=!1}}),addEventListener(we,({detail:e})=>{pe||Ot(e)}));let pe=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel(we);_e(nt,t=>{pe||e.postMessage(t)}),e.onmessage=t=>{t.data&&Ot(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){_e(nt,t=>{try{pe||(typeof localStorage<"u"&&localStorage.setItem(we,JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:we,changedParts:t})))}catch{}}),addEventListener("storage",t=>{if(t.key===we){const n=JSON.parse(t.newValue);n&&Ot(n.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function Hi({data:e}){e&&e.type===we&&Ot(e.changedParts)})}T.rejectionMapper=function Ir(e,t){if(!e||e instanceof Me||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Dn[e.name])return e;var n=new Dn[e.name](t||e.message,e);return"stack"in e&&ce(n,"stack",{get:function(){return this.inner.stack}}),n},kn(ae,zn);var P=(()=>{return(e=P||(P={}))[e.ArmorSlotNone=0]="ArmorSlotNone",e[e.ArmorSlotHelmet=1]="ArmorSlotHelmet",e[e.ArmorSlotGauntlet=2]="ArmorSlotGauntlet",e[e.ArmorSlotChest=3]="ArmorSlotChest",e[e.ArmorSlotLegs=4]="ArmorSlotLegs",e[e.ArmorSlotClass=5]="ArmorSlotClass",P;var e})(),x=(()=>{return(e=x||(x={}))[e.PowerfulFriends=0]="PowerfulFriends",e[e.RadiantLight=1]="RadiantLight",e[e.ProtectiveLight=100]="ProtectiveLight",e[e.ExtraReserves=101]="ExtraReserves",e[e.PreciselyCharged=102]="PreciselyCharged",e[e.StacksOnStacks=103]="StacksOnStacks",e[e.PrecisionCharge=104]="PrecisionCharge",e[e.SurpriseAttack=105]="SurpriseAttack",e[e.EnergyConverter=106]="EnergyConverter",e[e.ChargeHarvester=107]="ChargeHarvester",e[e.WhisperOfDurance=1e3]="WhisperOfDurance",e[e.WhisperOfChains=1001]="WhisperOfChains",e[e.WhisperOfConduction=1002]="WhisperOfConduction",e[e.WhisperOfShards=1003]="WhisperOfShards",e[e.WhisperOfHedrons=1100]="WhisperOfHedrons",e[e.WhisperOfBonds=1101]="WhisperOfBonds",e[e.WhisperOfHunger=1102]="WhisperOfHunger",e[e.WhisperOfFractures=1103]="WhisperOfFractures",e[e.EchoOfExpulsion=1200]="EchoOfExpulsion",e[e.EchoOfProvision=1201]="EchoOfProvision",e[e.EchoOfPersistence=1202]="EchoOfPersistence",e[e.EchoOfLeeching=1203]="EchoOfLeeching",e[e.EchoOfDomineering=1204]="EchoOfDomineering",e[e.EchoOfDilation=1205]="EchoOfDilation",e[e.EchoOfUndermining=1206]="EchoOfUndermining",e[e.EchoOfInstability=1207]="EchoOfInstability",e[e.EchoOfHarvest=1208]="EchoOfHarvest",e[e.EchoOfObscurity=1209]="EchoOfObscurity",e[e.EchoOfStarvation=1210]="EchoOfStarvation",e[e.EmberOfBenelovence=1300]="EmberOfBenelovence",e[e.EmberOfBeams=1301]="EmberOfBeams",e[e.EmberOfEmpyrean=1302]="EmberOfEmpyrean",e[e.EmberOfCombustion=1303]="EmberOfCombustion",e[e.EmberOfChar=1304]="EmberOfChar",e[e.EmberOfTempering=1305]="EmberOfTempering",e[e.EmberOfEruption=1306]="EmberOfEruption",e[e.EmberOfWonder=1307]="EmberOfWonder",e[e.EmberOfSearing=1308]="EmberOfSearing",x;var e})(),W=(()=>{return(e=W||(W={}))[e.CombatStyleMod=0]="CombatStyleMod",e[e.Stasis=1]="Stasis",e[e.Void=2]="Void",e[e.Solar=3]="Solar",W;var e})(),Z=(()=>{return(e=Z||(Z={}))[e.NONE=0]="NONE",e[e.MINOR_MOBILITY=1]="MINOR_MOBILITY",e[e.MAJOR_MOBILITY=2]="MAJOR_MOBILITY",e[e.MINOR_RESILIENCE=3]="MINOR_RESILIENCE",e[e.MAJOR_RESILIENCE=4]="MAJOR_RESILIENCE",e[e.MINOR_RECOVERY=5]="MINOR_RECOVERY",e[e.MAJOR_RECOVERY=6]="MAJOR_RECOVERY",e[e.MINOR_DISCIPLINE=7]="MINOR_DISCIPLINE",e[e.MAJOR_DISCIPLINE=8]="MAJOR_DISCIPLINE",e[e.MINOR_INTELLECT=9]="MINOR_INTELLECT",e[e.MAJOR_INTELLECT=10]="MAJOR_INTELLECT",e[e.MINOR_STRENGTH=11]="MINOR_STRENGTH",e[e.MAJOR_STRENGTH=12]="MAJOR_STRENGTH",Z;var e})(),v=(()=>{return(e=v||(v={}))[e.Mobility=0]="Mobility",e[e.Resilience=1]="Resilience",e[e.Recovery=2]="Recovery",e[e.Discipline=3]="Discipline",e[e.Intellect=4]="Intellect",e[e.Strength=5]="Strength",v;var e})();const oe={[Z.NONE]:[v.Strength,0,0,0],[Z.MINOR_MOBILITY]:[v.Mobility,5,1,204137529],[Z.MAJOR_MOBILITY]:[v.Mobility,10,3,3961599962],[Z.MINOR_RESILIENCE]:[v.Resilience,5,1,3682186345],[Z.MAJOR_RESILIENCE]:[v.Resilience,10,3,2850583378],[Z.MINOR_RECOVERY]:[v.Recovery,5,2,555005975],[Z.MAJOR_RECOVERY]:[v.Recovery,10,4,2645858828],[Z.MINOR_DISCIPLINE]:[v.Discipline,5,1,2623485440],[Z.MAJOR_DISCIPLINE]:[v.Discipline,10,3,4048838440],[Z.MINOR_INTELLECT]:[v.Intellect,5,2,1227870362],[Z.MAJOR_INTELLECT]:[v.Intellect,10,5,3355995799],[Z.MINOR_STRENGTH]:[v.Strength,5,1,3699676109],[Z.MAJOR_STRENGTH]:[v.Strength,10,3,3253038666]};var Fe=(()=>{return(e=Fe||(Fe={}))[e.ClassAbilityRegenerationStat=10]="ClassAbilityRegenerationStat",Fe;var e})(),N=(()=>{return(e=N||(N={}))[e.None=0]="None",e[e.SlotNightmare=1]="SlotNightmare",e[e.SlotArtificer=2]="SlotArtificer",e[e.SlotLastWish=3]="SlotLastWish",e[e.SlotGardenOfSalvation=4]="SlotGardenOfSalvation",e[e.SlotDeepStoneCrypt=5]="SlotDeepStoneCrypt",e[e.SlotVaultOfGlass=6]="SlotVaultOfGlass",e[e.PerkIronBanner=7]="PerkIronBanner",e[e.PerkUniformedOfficer=8]="PerkUniformedOfficer",e[e.SlotVowOfTheDisciple=9]="SlotVowOfTheDisciple",e[e.COUNT=10]="COUNT",N;var e})();const qi={[x.PowerfulFriends]:{id:x.PowerfulFriends,name:"Powerful Friends",description:"When you become Charged with Light, nearby allies also become Charged with Light, if they are not already.",type:W.CombatStyleMod,bonus:[{stat:v.Mobility,value:20}],cost:4,requiredArmorAffinity:1,hash:1484685887},[x.RadiantLight]:{id:x.RadiantLight,name:"Radiant Light",description:"Casting your Super causes nearby allies to become Charged with Light.",type:W.CombatStyleMod,bonus:[{stat:v.Strength,value:20}],cost:3,requiredArmorAffinity:1,hash:2979815167},[x.ProtectiveLight]:{id:x.ProtectiveLight,name:"Protective Light",description:"While Charged with Light, you gain significant damage resistance against combatants when your shields are destroyed. This effect consumes all stacks of Charged with Light. The more stacks consumed, the longer the damage resistance lasts.",type:W.CombatStyleMod,bonus:[{stat:v.Strength,value:-10}],cost:2,requiredArmorAffinity:3,hash:3523075120},[x.ExtraReserves]:{id:x.ExtraReserves,name:"Extra Reserves",description:"While Charged with Light, defeating combatants with Void damage grants a chance to drop Special ammo. This effect consumes all stacks of Charged with Light. The more stacks you have, the higher your chance of gaining the ammo drop.",type:W.CombatStyleMod,bonus:[{stat:v.Intellect,value:-10}],cost:3,requiredArmorAffinity:3,hash:3523075121},[x.PreciselyCharged]:{id:x.PreciselyCharged,name:"Precisely Charged",description:"Become Charged with Light by getting multiple rapid precision final blows with Linear Fusion Rifles or Sniper Rifles.",type:W.CombatStyleMod,bonus:[{stat:v.Discipline,value:-10}],cost:1,requiredArmorAffinity:3,hash:3523075122},[x.StacksOnStacks]:{id:x.StacksOnStacks,name:"Stacks on Stacks",description:"Gain an extra stack of Charged with Light for every stack you gain.",type:W.CombatStyleMod,bonus:[{stat:v.Recovery,value:-10}],cost:4,requiredArmorAffinity:3,hash:3523075123},[x.PrecisionCharge]:{id:x.PrecisionCharge,name:"Precision Charge",description:"Become Charged with Light by rapidly defeating combatants with precision kills from Bows, Hand Cannons, and Scout Rifles.",type:W.CombatStyleMod,bonus:[{stat:v.Strength,value:-10}],cost:2,requiredArmorAffinity:3,hash:2263321584},[x.SurpriseAttack]:{id:x.SurpriseAttack,name:"Surprise Attack",description:"While Charged with Light, reloading or readying a Sidearm will consume all stacks of Charged with Light and convert them into stacks of a major damage buff, which are depleted as you damage combatants with that Sidearm.",type:W.CombatStyleMod,bonus:[{stat:v.Intellect,value:-10}],cost:1,requiredArmorAffinity:3,hash:2263321585},[x.EnergyConverter]:{id:x.EnergyConverter,name:"Energy Converter",description:"While Charged with Light, using your grenade attack grants you Super energy, consuming all stacks of Charged with Light. The more stacks you have, the more energy you gain, up to a maximum of 50% of your Super energy.",type:W.CombatStyleMod,bonus:[{stat:v.Discipline,value:-10}],cost:4,requiredArmorAffinity:3,hash:2263321586},[x.ChargeHarvester]:{id:x.ChargeHarvester,name:"Charge Harvester",description:"While you are not Charged with Light, any kill or assist has a small cumulative chance to cause you to become Charged with Light.",type:W.CombatStyleMod,bonus:[{stat:Fe.ClassAbilityRegenerationStat,value:-10}],cost:3,requiredArmorAffinity:3,hash:2263321587},[x.WhisperOfDurance]:{id:x.WhisperOfDurance,name:"Whisper Of Durance",description:"Slow from your abilities lasts longer. For those abilities that linger, their duration will also increase.",type:W.Stasis,bonus:[{stat:v.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:3469412969},[x.WhisperOfChains]:{id:x.WhisperOfChains,name:"Whisper Of Chains",description:"While you are near frozen targets or a friendly Stasis crystal, you take reduced damage from targets.",type:W.Stasis,bonus:[{stat:v.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:537774540},[x.WhisperOfShards]:{id:x.WhisperOfShards,name:"Whisper Of Shards",description:"Shattering a Stasis crystal temporarily boosts your grenade recharge rate. Shattering additional Stasis crystals increases the duration of this benefit.",type:W.Stasis,bonus:[{stat:v.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:3469412975},[x.WhisperOfConduction]:{id:x.WhisperOfConduction,name:"Whisper Of Conduction",description:"Nearby Stasis shards track to your position.",type:W.Stasis,bonus:[{stat:v.Resilience,value:10},{stat:v.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2483898429},[x.WhisperOfBonds]:{id:x.WhisperOfBonds,name:"Whisper of Bonds",description:"Defeating frozen targets grants you Super energy.",type:W.Stasis,bonus:[{stat:v.Discipline,value:-10},{stat:v.Intellect,value:-10}],cost:1,requiredArmorAffinity:0,hash:3469412974},[x.WhisperOfHedrons]:{id:x.WhisperOfHedrons,name:"Whisper of Hedrons",description:"Dramatically increases weapon stability, weapon aim assist, Mobility, Resilience, and Recovery after freezing a target with Stasis.",type:W.Stasis,bonus:[{stat:v.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:3469412970},[x.WhisperOfFractures]:{id:x.WhisperOfFractures,name:"Whisper of Fractures",description:"Your melee energy recharges faster when you are near two or more targets.",type:W.Stasis,bonus:[{stat:v.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:537774542},[x.WhisperOfHunger]:{id:x.WhisperOfHunger,name:"Whisper of Hunger",description:"Increases the melee energy gained from picking up Stasis shards.",type:W.Stasis,bonus:[{stat:v.Mobility,value:-10},{stat:v.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:2483898431},[x.EchoOfExpulsion]:{id:x.EchoOfExpulsion,name:"Echo of Expulsion",description:"Void ability final blows cause targets to explode.",type:W.Void,bonus:[{stat:v.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984665},[x.EchoOfProvision]:{id:x.EchoOfProvision,name:"Echo of Provision",description:"Damaging targets with grenades grants melee energy.",type:W.Void,bonus:[{stat:v.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:2272984664},[x.EchoOfPersistence]:{id:x.EchoOfPersistence,name:"Echo of Persistence",description:"Void buffs applied to you (Invisibility, Overshield, and Devour) have increased duration.",type:W.Void,bonus:[{stat:Fe.ClassAbilityRegenerationStat,value:-10}],cost:1,requiredArmorAffinity:0,hash:2272984671},[x.EchoOfLeeching]:{id:x.EchoOfLeeching,name:"Echo of Leeching",description:"Melee final blows start health regeneration for you and nearby allies.",type:W.Void,bonus:[{stat:v.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984670},[x.EchoOfDomineering]:{id:x.EchoOfDomineering,name:"Echo of Domineering",description:"After suppressing a target, you gain greatly increased Mobility for a short duration and your equipped weapon is reloaded from reserves.",type:W.Void,bonus:[{stat:v.Discipline,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984657},[x.EchoOfDilation]:{id:x.EchoOfDilation,name:"Echo of Dilation",description:"While crouched, you sneak faster and gain enhanced radar resolution.",type:W.Void,bonus:[{stat:v.Mobility,value:10},{stat:v.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984656},[x.EchoOfUndermining]:{id:x.EchoOfUndermining,name:"Echo of Undermining",description:"Your Void grenades weaken targets.",type:W.Void,bonus:[{stat:v.Discipline,value:-20}],cost:1,requiredArmorAffinity:0,hash:2272984668},[x.EchoOfInstability]:{id:x.EchoOfInstability,name:"Echo of Instability",description:"Defeating targets with grenades grants Volatile Rounds to your Void weapons.",type:W.Void,bonus:[{stat:v.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:2661180600},[x.EchoOfObscurity]:{id:x.EchoOfObscurity,name:"Echo of Obscurity",description:"Finisher final blows grant Invisibility.",type:W.Void,bonus:[{stat:v.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:2661180602},[x.EchoOfHarvest]:{id:x.EchoOfHarvest,name:"Echo of Harvest",description:"Defeating weakened targets with precision final blows will create an Orb of Power.",type:W.Void,bonus:[{stat:v.Intellect,value:-10}],cost:1,requiredArmorAffinity:0,hash:2661180601},[x.EchoOfStarvation]:{id:x.EchoOfStarvation,name:"Echo of Starvation",description:"Picking up an Orb of Power grants Devour.",type:W.Void,bonus:[{stat:v.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:2661180603},[x.EmberOfBenelovence]:{id:x.EmberOfBenelovence,name:"Ember of Benelovence",description:"Applying restoration, cure, or radiant to allies grants increased grenade, melee, and class ability regeneration for a short duration.",type:W.Solar,bonus:[{stat:v.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132292},[x.EmberOfBeams]:{id:x.EmberOfBeams,name:"Ember of Beams",description:"Your Solar Super projectiles have stronger target acquisition.",type:W.Solar,bonus:[{stat:v.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:362132295},[x.EmberOfEmpyrean]:{id:x.EmberOfEmpyrean,name:"Ember of Empyrean",description:"Solar weapon or ability final blows extend the duration of restoration and radiant effects applied to you.",type:W.Solar,bonus:[{stat:v.Resilience,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132294},[x.EmberOfCombustion]:{id:x.EmberOfCombustion,name:"Ember of Combustion",description:"Final blows with your Solar Super cause targets to ignite.",type:W.Solar,bonus:[{stat:v.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:362132289},[x.EmberOfChar]:{id:x.EmberOfChar,name:"Ember of Char",description:"Your Solar ignitions spread scorch to affected targets.",type:W.Solar,bonus:[{stat:v.Discipline,value:10}],cost:1,requiredArmorAffinity:0,hash:362132291},[x.EmberOfTempering]:{id:x.EmberOfTempering,name:"Ember of Tempering",description:"Solar weapon final blows grant you and your allies increased recovery for a short duration. Stacks 3 times.\nWhile Ember of Tempering is active, your weapons have increased airborne effectiveness.",type:W.Solar,bonus:[{stat:v.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132290},[x.EmberOfEruption]:{id:x.EmberOfEruption,name:"Ember of Eruption",description:"Your Solar ignitions have increased area of effect.",type:W.Solar,bonus:[{stat:v.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276348},[x.EmberOfWonder]:{id:x.EmberOfWonder,name:"Ember of Wonder",description:"Rapidly defeating multiple targets with Solar ignitions generates an Orb of Power.",type:W.Solar,bonus:[{stat:v.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276350},[x.EmberOfSearing]:{id:x.EmberOfSearing,name:"Ember of Searing",description:"Defeating scorched targets grants melee energy.",type:W.Solar,bonus:[{stat:v.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276351}};Array.prototype.addSorted=function(e){var r,t=0,n=this.length,i=!1;if(e>this[n])return this.push(e),this;if(e<this[t])return this.splice(t,0,e),this;for(;0==i;)e>this[r=~~((t+n)/2)]?t=r:n=r,n-t<=1&&(this.splice(n,0,e),i=!0);return this},Array.prototype.where=Array.prototype.where||function(e){for(var t=[],n=this.length,r=0;r<n;r++){var i=this[r];e(i)&&t.push(i)}return t};const hr=function ji(e){const t=new ke("d2armorpicker-v2");return t.version(16).stores({manifestArmor:"id++, hash, isExotic",inventoryArmor:"id++, itemInstanceId, isExotic, hash, name, masterworked, clazz"}).upgrade(function(){var n=ot(function*(r){yield e()});return function(r){return n.apply(this,arguments)}}()),t}(ot(function*(){})),Ui=hr.table("inventoryArmor"),Gi=hr.table("manifestArmor");class Oe{constructor(t){this.items=[],this.mobility={min:0,max:0,sum:0},this.resilience={min:0,max:0,sum:0},this.recovery={min:0,max:0,sum:0},this.discipline={min:0,max:0,sum:0},this.intellect={min:0,max:0,sum:0},this.strength={min:0,max:0,sum:0},this.containsExotics=!1,this.containsLegendaries=!1,this.allMasterworked=!1,this.elements=[],this.perks=[],this.allSameElement=!0,this.items=t;const n=this.items.map(l=>l.mobility),r=this.items.map(l=>l.resilience),i=this.items.map(l=>l.recovery),s=this.items.map(l=>l.discipline),o=this.items.map(l=>l.intellect),a=this.items.map(l=>l.strength);this.mobility.min=Math.min(...n),this.mobility.sum=n.reduce((l,c)=>l+c,0),this.resilience.min=Math.min(...r),this.resilience.sum=r.reduce((l,c)=>l+c,0),this.recovery.min=Math.min(...i),this.recovery.sum=i.reduce((l,c)=>l+c,0),this.discipline.min=Math.min(...s),this.discipline.sum=s.reduce((l,c)=>l+c,0),this.intellect.min=Math.min(...o),this.intellect.sum=o.reduce((l,c)=>l+c,0),this.strength.min=Math.min(...a),this.strength.sum=a.reduce((l,c)=>l+c,0),this.containsExotics=this._containsExotics,this.containsLegendaries=this._containsLegendaries,this.allMasterworked=this._allMasterworked,this.elements=t.map(l=>l.energyAffinity),this.perks=t.map(l=>l.perk),this.allSameElement=1==new Set(t).size}get _containsExotics(){return this.items.filter(t=>t.isExotic).length>0}get _containsLegendaries(){return this.items.filter(t=>!t.isExotic).length>0}get _allMasterworked(){return this.items.filter(t=>t.masterworked).length==this.items.length}}function Yi(e,t,n,r,i,s,o){let a=t.slice(),l=a[0];r.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!r.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[r.elements[0]]--,i.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!i.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[i.elements[0]]--,s.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!s.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[s.elements[0]]--,o.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!o.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[o.elements[0]]--;let c=Math.max(0,a[1])+Math.max(0,a[2])+Math.max(0,a[3])+Math.max(0,a[6])-l;var f=0;if(e.armorAffinities[P.ArmorSlotClass].fixed&&(f=e.armorAffinities[P.ArmorSlotClass].value),1==c&&(!e.armorAffinities[P.ArmorSlotClass].fixed||0==e.armorAffinities[P.ArmorSlotClass].value)){var u=!1;for(let h of[3,6,2,1])a[h]<=0||n.has(h)&&(u=!0,f=h);u&&c--}return{valid:c<=0,requiredClassItemElement:f}}function zi(e,t,n,r,i,s,o){var a=e.selectedExotics[0]||0;let l=t.slice();if((a<=0||r.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotHelmet].fixed&&e.armorPerks[P.ArmorSlotHelmet].value!=N.None&&e.armorPerks[P.ArmorSlotHelmet].value!=r.perks[0])return{valid:!1};if((a<=0||i.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotGauntlet].fixed&&e.armorPerks[P.ArmorSlotGauntlet].value!=N.None&&e.armorPerks[P.ArmorSlotGauntlet].value!=i.perks[0])return{valid:!1};if((a<=0||s.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotChest].fixed&&e.armorPerks[P.ArmorSlotChest].value!=N.None&&e.armorPerks[P.ArmorSlotChest].value!=s.perks[0])return{valid:!1};if((a<=0||o.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotLegs].fixed&&e.armorPerks[P.ArmorSlotLegs].value!=N.None&&e.armorPerks[P.ArmorSlotLegs].value!=o.perks[0])return{valid:!1};if(e.armorPerks[P.ArmorSlotClass].fixed&&e.armorPerks[P.ArmorSlotClass].value!=N.None&&!n.has(e.armorPerks[P.ArmorSlotClass].value))return{valid:!1};l[r.perks[0]]--,l[i.perks[0]]--,l[s.perks[0]]--,l[o.perks[0]]--,a>0&&(r.items[0].hash==a?l[e.armorPerks[r.items[0].slot].value]--:i.items[0].hash==a?l[e.armorPerks[i.items[0].slot].value]--:s.items[0].hash==a?l[e.armorPerks[s.items[0].slot].value]--:o.items[0].hash==a&&l[e.armorPerks[o.items[0].slot].value]--);let c=0;for(let h=1;h<N.COUNT;h++)c+=Math.max(0,l[h]);var f=N.None;if(1==c){var u=!1;for(let h=1;h<N.COUNT&&!u;h++)l[h]<=0||n.has(h)&&(u=!0,f=h);u&&c--}else f==N.None&&e.armorPerks[P.ArmorSlotClass].fixed&&(f=e.armorPerks[P.ArmorSlotClass].value);return{valid:c<=0,requiredClassItemType:f}}addEventListener("message",function(){var e=ot(function*({data:t}){const n=Date.now();console.debug("START RESULTS BUILDER 2"),console.time("total");const r=t.config;console.log("Using config",t.config);let i=yield Promise.all(r.selectedExotics.filter(g=>-1!=g).map(function(){var g=ot(function*(V){return yield Gi.where("hash").equals(V).first()});return function(V){return g.apply(this,arguments)}}()));i=i.filter(g=>!!g);let s=yield Ui.where("clazz").equals(r.characterClass).distinct().toArray();s=s.filter(g=>g.slot!=P.ArmorSlotNone).filter(g=>-1==r.disabledItems.indexOf(g.itemInstanceId)).filter(g=>-1==r.selectedExotics.indexOf(-1)||!g.isExotic).filter(g=>1!=i.length||i[0].slot!=g.slot||i[0].hash==g.hash).filter(g=>!r.onlyUseMasterworkedItems||g.masterworked).filter(g=>r.allowBlueArmorPieces||6==g.rarity||5==g.rarity).filter(g=>!r.ignoreSunsetArmor||!g.isSunset).filter(g=>!r.armorAffinities[g.slot].fixed||0==r.armorAffinities[g.slot].value||g.masterworked&&r.ignoreArmorAffinitiesOnMasterworkedItems||!g.masterworked&&r.ignoreArmorAffinitiesOnNonMasterworkedItems||r.armorAffinities[g.slot].value==g.energyAffinity).filter(g=>g.isExotic||!r.armorPerks[g.slot].fixed||r.armorPerks[g.slot].value==N.None||r.armorPerks[g.slot].value==g.perk);let o=s.filter(g=>g.slot==P.ArmorSlotHelmet).map(g=>new Oe([g])),a=s.filter(g=>g.slot==P.ArmorSlotGauntlet).map(g=>new Oe([g])),l=s.filter(g=>g.slot==P.ArmorSlotChest).map(g=>new Oe([g])),c=s.filter(g=>g.slot==P.ArmorSlotLegs).map(g=>new Oe([g]));const f=t.threadSplit;if(f.count>1){var u=[[o,o.length],[a,a.length],[l,l.length],[c,c.length]].sort((g,V)=>g[1]-V[1])[0][0],h=Math.floor(u.length/f.count),d=h*f.current,E=h*(f.current+1);h*f.count!=u.length&&f.current==f.count-1&&(E+=u.length-h*f.count),u.splice(E),u.splice(0,d)}let m=s.filter(g=>g.slot==P.ArmorSlotClass),_=new Set(m.map(g=>g.perk)),y=Array.from(_).reduce((g,V)=>{g.has(V)||g.set(V,new Set),g.has(N.None)||g.set(N.None,new Set);for(let H of m.filter(L=>L.perk==V))g.get(N.None)?.add(H.energyAffinity),g.get(V)?.add(H.energyAffinity);return g},new Map);if(i.length>1){let g=[...new Set(i.map(L=>L.slot))],V=s.filter(L=>L.hash==i[0].hash),H=s.filter(L=>L.hash==i[1].hash);if(1==g.length){let L=[];for(let F of V)for(let J of H)L.push(new Oe([F,J]));switch(g[0]){case P.ArmorSlotHelmet:o=L,a=a.filter(F=>!F.containsExotics),l=l.filter(F=>!F.containsExotics),c=c.filter(F=>!F.containsExotics);break;case P.ArmorSlotGauntlet:a=L,o=o.filter(F=>!F.containsExotics),l=l.filter(F=>!F.containsExotics),c=c.filter(F=>!F.containsExotics);break;case P.ArmorSlotChest:l=L,o=o.filter(F=>!F.containsExotics),a=a.filter(F=>!F.containsExotics),c=c.filter(F=>!F.containsExotics);break;case P.ArmorSlotLegs:c=L,o=o.filter(F=>!F.containsExotics),a=a.filter(F=>!F.containsExotics),l=l.filter(F=>!F.containsExotics)}}else if(2==g.length){let L=s.filter(Y=>Y.slot==i[0].slot&&!Y.isExotic),F=s.filter(Y=>Y.slot==i[1].slot&&!Y.isExotic),J=[],ne=[];for(let Y of V)for(let Ve of F)J.push(new Oe([Y,Ve]));for(let Y of H)for(let Ve of L)ne.push(new Oe([Y,Ve]));o=o.filter(Y=>!Y.containsExotics),a=a.filter(Y=>!Y.containsExotics),l=l.filter(Y=>!Y.containsExotics),c=c.filter(Y=>!Y.containsExotics),g[0]===P.ArmorSlotHelmet?o=J:g[0]===P.ArmorSlotGauntlet?a=J:g[0]===P.ArmorSlotChest?l=J:g[0]===P.ArmorSlotLegs&&(c=J),g[1]===P.ArmorSlotHelmet?o=ne:g[1]===P.ArmorSlotGauntlet?a=ne:g[1]===P.ArmorSlotChest?l=ne:g[1]===P.ArmorSlotLegs&&(c=ne)}}console.debug("items",{helmets:o,gauntlets:a,chests:l,legs:c,availableClassItemTypes:_,availableClassItemEnergyPerkDict:y});const I={maximumPossibleTiers:[0,0,0,0,0,0],statCombo3x100:new Set,statCombo4x100:new Set},S=function $i(e){const t=[0,0,0,0,0,0];for(const r of e.enabledMods)for(const i of qi[r].bonus)t[i.stat==Fe.ClassAbilityRegenerationStat?[1,0,2][e.characterClass]:i.stat]+=i.value;return t}(r),w=function Ji(e){let t=[0,0,0,0,0,0,0];return t[e.armorAffinities[P.ArmorSlotHelmet].value]++,t[e.armorAffinities[P.ArmorSlotChest].value]++,t[e.armorAffinities[P.ArmorSlotGauntlet].value]++,t[e.armorAffinities[P.ArmorSlotLegs].value]++,e.armorAffinities[P.ArmorSlotClass].fixed||t[e.armorAffinities[P.ArmorSlotClass].value]++,t[0]=0,t}(r),k=function Xi(e){let t=[];for(let n=0;n<N.COUNT;n++)t.push(0);return t[e.armorPerks[P.ArmorSlotHelmet].value]++,t[e.armorPerks[P.ArmorSlotChest].value]++,t[e.armorPerks[P.ArmorSlotGauntlet].value]++,t[e.armorPerks[P.ArmorSlotLegs].value]++,t[e.armorPerks[P.ArmorSlotClass].value]++,t}(r),R=function Qi(e){var t=[];return t.push(e.maximumModSlots[P.ArmorSlotHelmet].value),t.push(e.maximumModSlots[P.ArmorSlotGauntlet].value),t.push(e.maximumModSlots[P.ArmorSlotChest].value),t.push(e.maximumModSlots[P.ArmorSlotLegs].value),t.push(e.maximumModSlots[P.ArmorSlotClass].value),t.where(n=>n>0).sort()}(r),D=w[0]<5,b=i.length<=1;let p=[],A=0,O=0,B=0,C=!1;console.time("tm");for(let g of o)for(let V of a)if(!(b&&g.containsExotics&&V.containsExotics))for(let H of l)if(!b||!g.containsExotics&&!V.containsExotics||!H.containsExotics)for(let L of c){if(b&&(g.containsExotics||V.containsExotics||H.containsExotics)&&L.containsExotics)continue;const F=zi(r,k,_,g,V,H,L);if(!F.valid)continue;var j=0;if(D){const ne=Yi(r,w,y.get(F.requiredClassItemType??N.None)??new Set,g,V,H,L);if(!ne.valid)continue;j=ne.requiredClassItemElement}const J=ts(I,r,g,V,H,L,S,R.slice(),C);null!=J&&(B++,"DONOTSEND"!==J&&(J.classItem={perk:F.requiredClassItemType??N.None,affinity:j},p.push(J),A++,O++,C=C||r.limitParsedResults&&O>=5e4/f.count||O>=1e6/f.count)),A>=5e3&&(postMessage({runtime:I,results:p,done:!1,total:0}),p=[],A=0)}console.timeEnd("tm"),console.timeEnd("total"),postMessage({runtime:I,results:p,done:!0,stats:{permutationCount:B,itemCount:s.length-m.length,totalTime:Date.now()-n}})});return function(t){return e.apply(this,arguments)}}());class es{constructor(t){this.list=[],this.comparatorList=[],this.length=0,this.comparator=t}insert(t){let r,n=this.comparator(t);for(r=0;r<this.list.length&&this.comparatorList[r]>n;r++);this.length++,this.list.splice(r,0,t),this.comparatorList.splice(r,0,n)}remove(t){let n=-1;for(let r=0;r<this.list.length;r++)if(this.list[r]==t){n=r;break}-1!=n&&(this.list.splice(n,1),this.comparatorList.splice(n,1),this.length--)}}function ts(e,t,n,r,i,s,o,a,l=!1){const c=[n,r,i,s];var f=t.assumeClassItemMasterworked?2:0;for(let b=0;b<c.length;b++){let p=c[b];(p.allMasterworked||p.containsExotics&&!p.containsLegendaries&&t.assumeExoticsMasterworked||!p.containsExotics&&p.containsLegendaries&&t.assumeLegendariesMasterworked||p.containsExotics&&p.containsLegendaries&&t.assumeLegendariesMasterworked&&t.assumeExoticsMasterworked)&&(f+=2)}const u=function Zi(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].items.length>1?1:0;if(t<=1)return[e[0].mobility.min+e[1].mobility.min+e[2].mobility.min+e[3].mobility.min,e[0].resilience.min+e[1].resilience.min+e[2].resilience.min+e[3].resilience.min,e[0].recovery.min+e[1].recovery.min+e[2].recovery.min+e[3].recovery.min,e[0].discipline.min+e[1].discipline.min+e[2].discipline.min+e[3].discipline.min,e[0].intellect.min+e[1].intellect.min+e[2].intellect.min+e[3].intellect.min,e[0].strength.min+e[1].strength.min+e[2].strength.min+e[3].strength.min];{let n=e.filter(i=>1==i.items.length),r=e.filter(i=>i.items.length>1).reduce((i,s)=>(i[0]=s.mobility.sum<i[0]?s.mobility.sum:i[0],i[1]=s.resilience.sum<i[1]?s.resilience.sum:i[1],i[2]=s.recovery.sum<i[2]?s.recovery.sum:i[2],i[3]=s.discipline.sum<i[3]?s.discipline.sum:i[3],i[4]=s.intellect.sum<i[4]?s.intellect.sum:i[4],i[5]=s.strength.sum<i[5]?s.strength.sum:i[5],i),[200,200,200,200,200,200]);for(let i of n)r[0]+=i.mobility.min,r[1]+=i.resilience.min,r[2]+=i.recovery.min,r[3]+=i.discipline.min,r[4]+=i.intellect.min,r[5]+=i.strength.min;return r}}(c);u[0]+=f,u[1]+=f+(!c[2].containsExotics&&t.addConstent1Resilience?1:0),u[2]+=f,u[3]+=f,u[4]+=f,u[5]+=f;const h=[u[0],u[1],u[2],u[3],u[4],u[5]];u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],u[3]+=o[3],u[4]+=o[4],u[5]+=o[5];for(let b=0;b<6;b++)if(t.minimumStatTiers[b].fixed&&u[b]/10>=t.minimumStatTiers[b].value+1)return null;const d=[Math.ceil(Math.max(0,t.minimumStatTiers[0].value-u[0]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[1].value-u[1]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[2].value-u[2]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[3].value-u[3]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[4].value-u[4]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[5].value-u[5]/10))],E=d[0]+d[1]+d[2]+d[3]+d[4]+d[5],m=new es(b=>oe[b][2]);if(E>5)return null;let _=a.length;if(E>_)return null;if(E>0){for(let b=0;b<6;b++){if(0==d[b])continue;const p=u[b]%10;p>0&&p%10>=5&&(m.insert(1+2*b),d[b]--,u[b]+=5);for(let A=0;A<d[b];A++)m.insert(2+2*b),u[b]+=10}for(let b=0;b<m.length&&m.length<=5;b++){const p=m.list[b],A=oe[p][2],O=a.where(B=>B>=A);if(0==O.length){if(p%2!=0)return null;{m.remove(p);let B=p-1;m.insert(B),m.insert(B),b--}}else a.splice(a.indexOf(O[0]),1),_--}}if(m.length>5)return null;if(t.onlyShowResultsWithNoWastedStats){if(u.where(A=>A>100).length>0||u.where(A=>A%5!=0).length>0)return null;let b=[u[v.Mobility],u[v.Resilience],u[v.Recovery],u[v.Discipline],u[v.Intellect],u[v.Strength]].map((A,O)=>[A%10,O,A]).sort((A,O)=>O[0]-A[0]);for(let A=_-1;A>=0;A--){let O=b.where(C=>a.filter(j=>j>=oe[1+2*C[1]][2]).length>0).where(C=>C[0]>=5&&C[2]<100).sort((C,j)=>C[0]-j[0])[0];if(!O)break;const B=a.where(C=>C>=oe[1+2*O[1]][2])[0];a.splice(a.indexOf(B),1),_--,u[O[1]]+=5,O[0]-=5,m.insert(1+2*O[1])}if(fr(u)>0)return null}if(m.length>5)return null;const y=10*_,I=100-10*_,S=[];for(let b=0;b<6;b++){let p=u[b];if(p>=I&&S.push([b,100-p]),p+y>=e.maximumPossibleTiers[b]){let A=oe[1+2*b][2],O=oe[2+2*b][2];for(let B=0;B<_&&p<100;B++)a[B]>=O&&(p+=10),a[B]>=A&&a[B]<O&&(p+=5);p>e.maximumPossibleTiers[b]&&(e.maximumPossibleTiers[b]=p)}}if(_>0&&S.length>=3){S.sort((p,A)=>p[1]-A[1]);const b=[];for(let p=0;p<S.length-2;p++){let A=~~((Math.max(0,S[p][1],0)+9)/10);if(A>_)break;for(let O=p+1;O<S.length-1;O++){let B=~~((Math.max(0,S[O][1],0)+9)/10);if(A+B>_)break;for(let C=O+1;C<S.length;C++){let j=~~((Math.max(0,S[C][1],0)+9)/10);if(A+B+j>_)break;var w=!1;for(let g=C+1;g<S.length&&!(A+B+j+~~((Math.max(0,S[g][1],0)+9)/10)>_);g++)b.push([S[p],S[O],S[C],S[g]]),w=!0;w||b.push([S[p],S[O],S[C]])}}}for(let p of b){var k=[0,0,0,0,0,0];let A=0;for(let C=0;C<p.length;C++){if(p[C][1]<=0)continue;const j=p[C],g=j[0];let V=oe[1+2*g][2],H=oe[2+2*g][2];const L=Math.max(0,j[1]);let F=~~(L/10),J=L%10;J>5?F++:J>0&&(k[V]++,A++);for(let ne=0;ne<F;ne++)k[H]++,A++}const O=[0,0,0,1,2,2],B=[!1,!1,!1,!1,!1];if(!(A>_)){for(let C=5;C>=3;C--){let j=k[C];if(0==j)continue;let g=a.map((H,L)=>[H,L]).filter(([H,L])=>!B[L]&&H>=C),V=j;for(let H=0;H<V&&H<g.length;H++)B[g[H][1]]=!0,j--;for(let H=0;H<j;H++)k[C]--,k[O[C]]+=2,A++;if(A>_)break}A<=_&&(e.statCombo3x100.add((1<<p[0][0])+(1<<p[1][0])+(1<<p[2][0])),p.length>3&&e.statCombo4x100.add((1<<p[0][0])+(1<<p[1][0])+(1<<p[2][0])+(1<<p[3][0])))}}}if(l)return"DONOTSEND";if(t.tryLimitWastedStats&&_>0){let b=[u[v.Mobility],u[v.Resilience],u[v.Recovery],u[v.Discipline],u[v.Intellect],u[v.Strength]].map((p,A)=>[p%10,A,p]).sort((p,A)=>A[0]-p[0]);for(let p=0;p<_;p++){let A=b.where(B=>a.where(C=>C>=oe[1+2*B[1]][2]).length>0).filter(B=>B[0]>=5&&B[2]<100).sort((B,C)=>B[0]-C[0])[0];if(!A)break;if(t.minimumStatTiers[A[1]].fixed&&(u[A[1]]+5)/10>=t.minimumStatTiers[A[1]].value+1){A[0]-=5;continue}const O=a.where(B=>B>=oe[1+2*A[1]][2])[0];a.splice(a.indexOf(O),1),_--,u[A[1]]+=5,A[0]-=5,m.insert(1+2*A[1])}}const R=fr(u);if(t.onlyShowResultsWithNoWastedStats&&R>0)return null;const D=n.containsExotics?n:r.containsExotics?r:i.containsExotics?i:s.containsExotics?s:null;return{exotic:null==D?[]:[{icon:D?.items[0].icon,watermark:D?.items[0].watermarkIcon,name:D?.items[0].name,hash:D?.items[0].hash}],modCount:m.length,modCost:m.list.reduce((b,p)=>b+oe[p][2],0),mods:m.list,stats:u,statsNoMods:h,tiers:ns(u),waste:R,items:c.map(b=>b.items).flat().reduce((b,p)=>(b[p.slot-1].push({energy:p.energyAffinity,energyLevel:p.energyLevel,hash:p.hash,itemInstanceId:p.itemInstanceId,name:p.name,exotic:!!p.isExotic,masterworked:p.masterworked,mayBeBugged:p.mayBeBugged,slot:p.slot,perk:p.perk,transferState:0,stats:[p.mobility,p.resilience,p.recovery,p.discipline,p.intellect,p.strength]}),b),[[],[],[],[]])}}function ns(e){return Math.floor(Math.min(100,e[v.Mobility])/10)+Math.floor(Math.min(100,e[v.Resilience])/10)+Math.floor(Math.min(100,e[v.Recovery])/10)+Math.floor(Math.min(100,e[v.Discipline])/10)+Math.floor(Math.min(100,e[v.Intellect])/10)+Math.floor(Math.min(100,e[v.Strength])/10)}function fr(e){return(e[v.Mobility]>100?e[v.Mobility]-100:e[v.Mobility]%10)+(e[v.Resilience]>100?e[v.Resilience]-100:e[v.Resilience]%10)+(e[v.Recovery]>100?e[v.Recovery]-100:e[v.Recovery]%10)+(e[v.Discipline]>100?e[v.Discipline]-100:e[v.Discipline]%10)+(e[v.Intellect]>100?e[v.Intellect]-100:e[v.Intellect]%10)+(e[v.Strength]>100?e[v.Strength]-100:e[v.Strength]%10)}})();