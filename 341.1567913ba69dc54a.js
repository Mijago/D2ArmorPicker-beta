(()=>{"use strict";function _n(e,t,n,r,s,i,o){try{var a=e[i](o),l=a.value}catch(u){return void n(u)}a.done?t(l):Promise.resolve(l).then(r,s)}function it(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var i=e.apply(t,n);function o(l){_n(i,r,s,o,a,"next",l)}function a(l){_n(i,r,s,o,a,"throw",l)}o(void 0)})}}const H=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Y=Object.keys,$=Array.isArray;function X(e,t){return"object"!=typeof t||Y(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise<"u"&&!H.Promise&&(H.Promise=Promise);const We=Object.getPrototypeOf,mr={}.hasOwnProperty;function ne(e,t){return mr.call(e,t)}function Oe(e,t){"function"==typeof t&&(t=t(We(e))),(typeof Reflect>"u"?Y:Reflect.ownKeys)(t).forEach(n=>{le(e,n,t[n])})}const En=Object.defineProperty;function le(e,t,n,r){En(e,t,X(n&&ne(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function De(e){return{from:function(t){return e.prototype=Object.create(t.prototype),le(e.prototype,"constructor",e),{extend:Oe.bind(null,e.prototype)}}}}const pr=Object.getOwnPropertyDescriptor;function Dt(e,t){let r;return pr(e,t)||(r=We(e))&&Dt(r,t)}const gr=[].slice;function ot(e,t,n){return gr.call(e,t,n)}function Sn(e,t){return t(e)}function Ve(e){if(!e)throw new Error("Assertion Failed")}function Cn(e){H.setImmediate?setImmediate(e):setTimeout(e,0)}function Rn(e,t){return e.reduce((n,r,s)=>{var i=t(r,s);return i&&(n[i[0]]=i[1]),n},{})}function ce(e,t){if(ne(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,s=t.length;r<s;++r){var i=ce(e,t[r]);n.push(i)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:ce(a,t.substr(o+1))}}function re(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){Ve("string"!=typeof n&&"length"in n);for(var r=0,s=t.length;r<s;++r)re(e,t[r],n[r])}else{var i=t.indexOf(".");if(-1!==i){var o=t.substr(0,i),a=t.substr(i+1);if(""===a)void 0===n?$(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var l=e[o];l||(l=e[o]={}),re(l,a,n)}}else void 0===n?$(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function xn(e){var t={};for(var n in e)ne(e,n)&&(t[n]=e[n]);return t}const br=[].concat;function In(e){return br.apply([],e)}const An="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(In([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>H[e]),wr=An.map(e=>H[e]);Rn(An,e=>[e,!0]);let ge=null;function qe(e){ge=typeof WeakMap<"u"&&new WeakMap;const t=Pt(e);return ge=null,t}function Pt(e){if(!e||"object"!=typeof e)return e;let t=ge&&ge.get(e);if(t)return t;if($(e)){t=[],ge&&ge.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Pt(e[n]))}else if(wr.indexOf(e.constructor)>=0)t=e;else{const i=We(e);for(var s in t=i===Object.prototype?{}:Object.create(i),ge&&ge.set(e,t),e)ne(e,s)&&(t[s]=Pt(e[s]))}return t}const{toString:_r}={};function Nt(e){return _r.call(e).slice(8,-1)}const Kt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Er="symbol"==typeof Kt?function(e){var t;return null!=e&&(t=e[Kt])&&t.apply(e)}:function(){return null},Pe={};function ue(e){var t,n,r,s;if(1===arguments.length){if($(e))return e.slice();if(this===Pe&&"string"==typeof e)return[e];if(s=Er(e)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const Bt=typeof Symbol<"u"?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var ie=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function kn(e,t){ie=e,Tn=t}var Tn=()=>!0;const Sr=!new Error("").stack;function Ee(){if(Sr)try{throw new Error}catch(e){return e}return new Error}function Lt(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(Tn).map(r=>"\n"+r).join("")):""}var On=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Mt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(On),Rr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ne(e,t){this._e=Ee(),this.name=e,this.message=t}function Dn(e,t){return e+". Errors: "+Object.keys(t).map(n=>t[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join("\n")}function at(e,t,n,r){this._e=Ee(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Dn(e,t)}function je(e,t){this._e=Ee(),this.name="BulkError",this.failures=Object.keys(t).map(n=>t[n]),this.failuresByPos=t,this.message=Dn(e,t)}De(Ne).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Lt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),De(at).from(Ne),De(je).from(Ne);var xr=Mt.reduce((e,t)=>(e[t]=t+"Error",e),{});const Ir=Ne;var B=Mt.reduce((e,t)=>{var n=t+"Error";function r(s,i){this._e=Ee(),this.name=n,s?"string"==typeof s?(this.message=`${s}${i?"\n "+i:""}`,this.inner=i||null):"object"==typeof s&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=Rr[t]||n,this.inner=null)}return De(r).from(Ir),e[t]=r,e},{});B.Syntax=SyntaxError,B.Type=TypeError,B.Range=RangeError;var Pn=On.reduce((e,t)=>(e[t+"Error"]=B[t],e),{}),lt=Mt.reduce((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=B[t]),e),{});function q(){}function He(e){return e}function kr(e,t){return null==e||e===He?t:function(n){return t(e(n))}}function Se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Tr(e,t){return e===q?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Se(r,this.onsuccess):r),s&&(this.onerror=this.onerror?Se(s,this.onerror):s),void 0!==i?i:n}}function Or(e,t){return e===q?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Se(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Se(r,this.onerror):r)}}function Dr(e,t){return e===q?t:function(n){var r=e.apply(this,arguments);X(n,r);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?Se(s,this.onsuccess):s),i&&(this.onerror=this.onerror?Se(i,this.onerror):i),void 0===r?void 0===o?void 0:o:X(r,o)}}function Pr(e,t){return e===q?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Ft(e,t){return e===q?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return n.then(function(){return t.apply(r,i)})}return t.apply(this,arguments)}}lt.ModifyError=at,lt.DexieError=Ne,lt.BulkError=je;var Ue={};const[Wt,ct,Vt]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,We(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,We(t),e]})(),Kn=ct&&ct.then,ut=Wt&&Wt.constructor,qt=!!Vt;var jt=!1,Br=Vt?()=>{Vt.then(mt)}:H.setImmediate?setImmediate.bind(null,mt):H.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{mt(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(mt,0)},Ge=function(e,t){Ye.push([e,t]),ht&&(Br(),ht=!1)},Ht=!0,ht=!0,Ce=[],ft=[],Ut=null,Gt=He,Ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Un,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{Un(e[0],e[1])}catch{}})}},N=Ke,Ye=[],Re=0,dt=[];function A(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=q,this._lib=!1;var t=this._PSD=N;if(ie&&(this._stackHolder=Ee(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Ue)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&zt(this,this._value))}this._state=null,this._value=null,++t.ref,Ln(this,e)}const Yt={get:function(){var e=N,t=yt;function n(r,s){var i=!e.global&&(e!==N||t!==yt);const o=i&&!he();var a=new A((l,u)=>{$t(this,new Bn(bt(r,e,i,o),bt(s,e,i,o),l,u,e))});return ie&&Wn(a,this),a}return n.prototype=Ue,n},set:function(e){le(this,"then",e&&e.prototype===Ue?Yt:{get:function(){return e},set:Yt.set})}};function Bn(e,t,n,r,s){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=s}function Ln(e,t){try{t(n=>{if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&ze();n&&"function"==typeof n.then?Ln(e,(s,i)=>{n instanceof A?n._then(s,i):n.then(s,i)}):(e._state=!0,e._value=n,Mn(e)),r&&$e()}},zt.bind(null,e))}catch(n){zt(e,n)}}function zt(e,t){if(ft.push(t),null===e._state){var n=e._lib&&ze();t=Gt(t),e._state=!1,e._value=t,ie&&null!==t&&"object"==typeof t&&!t._promise&&function yr(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}(()=>{var r=Dt(t,"stack");t._promise=e,le(t,"stack",{get:()=>jt?r&&(r.get?r.get.apply(t):r.value):e.stack})}),function Fr(e){Ce.some(t=>t._value===e._value)||Ce.push(e)}(e),Mn(e),n&&$e()}}function Mn(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)$t(e,t[n]);var s=e._PSD;--s.ref||s.finalize(),0===Re&&(++Re,Ge(()=>{0==--Re&&Jt()},[]))}function $t(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Re,Ge(Lr,[n,e,t])}else e._listeners.push(t)}function Lr(e,t,n){try{Ut=t;var r,s=t._value;t._state?r=e(s):(ft.length&&(ft=[]),r=e(s),-1===ft.indexOf(s)&&function Wr(e){for(var t=Ce.length;t;)if(Ce[--t]._value===e._value)return void Ce.splice(t,1)}(t)),n.resolve(r)}catch(i){n.reject(i)}finally{Ut=null,0==--Re&&Jt(),--n.psd.ref||n.psd.finalize()}}function Fn(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,o,s=e._value;null!=s?(i=s.name||"Error",o=s.message||s,r=Lt(s,0)):(i=s,o=""),t.push(i+(o?": "+o:"")+r)}return ie&&((r=Lt(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Fn(e._prev,t,n)),t}function Wn(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function mt(){ze()&&$e()}function ze(){var e=Ht;return Ht=!1,ht=!1,e}function $e(){var e,t,n;do{for(;Ye.length>0;)for(e=Ye,Ye=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Ye.length>0);Ht=!0,ht=!0}function Jt(){var e=Ce;Ce=[],e.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var t=dt.slice(0),n=t.length;n;)t[--n]()}function pt(e){return new A(Ue,!1,e)}function U(e,t){var n=N;return function(){var r=ze(),s=N;try{return ve(n,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{ve(s,!1),r&&$e()}}}Oe(A.prototype,{then:Yt,_then:function(e,t){$t(this,new Bn(null,null,e,t,N))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return this.then(null,"function"==typeof t?r=>r instanceof t?n(r):pt(r):r=>r&&r.name===t?n(r):pt(r))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),pt(t)))},stack:{get:function(){if(this._stack)return this._stack;try{jt=!0;var t=Fn(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{jt=!1}}},timeout:function(e,t){return e<1/0?new A((n,r)=>{var s=setTimeout(()=>r(new B.Timeout(t)),e);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&le(A.prototype,Symbol.toStringTag,"Dexie.Promise"),Ke.env=Vn(),Oe(A,{all:function(){var e=ue.apply(null,arguments).map(vt);return new A(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((s,i)=>A.resolve(s).then(o=>{e[i]=o,--r||t(e)},n))})},resolve:e=>{if(e instanceof A)return e;if(e&&"function"==typeof e.then)return new A((n,r)=>{e.then(n,r)});var t=new A(Ue,!0,e);return Wn(t,Ut),t},reject:pt,race:function(){var e=ue.apply(null,arguments).map(vt);return new A((t,n)=>{e.map(r=>A.resolve(r).then(t,n))})},PSD:{get:()=>N,set:e=>N=e},totalEchoes:{get:()=>yt},newPSD:ye,usePSD:Le,scheduler:{get:()=>Ge,set:e=>{Ge=e}},rejectionMapper:{get:()=>Gt,set:e=>{Gt=e}},follow:(e,t)=>new A((n,r)=>ye((s,i)=>{var o=N;o.unhandleds=[],o.onunhandled=i,o.finalize=Se(function(){!function Mr(e){dt.push(function t(){e(),dt.splice(dt.indexOf(t),1)}),++Re,Ge(()=>{0==--Re&&Jt()},[])}(()=>{0===this.unhandleds.length?s():i(this.unhandleds[0])})},o.finalize),e()},t,n,r))}),ut&&(ut.allSettled&&le(A,"allSettled",function(){const e=ue.apply(null,arguments).map(vt);return new A(t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach((s,i)=>A.resolve(s).then(o=>r[i]={status:"fulfilled",value:o},o=>r[i]={status:"rejected",reason:o}).then(()=>--n||t(r)))})}),ut.any&&typeof AggregateError<"u"&&le(A,"any",function(){const e=ue.apply(null,arguments).map(vt);return new A((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const s=new Array(r);e.forEach((i,o)=>A.resolve(i).then(a=>t(a),a=>{s[o]=a,--r||n(new AggregateError(s))}))})}));const J={awaits:0,echoes:0,id:0};var Vr=0,gt=[],Xt=0,yt=0,qr=0;function ye(e,t,n,r){var s=N,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++qr;var o=Ke.env;i.env=qt?{Promise:A,PromiseProp:{value:A,configurable:!0,writable:!0},all:A.all,race:A.race,allSettled:A.allSettled,any:A.any,resolve:A.resolve,reject:A.reject,nthen:jn(o.nthen,i),gthen:jn(o.gthen,i)}:{},t&&X(i,t),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Le(i,e,n,r);return 0===i.ref&&i.finalize(),a}function Be(){return J.id||(J.id=++Vr),++J.awaits,J.echoes+=100,J.id}function he(){return!!J.awaits&&(0==--J.awaits&&(J.id=0),J.echoes=100*J.awaits,!0)}function vt(e){return J.echoes&&e&&e.constructor===ut?(Be(),e.then(t=>(he(),t),t=>(he(),z(t)))):e}function jr(e){++yt,(!J.echoes||0==--J.echoes)&&(J.echoes=J.id=0),gt.push(N),ve(e,!0)}function Hr(){var e=gt[gt.length-1];gt.pop(),ve(e,!1)}function ve(e,t){var n=N;if((t?J.echoes&&(!Xt++||e!==N):Xt&&(!--Xt||e!==N))&&qn(t?jr.bind(null,e):Hr),e!==N&&(N=e,n===Ke&&(Ke.env=Vn()),qt)){var r=Ke.env.Promise,s=e.env;ct.then=s.nthen,r.prototype.then=s.gthen,(n.global||e.global)&&(Object.defineProperty(H,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function Vn(){var e=H.Promise;return qt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(H,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ct.then,gthen:e.prototype.then}:{}}function Le(e,t,n,r,s){var i=N;try{return ve(e,!0),t(n,r,s)}finally{ve(i,!1)}}function qn(e){Kn.call(Wt,e)}function bt(e,t,n,r){return"function"!=typeof e?e:function(){var s=N;n&&Be(),ve(t,!0);try{return e.apply(this,arguments)}finally{ve(s,!1),r&&qn(he)}}}function jn(e,t){return function(n,r){return e.call(this,bt(n,t),bt(r,t))}}-1===(""+Kn).indexOf("[native code]")&&(Be=he=q);const Hn="unhandledrejection";function Un(e,t){var n;try{n=t.onuncatched(e)}catch{}if(!1!==n)try{var r,s={promise:t,reason:e};if(H.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Hn,!0,!0),X(r,s)):H.CustomEvent&&X(r=new CustomEvent(Hn,{detail:s}),s),r&&H.dispatchEvent&&(dispatchEvent(r),!H.PromiseRejectionEvent&&H.onunhandledrejection))try{H.onunhandledrejection(r)}catch{}ie&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var z=A.reject;function Gn(e,t,n,r){if(e.idbdb&&(e._state.openComplete||N.letThrough||e._vip)){var s=e._createTransaction(t,n,e._dbSchema);try{s.create()}catch(i){return z(i)}return s._promise(t,(i,o)=>ye(()=>(N.trans=s,r(i,o,s)))).then(i=>s._completion.then(()=>i))}if(e._state.openComplete)return z(new B.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return z(new B.DatabaseClosed);e.open().catch(q)}return e._state.dbReadyPromise.then(()=>Gn(e,t,n,r))}const xe=String.fromCharCode(65535),Qt=-1/0,fe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",zn="String expected.",Je=[],wt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ur=wt,Gr=wt,$n=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),_t="__dbnames",Zt="readonly",en="readwrite";function Ie(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Jn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Et(e){return"string"!=typeof e||/\./.test(e)?t=>t:t=>(void 0===t[e]&&e in t&&delete(t=qe(t))[e],t)}class Yr{_trans(t,n,r){const s=this._tx||N.trans,i=this.name;function o(l,u,f){if(!f.schema[i])throw new B.NotFound("Table "+i+" not part of transaction");return n(f.idbtrans,f)}const a=ze();try{return s&&s.db===this.db?s===N.trans?s._promise(t,o,r):ye(()=>s._promise(t,o,r),{trans:s,transless:N.transless||N}):Gn(this.db,t,[this.name],o)}finally{a&&$e()}}get(t,n){return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:t}).then(s=>this.hook.reading.fire(s))).then(n)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if($(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const n=Y(t);if(1===n.length)return this.where(n[0]).equals(t[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&n.every(f=>u.keyPath.indexOf(f)>=0)&&u.keyPath.every(f=>n.indexOf(f)>=0))[0];if(r&&this.db._maxKey!==xe)return this.where(r.name).equals(r.keyPath.map(u=>t[u]));!r&&ie&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,i=this.db._deps.indexedDB;function o(u,f){try{return 0===i.cmp(u,f)}catch{return!1}}const[a,l]=n.reduce(([u,f],c)=>{const h=s[c],m=t[c];return[u||h,u||!h?Ie(f,h&&h.multi?E=>{const v=ce(E,c);return $(v)&&v.some(S=>o(m,S))}:E=>o(m,ce(E,c))):f]},[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,$(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const n=r=>{if(!r)return r;const s=Object.create(t.prototype);for(var i in r)if(ne(r,i))try{s[i]=r[i]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),t}defineClass(){return this.mapToClass(function t(n){X(this,n)})}add(t,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=t;return s&&r&&(i=Et(s)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:null!=n?[n]:null,values:[i]})).then(o=>o.numFailures?A.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{re(t,s,o)}catch{}return o})}update(t,n){if("object"!=typeof t||$(t))return this.where(":id").equals(t).modify(n);{const r=ce(t,this.schema.primKey.keyPath);if(void 0===r)return z(new B.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof n?Y(n).forEach(s=>{re(t,s,n[s])}):n(t,{value:t,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(t,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=t;return s&&r&&(i=Et(s)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[i],keys:null!=n?[n]:null})).then(o=>o.numFailures?A.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{re(t,s,o)}catch{}return o})}delete(t){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[t]})).then(n=>n.numFailures?A.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:Jn})).then(t=>t.numFailures?A.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",n=>this.core.getMany({keys:t,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(t,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&s)throw new B.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let f=l&&a?t.map(Et(l)):t;return this.core.mutate({trans:o,type:"add",keys:s,values:f,wantResults:i}).then(({numFailures:c,results:h,lastResult:m,failures:E})=>{if(0===c)return i?h:m;throw new je(`${this.name}.bulkAdd(): ${c} of ${u} operations failed`,E)})})}bulkPut(t,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&s)throw new B.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let f=l&&a?t.map(Et(l)):t;return this.core.mutate({trans:o,type:"put",keys:s,values:f,wantResults:i}).then(({numFailures:c,results:h,lastResult:m,failures:E})=>{if(0===c)return i?h:m;throw new je(`${this.name}.bulkPut(): ${c} of ${u} operations failed`,E)})})}bulkDelete(t){const n=t.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:t})).then(({numFailures:r,lastResult:s,failures:i})=>{if(0===r)return s;throw new je(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,i)})}}function Xe(e){var t={},n=function(a,l){if(l){for(var u=arguments.length,f=new Array(u-1);--u;)f[u-1]=arguments[u];return t[a].subscribe.apply(null,f),e}if("string"==typeof a)return t[a]};n.addEventType=i;for(var r=1,s=arguments.length;r<s;++r)i(arguments[r]);return n;function i(a,l,u){if("object"==typeof a)return o(a);l||(l=Pr),u||(u=q);var f={subscribers:[],fire:u,subscribe:function(c){-1===f.subscribers.indexOf(c)&&(f.subscribers.push(c),f.fire=l(f.fire,c))},unsubscribe:function(c){f.subscribers=f.subscribers.filter(function(h){return h!==c}),f.fire=f.subscribers.reduce(l,u)}};return t[a]=n[a]=f,f}function o(a){Y(a).forEach(function(l){var u=a[l];if($(u))i(l,a[l][0],a[l][1]);else{if("asap"!==u)throw new B.InvalidArgument("Invalid event config");var f=i(l,He,function(){for(var h=arguments.length,m=new Array(h);h--;)m[h]=arguments[h];f.subscribers.forEach(function(E){Cn(function(){E.apply(null,m)})})})}})}}function Qe(e,t){return De(t).from({prototype:e}),t}function Me(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function tn(e,t){e.filter=Ie(e.filter,t)}function nn(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Ie(r(),t()):t,e.justLimit=n&&!r}function St(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new B.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Xn(e,t,n){const r=St(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ct(e,t,n,r){const s=e.replayFilter?Ie(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},o=(a,l,u)=>{if(!s||s(l,u,h=>l.stop(h),h=>l.fail(h))){var f=l.primaryKey,c=""+f;"[object ArrayBuffer]"===c&&(c=""+new Uint8Array(f)),ne(i,c)||(i[c]=!0,t(a,l,u))}};return Promise.all([e.or._iterate(o,n),Qn(Xn(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Qn(Xn(e,r,n),Ie(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Qn(e,t,n,r){var i=U(r?(o,a,l)=>n(r(o),a,l):n);return e.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!t||t(o,l=>a=l,l=>{o.stop(l),a=q},l=>{o.fail(l),a=q}))&&i(o.value,o,l=>a=l),a()})})}function Q(e,t){try{const n=Zn(e),r=Zn(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function Xr(e,t){const n=e.length,r=t.length,s=n<r?n:r;for(let i=0;i<s;++i)if(e[i]!==t[i])return e[i]<t[i]?-1:1;return n===r?0:n<r?-1:1}(er(e),er(t));case"Array":return function Jr(e,t){const n=e.length,r=t.length,s=n<r?n:r;for(let i=0;i<s;++i){const o=Q(e[i],t[i]);if(0!==o)return o}return n===r?0:n<r?-1:1}(e,t)}}catch{}return NaN}function Zn(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=Nt(e);return"ArrayBuffer"===n?"binary":n}function er(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Qr{_read(t,n){var r=this._ctx;return r.error?r.table._trans(null,z.bind(null,r.error)):r.table._trans("readonly",t).then(n)}_write(t){var n=this._ctx;return n.error?n.table._trans(null,z.bind(null,n.error)):n.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var n=this._ctx;n.algorithm=Ie(n.algorithm,t)}_iterate(t,n){return Ct(this._ctx,t,n,this._ctx.table.core)}clone(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&X(r,t),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(t){var n=this._ctx;return this._read(r=>Ct(n,t,r,n.table.core))}count(t){return this._read(n=>{const r=this._ctx,s=r.table.core;if(Me(r,!0))return s.count({trans:n,query:{index:St(r,s.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var i=0;return Ct(r,()=>(++i,!1),n,s).then(()=>i)}).then(t)}sortBy(t,n){const r=t.split(".").reverse(),s=r[0],i=r.length-1;function o(u,f){return f?o(u[r[f]],f-1):u[s]}var a="next"===this._ctx.dir?1:-1;function l(u,f){var c=o(u,i),h=o(f,i);return c<h?-a:c>h?a:0}return this.toArray(function(u){return u.sort(l)}).then(n)}toArray(t){return this._read(n=>{var r=this._ctx;if("next"===r.dir&&Me(r,!0)&&r.limit>0){const{valueMapper:s}=r,i=St(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then(({result:o})=>s?o.map(s):o)}{const s=[];return Ct(r,i=>s.push(i),n,r.table.core).then(()=>s)}},t)}offset(t){var n=this._ctx;return t<=0||(n.offset+=t,Me(n)?nn(n,()=>{var r=t;return(s,i)=>0===r||(1===r?(--r,!1):(i(()=>{s.advance(r),r=0}),!1))}):nn(n,()=>{var r=t;return()=>--r<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),nn(this._ctx,()=>{var n=t;return function(r,s,i){return--n<=0&&s(i),n>=0}},!0),this}until(t,n){return tn(this._ctx,function(r,s,i){return!t(r.value)||(s(i),n)}),this}first(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){return tn(this._ctx,function(n){return t(n.value)}),function $r(e,t){e.isMatch=Ie(e.isMatch,t)}(this._ctx,t),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){t(s.key,s)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){t(s.primaryKey,s)})}keys(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.key)}).then(function(){return r}).then(t)}primaryKeys(t){var n=this._ctx;if("next"===n.dir&&Me(n,!0)&&n.limit>0)return this._read(s=>{var i=St(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:i,range:n.range}})}).then(({result:s})=>s).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.primaryKey)}).then(function(){return r}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(n){return n[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return tn(this._ctx,function(s){var i=s.primaryKey.toString(),o=ne(r,i);return r[i]=!0,!o}),this}modify(t){var n=this._ctx;return this._write(r=>{var s;if("function"==typeof t)s=t;else{var i=Y(t),o=i.length;s=function(v){for(var S=!1,g=0;g<o;++g){var R=i[g],x=t[R];ce(v,R)!==x&&(re(v,R,x),S=!0)}return S}}const a=n.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,f=this.db._options.modifyChunkSize||200,c=[];let h=0;const m=[],E=(v,S)=>{const{failures:g,numFailures:R}=S;h+=v-R;for(let x of Y(g))c.push(g[x])};return this.clone().primaryKeys().then(v=>{const S=g=>{const R=Math.min(f,v.length-g);return a.getMany({trans:r,keys:v.slice(g,g+R),cache:"immutable"}).then(x=>{const w=[],I=[],C=l?[]:null,k=[];for(let M=0;M<R;++M){const W=x[M],d={value:qe(W),primKey:v[g+M]};!1!==s.call(d,d.value,d)&&(null==d.value?k.push(v[g+M]):l||0===Q(u(W),u(d.value))?(I.push(d.value),l&&C.push(v[g+M])):(k.push(v[g+M]),w.push(d.value)))}const D=Me(n)&&n.limit===1/0&&("function"!=typeof t||t===rn)&&{index:n.index,range:n.range};return Promise.resolve(w.length>0&&a.mutate({trans:r,type:"add",values:w}).then(M=>{for(let W in M.failures)k.splice(parseInt(W),1);E(w.length,M)})).then(()=>(I.length>0||D&&"object"==typeof t)&&a.mutate({trans:r,type:"put",keys:C,values:I,criteria:D,changeSpec:"function"!=typeof t&&t}).then(M=>E(I.length,M))).then(()=>(k.length>0||D&&t===rn)&&a.mutate({trans:r,type:"delete",keys:k,criteria:D}).then(M=>E(k.length,M))).then(()=>v.length>g+R&&S(g+f))})};return S(0).then(()=>{if(c.length>0)throw new at("Error modifying one or more objects",c,h,m);return v.length})})})}delete(){var t=this._ctx,n=t.range;return Me(t)&&(t.isPrimKey&&!Gr||3===n.type)?this._write(r=>{const{primaryKey:s}=t.table.core.schema,i=n;return t.table.core.count({trans:r,query:{index:s,range:i}}).then(o=>t.table.core.mutate({trans:r,type:"deleteRange",range:i}).then(({failures:a,numFailures:f})=>{if(f)throw new at("Could not delete some values",Object.keys(a).map(c=>a[c]),o-f);return o-f}))}):this.modify(rn)}}const rn=(e,t)=>t.value=null;function es(e,t){return e<t?-1:e===t?0:1}function ts(e,t){return e>t?-1:e===t?0:1}function ee(e,t,n){var r=e instanceof nr?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Fe(e){return new e.Collection(e,()=>tr("")).limit(0)}function ss(e,t,n,r,s,i){for(var o=Math.min(e.length,r.length),a=-1,l=0;l<o;++l){var u=t[l];if(u!==r[l])return s(e[l],n[l])<0?e.substr(0,l)+n[l]+n.substr(l+1):s(e[l],r[l])<0?e.substr(0,l)+r[l]+n.substr(l+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;s(e[l],u)<0&&(a=l)}return o<r.length&&"next"===i?e+n.substr(e.length):o<e.length&&"prev"===i?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function Rt(e,t,n,r){var s,i,o,a,l,u,f,c=n.length;if(!n.every(v=>"string"==typeof v))return ee(e,zn);function h(v){s=function ns(e){return"next"===e?t=>t.toUpperCase():t=>t.toLowerCase()}(v),i=function rs(e){return"next"===e?t=>t.toLowerCase():t=>t.toUpperCase()}(v),o="next"===v?es:ts;var S=n.map(function(g){return{lower:i(g),upper:s(g)}}).sort(function(g,R){return o(g.lower,R.lower)});a=S.map(function(g){return g.upper}),l=S.map(function(g){return g.lower}),u=v,f="next"===v?"":r}h("next");var m=new e.Collection(e,()=>be(a[0],l[c-1]+r));m._ondirectionchange=function(v){h(v)};var E=0;return m._addAlgorithm(function(v,S,g){var R=v.key;if("string"!=typeof R)return!1;var x=i(R);if(t(x,l,E))return!0;for(var w=null,I=E;I<c;++I){var C=ss(R,x,a[I],l[I],o,u);null===C&&null===w?E=I+1:(null===w||o(w,C)>0)&&(w=C)}return S(null!==w?function(){v.continue(w+f)}:g),!1}),m}function be(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function tr(e){return{type:1,lower:e,upper:e}}class nr{get Collection(){return this._ctx.table.db.Collection}between(t,n,r,s){r=!1!==r,s=!0===s;try{return this._cmp(t,n)>0||0===this._cmp(t,n)&&(r||s)&&(!r||!s)?Fe(this):new this.Collection(this,()=>be(t,n,!r,!s))}catch{return ee(this,fe)}}equals(t){return null==t?ee(this,fe):new this.Collection(this,()=>tr(t))}above(t){return null==t?ee(this,fe):new this.Collection(this,()=>be(t,void 0,!0))}aboveOrEqual(t){return null==t?ee(this,fe):new this.Collection(this,()=>be(t,void 0,!1))}below(t){return null==t?ee(this,fe):new this.Collection(this,()=>be(void 0,t,!1,!0))}belowOrEqual(t){return null==t?ee(this,fe):new this.Collection(this,()=>be(void 0,t))}startsWith(t){return"string"!=typeof t?ee(this,zn):this.between(t,t+xe,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):Rt(this,(n,r)=>0===n.indexOf(r[0]),[t],xe)}equalsIgnoreCase(t){return Rt(this,(n,r)=>n===r[0],[t],"")}anyOfIgnoreCase(){var t=ue.apply(Pe,arguments);return 0===t.length?Fe(this):Rt(this,(n,r)=>-1!==r.indexOf(n),t,"")}startsWithAnyOfIgnoreCase(){var t=ue.apply(Pe,arguments);return 0===t.length?Fe(this):Rt(this,(n,r)=>r.some(s=>0===n.indexOf(s)),t,xe)}anyOf(){const t=ue.apply(Pe,arguments);let n=this._cmp;try{t.sort(n)}catch{return ee(this,fe)}if(0===t.length)return Fe(this);const r=new this.Collection(this,()=>be(t[0],t[t.length-1]));r._ondirectionchange=i=>{n="next"===i?this._ascending:this._descending,t.sort(n)};let s=0;return r._addAlgorithm((i,o,a)=>{const l=i.key;for(;n(l,t[s])>0;)if(++s,s===t.length)return o(a),!1;return 0===n(l,t[s])||(o(()=>{i.continue(t[s])}),!1)}),r}notEqual(t){return this.inAnyRange([[Qt,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=ue.apply(Pe,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch{return ee(this,fe)}const n=t.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[Qt,s]],null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,n){const r=this._cmp,s=this._ascending,i=this._descending,o=this._min,a=this._max;if(0===t.length)return Fe(this);if(!t.every(w=>void 0!==w[0]&&void 0!==w[1]&&s(w[0],w[1])<=0))return ee(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",B.InvalidArgument);const l=!n||!1!==n.includeLowers,u=n&&!0===n.includeUppers;let m,c=s;function h(w,I){return c(w[0],I[0])}try{m=t.reduce(function f(w,I){let C=0,k=w.length;for(;C<k;++C){const D=w[C];if(r(I[0],D[1])<0&&r(I[1],D[0])>0){D[0]=o(D[0],I[0]),D[1]=a(D[1],I[1]);break}}return C===k&&w.push(I),w},[]),m.sort(h)}catch{return ee(this,fe)}let E=0;const v=u?w=>s(w,m[E][1])>0:w=>s(w,m[E][1])>=0,S=l?w=>i(w,m[E][0])>0:w=>i(w,m[E][0])>=0;let R=v;const x=new this.Collection(this,()=>be(m[0][0],m[m.length-1][1],!l,!u));return x._ondirectionchange=w=>{"next"===w?(R=v,c=s):(R=S,c=i),m.sort(h)},x._addAlgorithm((w,I,C)=>{for(var k=w.key;R(k);)if(++E,E===m.length)return I(C),!1;return!!function g(w){return!v(w)&&!S(w)}(k)||(0===this._cmp(k,m[E][1])||0===this._cmp(k,m[E][0])||I(()=>{w.continue(c===s?m[E][0]:m[E][1])}),!1)}),x}startsWithAnyOf(){const t=ue.apply(Pe,arguments);return t.every(n=>"string"==typeof n)?0===t.length?Fe(this):this.inAnyRange(t.map(n=>[n,n+xe])):ee(this,"startsWithAnyOf() only works with strings")}}function oe(e){return U(function(t){return Ze(t),e(t.target.error),!1})}function Ze(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const et="storagemutated",we="x-storagemutated-1",_e=Xe(null,et);class os{_lock(){return Ve(!N.global),++this._reculock,1===this._reculock&&!N.global&&(N.lockOwnerFor=this),this}_unlock(){if(Ve(!N.global),0==--this._reculock)for(N.global||(N.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Le(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&N.lockOwnerFor!==this}create(t){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Ve(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new B.DatabaseClosed(r);case"MissingAPIError":throw new B.MissingAPI(r.message,r);default:throw new B.OpenFailed(r)}if(!this.active)throw new B.TransactionInactive;return Ve(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=U(s=>{Ze(s),this._reject(t.error)}),t.onabort=U(s=>{Ze(s),this.active&&this._reject(new B.Abort(t.error)),this.active=!1,this.on("abort").fire(s)}),t.oncomplete=U(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&_e.storagemutated.fire(t.mutatedParts)}),this}_promise(t,n,r){if("readwrite"===t&&"readwrite"!==this.mode)return z(new B.ReadOnly("Transaction is readonly"));if(!this.active)return z(new B.TransactionInactive);if(this._locked())return new A((i,o)=>{this._blockedFuncs.push([()=>{this._promise(t,n,r).then(i,o)},N])});if(r)return ye(()=>{var i=new A((o,a)=>{this._lock();const l=n(o,a,this);l&&l.then&&l.then(o,a)});return i.finally(()=>this._unlock()),i._lib=!0,i});var s=new A((i,o)=>{var a=n(i,o,this);a&&a.then&&a.then(i,o)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(t){var n=this._root();const r=A.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);!function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=o)}()}var i=n._waitingFor;return new A((o,a)=>{r.then(l=>n._waitingQueue.push(U(o.bind(null,l))),l=>n._waitingQueue.push(U(a.bind(null,l)))).finally(()=>{n._waitingFor===i&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new B.Abort))}table(t){const n=this._memoizedTables||(this._memoizedTables={});if(ne(n,t))return n[t];const r=this.schema[t];if(!r)throw new B.NotFound("Table "+t+" not part of transaction");const s=new this.db.Table(t,r,this);return s.core=this.db.core.table(t),n[t]=s,s}}function sn(e,t,n,r,s,i,o){return{name:e,keyPath:t,unique:n,multi:r,auto:s,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(s?"++":"")+rr(t)}}function rr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function sr(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:Rn(n,r=>[r.name,r])}}let tt=e=>{try{return e.only([[]]),tt=()=>[[]],[[]]}catch{return tt=()=>xe,xe}};function on(e){return null==e?()=>{}:"string"==typeof e?function cs(e){return 1===e.split(".").length?n=>n[e]:n=>ce(n,e)}(e):t=>ce(t,e)}function ir(e){return[].slice.call(e)}let us=0;function nt(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function hs(e,t,n){function s(f){if(3===f.type)return null;if(4===f.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:h,lowerOpen:m,upperOpen:E}=f;return void 0===c?void 0===h?null:t.upperBound(h,!!E):void 0===h?t.lowerBound(c,!!m):t.bound(c,h,!!m,!!E)}const{schema:o,hasGetAll:a}=function r(f,c){const h=ir(f.objectStoreNames);return{schema:{name:f.name,tables:h.map(m=>c.objectStore(m)).map(m=>{const{keyPath:E,autoIncrement:v}=m,S=$(E),R={},x={name:m.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==E,compound:S,keyPath:E,autoIncrement:v,unique:!0,extractKey:on(E)},indexes:ir(m.indexNames).map(w=>m.index(w)).map(w=>{const{name:I,unique:C,multiEntry:k,keyPath:D}=w,W={name:I,compound:$(D),keyPath:D,unique:C,multiEntry:k,extractKey:on(D)};return R[nt(D)]=W,W}),getIndexByKeyPath:w=>R[nt(w)]};return R[":id"]=x.primaryKey,null!=E&&(R[nt(E)]=x.primaryKey),x})},hasGetAll:h.length>0&&"getAll"in c.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),l=o.tables.map(f=>function i(f){const c=f.name;return{name:c,schema:f,mutate:function h({trans:v,type:S,keys:g,values:R,range:x}){return new Promise((w,I)=>{w=U(w);const C=v.objectStore(c),k=null==C.keyPath,D="put"===S||"add"===S;if(!D&&"delete"!==S&&"deleteRange"!==S)throw new Error("Invalid operation type: "+S);const{length:M}=g||R||{length:1};if(g&&R&&g.length!==R.length)throw new Error("Given keys array must have same length as given values array.");if(0===M)return w({numFailures:0,failures:{},results:[],lastResult:void 0});let W;const d=[],y=[];let b=0;const O=P=>{++b,Ze(P)};if("deleteRange"===S){if(4===x.type)return w({numFailures:b,failures:y,results:[],lastResult:void 0});d.push(W=3===x.type?C.clear():C.delete(s(x)))}else{const[P,j]=D?k?[R,g]:[R,null]:[g,null];if(D)for(let V=0;V<M;++V)d.push(W=j&&void 0!==j[V]?C[S](P[V],j[V]):C[S](P[V])),W.onerror=O;else for(let V=0;V<M;++V)d.push(W=C[S](P[V])),W.onerror=O}const L=P=>{const j=P.target.result;d.forEach((V,se)=>null!=V.error&&(y[se]=V.error)),w({numFailures:b,failures:y,results:"delete"===S?g:d.map(V=>V.result),lastResult:j})};W.onerror=P=>{O(P),L(P)},W.onsuccess=L})},getMany:({trans:v,keys:S})=>new Promise((g,R)=>{g=U(g);const x=v.objectStore(c),w=S.length,I=new Array(w);let D,C=0,k=0;const M=d=>{const y=d.target;I[y._pos]=y.result,++k===C&&g(I)},W=oe(R);for(let d=0;d<w;++d)null!=S[d]&&(D=x.get(S[d]),D._pos=d,D.onsuccess=M,D.onerror=W,++C);0===C&&g(I)}),get:({trans:v,key:S})=>new Promise((g,R)=>{g=U(g);const w=v.objectStore(c).get(S);w.onsuccess=I=>g(I.target.result),w.onerror=oe(R)}),query:function E(v){return S=>new Promise((g,R)=>{g=U(g);const{trans:x,values:w,limit:I,query:C}=S,k=I===1/0?void 0:I,{index:D,range:M}=C,W=x.objectStore(c),d=D.isPrimaryKey?W:W.index(D.name),y=s(M);if(0===I)return g({result:[]});if(v){const b=w?d.getAll(y,k):d.getAllKeys(y,k);b.onsuccess=O=>g({result:O.target.result}),b.onerror=oe(R)}else{let b=0;const O=w||!("openKeyCursor"in d)?d.openCursor(y):d.openKeyCursor(y),L=[];O.onsuccess=P=>{const j=O.result;return j?(L.push(w?j.value:j.primaryKey),++b===I?g({result:L}):void j.continue()):g({result:L})},O.onerror=oe(R)}})}(a),openCursor:function m({trans:v,values:S,query:g,reverse:R,unique:x}){return new Promise((w,I)=>{w=U(w);const{index:C,range:k}=g,D=v.objectStore(c),M=C.isPrimaryKey?D:D.index(C.name),W=R?x?"prevunique":"prev":x?"nextunique":"next",d=S||!("openKeyCursor"in M)?M.openCursor(s(k),W):M.openKeyCursor(s(k),W);d.onerror=oe(I),d.onsuccess=U(y=>{const b=d.result;if(!b)return void w(null);b.___id=++us,b.done=!1;const O=b.continue.bind(b);let L=b.continuePrimaryKey;L&&(L=L.bind(b));const P=b.advance.bind(b),V=()=>{throw new Error("Cursor not stopped")};b.trans=v,b.stop=b.continue=b.continuePrimaryKey=b.advance=()=>{throw new Error("Cursor not started")},b.fail=U(I),b.next=function(){let se=1;return this.start(()=>se--?this.continue():this.stop()).then(()=>this)},b.start=se=>{const Z=new Promise((pe,st)=>{pe=U(pe),d.onerror=oe(st),b.fail=st,b.stop=Ot=>{b.stop=b.continue=b.continuePrimaryKey=b.advance=V,pe(Ot)}}),ae=()=>{if(d.result)try{se()}catch(pe){b.fail(pe)}else b.done=!0,b.start=()=>{throw new Error("Cursor behind last entry")},b.stop()};return d.onsuccess=U(pe=>{d.onsuccess=ae,ae()}),b.continue=O,b.continuePrimaryKey=L,b.advance=P,ae(),Z},w(b)},I)})},count({query:v,trans:S}){const{index:g,range:R}=v;return new Promise((x,w)=>{const I=S.objectStore(c),C=g.isPrimaryKey?I:I.index(g.name),k=s(R),D=k?C.count(k):C.count();D.onsuccess=U(M=>x(M.target.result)),D.onerror=oe(w)})}}}(f)),u={};return l.forEach(f=>u[f.name]=f),{stack:"dbcore",transaction:e.transaction.bind(e),table(f){if(!u[f])throw new Error(`Table '${f}' not found`);return u[f]},MIN_KEY:-1/0,MAX_KEY:tt(t),schema:o}}function fs(e,t){return t.reduce((n,{create:r})=>({...n,...r(n)}),e)}function an({_novip:e},t){const r=function ds(e,t,{IDBKeyRange:n},s){return{dbcore:fs(hs(t,n,s),e.dbcore)}}(e._middlewares,t.db,e._deps,t);e.core=r.dbcore,e.tables.forEach(s=>{const i=s.name;e.core.schema.tables.some(o=>o.name===i)&&(s.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=s.core))})}function xt({_novip:e},t,n,r){n.forEach(s=>{const i=r[s];t.forEach(o=>{const a=Dt(o,s);(!a||"value"in a&&void 0===a.value)&&(o===e.Transaction.prototype||o instanceof e.Transaction?le(o,s,{get(){return this.table(s)},set(l){En(this,s,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new e.Table(s,i))})})}function ln({_novip:e},t){t.forEach(n=>{for(let r in n)n[r]instanceof e.Table&&delete n[r]})}function ms(e,t){return e._cfg.version-t._cfg.version}function or(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const s=e[r],i=t[r];if(s){const o={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!wt)o.recreate=!0,n.change.push(o);else{const a=s.idxByName,l=i.idxByName;let u;for(u in a)l[u]||o.del.push(u);for(u in l){const f=a[u],c=l[u];f?f.src!==c.src&&o.change.push(c):o.add.push(c)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,i])}return n}function cn(e,t,n,r){const s=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(i=>un(s,i)),s}function un(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function hn(e,t,n){const r={};return ot(t.objectStoreNames,0).forEach(i=>{const o=n.objectStore(i);let a=o.keyPath;const l=sn(rr(a),a||"",!1,!1,!!o.autoIncrement,a&&"string"!=typeof a,!0),u=[];for(let c=0;c<o.indexNames.length;++c){const h=o.index(o.indexNames[c]);a=h.keyPath;var f=sn(h.name,a,!!h.unique,!!h.multiEntry,!1,a&&"string"!=typeof a,!1);u.push(f)}r[i]=sr(i,l,u)}),r}function fn({_novip:e},t,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const i=r[s],o=n.objectStore(i);e._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const l=o.indexNames[a],u=o.index(l).keyPath,f="string"==typeof u?u:"["+ot(u).join("+")+"]";if(t[i]){const c=t[i].idxByName[f];c&&(c.name=l,delete t[i].idxByName[f],t[i].idxByName[l]=c)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&H.WorkerGlobalScope&&H instanceof H.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Es{_parseStoresSpec(t,n){Y(t).forEach(r=>{if(null!==t[r]){var s=function _s(e){return e.split(",").map((t,n)=>{const r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return sn(r,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),$(s),0===n)})}(t[r]),i=s.shift();if(i.multi)throw new B.Schema("Primary key cannot be multi-valued");s.forEach(o=>{if(o.auto)throw new B.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new B.Schema("Index must have a name and cannot be an empty string")}),n[r]=sr(r,i,s)}})}stores(t){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?X(this._cfg.storesSource,t):t;const s={};let i={};return n._versions.forEach(o=>{X(s,o._cfg.storesSource),i=o._cfg.dbschema={},o._parseStoresSpec(s,i)}),n._dbSchema=i,ln(n,[n._allTables,n,n.Transaction.prototype]),xt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],Y(i),i),n._storeNames=Y(i),this}upgrade(t){return this._cfg.contentUpgrade=Ft(this._cfg.contentUpgrade||q,t),this}}function dn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ae(_t,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function mn(e){return e&&"function"==typeof e.databases}function pn(e){return ye(function(){return N.letThrough=!0,e()})}function Is(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function As(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?z(t.dbOpenError):e);ie&&(t.openCanceller._stackHolder=Ee()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function s(){if(t.openCanceller!==r)throw new B.DatabaseClosed("db.open() was cancelled")}let i=t.dbReadyResolve,o=null,a=!1;return A.race([r,(typeof navigator>"u"?A.resolve():Is()).then(()=>new A((l,u)=>{if(s(),!n)throw new B.MissingAPI;const f=e.name,c=t.autoSchema?n.open(f):n.open(f,Math.round(10*e.verno));if(!c)throw new B.MissingAPI;c.onerror=oe(u),c.onblocked=U(e._fireOnBlocked),c.onupgradeneeded=U(h=>{if(o=c.transaction,t.autoSchema&&!e._options.allowEmptyDB){c.onerror=Ze,o.abort(),c.result.close();const E=n.deleteDatabase(f);E.onsuccess=E.onerror=U(()=>{u(new B.NoSuchDatabase(`Database ${f} doesnt exist`))})}else{o.onerror=oe(u);var m=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;a=m<1,e._novip.idbdb=c.result,function ps(e,t,n,r){const s=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,s);i.create(n),i._completion.catch(r);const o=i._reject.bind(i),a=N.transless||N;ye(()=>{N.trans=i,N.transless=a,0===t?(Y(s).forEach(l=>{cn(n,l,s[l].primKey,s[l].indexes)}),an(e,n),A.follow(()=>e.on.populate.fire(i)).catch(o)):function gs({_novip:e},t,n,r){const s=[],i=e._versions;let o=e._dbSchema=hn(0,e.idbdb,r),a=!1;return i.filter(f=>f._cfg.version>=t).forEach(f=>{s.push(()=>{const c=o,h=f._cfg.dbschema;fn(e,c,r),fn(e,h,r),o=e._dbSchema=h;const m=or(c,h);m.add.forEach(v=>{cn(r,v[0],v[1].primKey,v[1].indexes)}),m.change.forEach(v=>{if(v.recreate)throw new B.Upgrade("Not yet support for changing primary key");{const S=r.objectStore(v.name);v.add.forEach(g=>un(S,g)),v.change.forEach(g=>{S.deleteIndex(g.name),un(S,g)}),v.del.forEach(g=>S.deleteIndex(g))}});const E=f._cfg.contentUpgrade;if(E&&f._cfg.version>t){an(e,r),n._memoizedTables={},a=!0;let v=xn(h);m.del.forEach(x=>{v[x]=c[x]}),ln(e,[e.Transaction.prototype]),xt(e,[e.Transaction.prototype],Y(v),v),n.schema=v;const S=Bt(E);let g;S&&Be();const R=A.follow(()=>{if(g=E(n),g&&S){var x=he.bind(null,null);g.then(x,x)}});return g&&"function"==typeof g.then?A.resolve(g):R.then(()=>g)}}),s.push(c=>{a&&Ur||function vs(e,t){[].slice.call(t.db.objectStoreNames).forEach(n=>null==e[n]&&t.db.deleteObjectStore(n))}(f._cfg.dbschema,c),ln(e,[e.Transaction.prototype]),xt(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema})}),function u(){return s.length?A.resolve(s.shift()(n.idbtrans)).then(u):A.resolve()}().then(()=>{!function ys(e,t){Y(e).forEach(n=>{t.db.objectStoreNames.contains(n)||cn(t,n,e[n].primKey,e[n].indexes)})}(o,r)})}(e,t,i,n).catch(o)})}(e,m/10,o,u)}},u),c.onsuccess=U(()=>{o=null;const h=e._novip.idbdb=c.result,m=ot(h.objectStoreNames);if(m.length>0)try{const E=h.transaction(function ls(e){return 1===e.length?e[0]:e}(m),"readonly");t.autoSchema?function bs({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=hn(0,t,n);e._storeNames=ot(t.objectStoreNames,0),xt(e,[e._allTables],Y(r),r)}(e,h,E):(fn(e,e._dbSchema,E),function ws(e,t){const r=or(hn(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some(s=>s.add.length||s.change.length))}(e,E)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),an(e,E)}catch{}Je.push(e),h.onversionchange=U(E=>{t.vcFired=!0,e.on("versionchange").fire(E)}),h.onclose=U(E=>{e.on("close").fire(E)}),a&&function Rs({indexedDB:e,IDBKeyRange:t},n){!mn(e)&&n!==_t&&dn(e,t).put({name:n}).catch(q)}(e._deps,f),l()},u)}))]).then(()=>(s(),t.onReadyBeingFired=[],A.resolve(pn(()=>e.on.ready.fire(e.vip))).then(function l(){if(t.onReadyBeingFired.length>0){let u=t.onReadyBeingFired.reduce(Ft,q);return t.onReadyBeingFired=[],A.resolve(pn(()=>u(e.vip))).then(l)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(l=>{t.dbOpenError=l;try{o&&o.abort()}catch{}return r===t.openCanceller&&e._close(),z(l)}).finally(()=>{t.openComplete=!0,i()})}function gn(e){var t=o=>e.next(o),r=i(t),s=i(o=>e.throw(o));function i(o){return a=>{var l=o(a),u=l.value;return l.done?u:u&&"function"==typeof u.then?u.then(r,s):$(u)?Promise.all(u).then(r,s):r(u)}}return i(t)()}function ks(e,t,n){var r=arguments.length;if(r<2)throw new B.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];n=s.pop();var i=In(s);return[e,i,n]}function Ts(e,t,n,r,s){return A.resolve().then(()=>{const i=N.transless||N,o=e._createTransaction(t,n,e._dbSchema,r),a={trans:o,transless:i};r?o.idbtrans=r.idbtrans:o.create();const l=Bt(s);let u;l&&Be();const f=A.follow(()=>{if(u=s.call(o,o),u)if(l){var c=he.bind(null,null);u.then(c,c)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=gn(u))},a);return(u&&"function"==typeof u.then?A.resolve(u).then(c=>o.active?c:z(new B.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):f.then(()=>u)).then(c=>(r&&o._resolve(),o._completion.then(()=>c))).catch(c=>(o._reject(c),z(c)))})}function It(e,t,n){const r=$(e)?e.slice():[e];for(let s=0;s<n;++s)r.push(t);return r}const Ds={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function Os(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,s={},i=[];function o(h,m,E){const v=nt(h),S=s[v]=s[v]||[],g=null==h?0:"string"==typeof h?1:h.length,R=m>0,x={...E,isVirtual:R,keyTail:m,keyLength:g,extractKey:on(h),unique:!R&&E.unique};return S.push(x),x.isPrimaryKey||i.push(x),g>1&&o(2===g?h[0]:h.slice(0,g-1),m+1,E),S.sort((w,I)=>w.keyTail-I.keyTail),x}const a=o(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[a];for(const h of r.indexes)o(h.keyPath,0,h);function u(h,m){return{type:1===h.type?2:h.type,lower:It(h.lower,h.lowerOpen?e.MAX_KEY:e.MIN_KEY,m),lowerOpen:!0,upper:It(h.upper,h.upperOpen?e.MIN_KEY:e.MAX_KEY,m),upperOpen:!0}}function f(h){const m=h.query.index;return m.isVirtual?{...h,query:{index:m,range:u(h.query.range,m.keyTail)}}:h}return{...n,schema:{...r,primaryKey:a,indexes:i,getIndexByKeyPath:function l(h){const m=s[nt(h)];return m&&m[0]}},count:h=>n.count(f(h)),query:h=>n.query(f(h)),openCursor(h){const{keyTail:m,isVirtual:E,keyLength:v}=h.query.index;return E?n.openCursor(f(h)).then(g=>g&&function S(g){return Object.create(g,{continue:{value:function R(w){null!=w?g.continue(It(w,h.reverse?e.MAX_KEY:e.MIN_KEY,m)):h.unique?g.continue(g.key.slice(0,v).concat(h.reverse?e.MIN_KEY:e.MAX_KEY,m)):g.continue()}},continuePrimaryKey:{value(w,I){g.continuePrimaryKey(It(w,e.MAX_KEY,m),I)}},primaryKey:{get:()=>g.primaryKey},key:{get(){const w=g.key;return 1===v?w[0]:w.slice(0,v)}},value:{get:()=>g.value}})}(g)):n.openCursor(h)}}}}}};function yn(e,t,n,r){return n=n||{},r=r||"",Y(e).forEach(s=>{if(ne(t,s)){var i=e[s],o=t[s];if("object"==typeof i&&"object"==typeof o&&i&&o){const a=Nt(i);a!==Nt(o)?n[r+s]=t[s]:"Object"===a?yn(i,o,n,r+s+"."):i!==o&&(n[r+s]=t[s])}else i!==o&&(n[r+s]=t[s])}else n[r+s]=void 0}),Y(t).forEach(s=>{ne(e,s)||(n[r+s]=t[s])}),n}const Ns={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema;return{...n,mutate(i){const o=N.trans,{deleting:a,creating:l,updating:u}=o.table(t).hook;switch(i.type){case"add":if(l.fire===q)break;return o._promise("readwrite",()=>f(i),!0);case"put":if(l.fire===q&&u.fire===q)break;return o._promise("readwrite",()=>f(i),!0);case"delete":if(a.fire===q)break;return o._promise("readwrite",()=>f(i),!0);case"deleteRange":if(a.fire===q)break;return o._promise("readwrite",()=>function c(m){return h(m.trans,m.range,1e4)}(i),!0)}return n.mutate(i);function f(m){const E=N.trans,v=m.keys||function Ps(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,m);if(!v)throw new Error("Keys missing");return"delete"!==(m="add"===m.type||"put"===m.type?{...m,keys:v}:{...m}).type&&(m.values=[...m.values]),m.keys&&(m.keys=[...m.keys]),function Ks(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,m,v).then(S=>{const g=v.map((R,x)=>{const w=S[x],I={onerror:null,onsuccess:null};if("delete"===m.type)a.fire.call(I,R,w,E);else if("add"===m.type||void 0===w){const C=l.fire.call(I,R,m.values[x],E);null==R&&null!=C&&(m.keys[x]=R=C,r.outbound||re(m.values[x],r.keyPath,R))}else{const C=yn(w,m.values[x]),k=u.fire.call(I,C,R,w,E);if(k){const D=m.values[x];Object.keys(k).forEach(M=>{ne(D,M)?D[M]=k[M]:re(D,M,k[M])})}}return I});return n.mutate(m).then(({failures:R,results:x,numFailures:w,lastResult:I})=>{for(let C=0;C<v.length;++C){const k=x?x[C]:v[C],D=g[C];null==k?D.onerror&&D.onerror(R[C]):D.onsuccess&&D.onsuccess("put"===m.type&&S[C]?m.values[C]:k)}return{failures:R,results:x,numFailures:w,lastResult:I}}).catch(R=>(g.forEach(x=>x.onerror&&x.onerror(R)),Promise.reject(R)))})}function h(m,E,v){return n.query({trans:m,values:!1,query:{index:r,range:E},limit:v}).then(({result:S})=>f({type:"delete",keys:S,trans:m}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):S.length<v?{failures:[],numFailures:0,lastResult:void 0}:h(m,{...E,lower:S[S.length-1],lowerOpen:!0},v)))}}}}})};function ar(e,t,n){try{if(!t||t.keys.length<e.length)return null;const r=[];for(let s=0,i=0;s<t.keys.length&&i<e.length;++s)0===Q(t.keys[s],e[i])&&(r.push(n?qe(t.values[s]):t.values[s]),++i);return r.length===e.length?r:null}catch{return null}}const Bs={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=ar(r.keys,r.trans._cache,"clone"===r.cache);return s?A.resolve(s):n.getMany(r).then(i=>(r.trans._cache={keys:r.keys,values:"clone"===r.cache?qe(i):i},i))},mutate:r=>("add"!==r.type&&(r.trans._cache=null),n.mutate(r))}}})};function vn(e){return!("from"in e)}const de=function(e,t){if(!this){const n=new de;return e&&"d"in e&&X(n,e),n}X(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function rt(e,t,n){const r=Q(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(vn(e))return X(e,{from:t,to:n,d:1});const s=e.l,i=e.r;if(Q(n,e.from)<0)return s?rt(s,t,n):e.l={from:t,to:n,d:1,l:null,r:null},lr(e);if(Q(t,e.to)>0)return i?rt(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},lr(e);Q(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),Q(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;s&&!e.l&&At(e,s),i&&o&&At(e,i)}function At(e,t){vn(t)||function n(r,{from:s,to:i,l:o,r:a}){rt(r,s,i),o&&n(r,o),a&&n(r,a)}(e,t)}function bn(e){let t=vn(e)?null:{s:0,n:e};return{next(n){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&Q(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||Q(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function lr(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const i="r"===s?"l":"r",o={...e},a=e[s];e.from=a.from,e.to=a.to,e[s]=a[s],o[s]=a[i],e[i]=o,o.d=cr(o)}e.d=cr(e)}function cr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}Oe(de.prototype,{add(e){return At(this,e),this},addKey(e){return rt(this,e,e),this},addKeys(e){return e.forEach(t=>rt(this,t,t)),this},[Kt](){return bn(this)}});const Ms={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new de(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const s=e.table(r),{schema:i}=s,{primaryKey:o}=i,{extractKey:a,outbound:l}=o,u={...s,mutate:h=>{const m=h.trans,E=m.mutatedParts||(m.mutatedParts={}),v=C=>{const k=`idb://${t}/${r}/${C}`;return E[k]||(E[k]=new de)},S=v(""),g=v(":dels"),{type:R}=h;let[x,w]="deleteRange"===h.type?[h.range]:"delete"===h.type?[h.keys]:h.values.length<50?[[],h.values]:[];const I=h.trans._cache;return s.mutate(h).then(C=>{if($(x)){"delete"!==R&&(x=C.results),S.addKeys(x);const k=ar(x,I);!k&&"add"!==R&&g.addKeys(x),(k||w)&&function Fs(e,t,n,r){t.indexes.forEach(function s(i){const o=e(i.name||"");function a(u){return null!=u?i.extractKey(u):null}const l=u=>i.multiEntry&&$(u)?u.forEach(f=>o.addKey(f)):o.addKey(u);(n||r).forEach((u,f)=>{const c=n&&a(n[f]),h=r&&a(r[f]);0!==Q(c,h)&&(null!=c&&l(c),null!=h&&l(h))})})}(v,i,k,w)}else if(x){const k={from:x.lower,to:x.upper};g.add(k),S.add(k)}else S.add(n),g.add(n),i.indexes.forEach(k=>v(k.name).add(n));return C})}},f=({query:{index:h,range:m}})=>{var E,v;return[h,new de(null!==(E=m.lower)&&void 0!==E?E:e.MIN_KEY,null!==(v=m.upper)&&void 0!==v?v:e.MAX_KEY)]},c={get:h=>[o,new de(h.key)],getMany:h=>[o,(new de).addKeys(h.keys)],count:f,query:f,openCursor:f};return Y(c).forEach(h=>{u[h]=function(m){const{subscr:E}=N;if(E){const v=w=>{const I=`idb://${t}/${r}/${w}`;return E[I]||(E[I]=new de)},S=v(""),g=v(":dels"),[R,x]=c[h](m);if(v(R.name||"").add(x),!R.isPrimaryKey){if("count"!==h){const w="query"===h&&l&&m.values&&s.query({...m,values:!1});return s[h].apply(this,arguments).then(I=>{if("query"===h){if(l&&m.values)return w.then(({result:k})=>(S.addKeys(k),I));const C=m.values?I.result.map(a):I.result;m.values?S.addKeys(C):g.addKeys(C)}else if("openCursor"===h){const C=I,k=m.values;return C&&Object.create(C,{key:{get:()=>(g.addKey(C.primaryKey),C.key)},primaryKey:{get(){const D=C.primaryKey;return g.addKey(D),D}},value:{get:()=>(k&&S.addKey(C.primaryKey),C.value)}})}return I})}g.add(n)}}return s[h].apply(this,arguments)}}),u}}}};class Ae{constructor(t,n){this._middlewares={},this.verno=0;const r=Ae.dependencies;this._options=n={addons:Ae.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:q,dbReadyPromise:null,cancelOpen:q,openCanceller:null,autoSchema:!0};i.dbReadyPromise=new A(o=>{i.dbReadyResolve=o}),i.openCanceller=new A((o,a)=>{i.cancelOpen=a}),this._state=i,this.name=t,this.on=Xe(this,"populate","blocked","versionchange","close",{ready:[Ft,q]}),this.on.ready.subscribe=Sn(this.on.ready.subscribe,o=>(a,l)=>{Ae.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||A.resolve().then(a),l&&o(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),l&&o(a);else{o(a);const f=this;l||o(function c(){f.on.ready.unsubscribe(a),f.on.ready.unsubscribe(c)})}})}),this.Collection=function Zr(e){return Qe(Qr.prototype,function(n,r){this.db=e;let s=Jn,i=null;if(r)try{s=r()}catch(u){i=u}const o=n._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:s,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:o.or,valueMapper:l!==He?l:null}})}(this),this.Table=function zr(e){return Qe(Yr.prototype,function(n,r,s){this.db=e,this._tx=s,this.name=n,this.schema=r,this.hook=e._allTables[n]?e._allTables[n].hook:Xe(null,{creating:[Tr,q],reading:[kr,He],updating:[Dr,q],deleting:[Or,q]})})}(this),this.Transaction=function as(e){return Qe(os.prototype,function(n,r,s,i,o){this.db=e,this.mode=n,this.storeNames=r,this.schema=s,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Xe(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new A((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),z(a)})})}(this),this.Version=function Ss(e){return Qe(Es.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function is(e){return Qe(nr.prototype,function(n,r,s){this.db=e,this._ctx={table:n,index:":id"===r?null:r,or:s};const i=e._deps.indexedDB;if(!i)throw new B.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(o,a)=>i.cmp(a,o),this._max=(o,a)=>i.cmp(o,a)>0?o:a,this._min=(o,a)=>i.cmp(o,a)<0?o:a,this._IDBKeyRange=e._deps.IDBKeyRange})}(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=tt(n.IDBKeyRange),this._createTransaction=(o,a,l,u)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=o=>{this.on("blocked").fire(o),Je.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Ds),this.use(Ns),this.use(Ms),this.use(Bs),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(o=>o(this))}version(t){if(isNaN(t)||t<.1)throw new B.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new B.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const n=this._versions;var r=n.filter(s=>s._cfg.version===t)[0];return r||(r=new this.Version(t),n.push(r),n.sort(ms),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(t){return this.idbdb&&(this._state.openComplete||N.letThrough||this._vip)?t():new A((n,r)=>{if(this._state.openComplete)return r(new B.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new B.DatabaseClosed);this.open().catch(q)}this._state.dbReadyPromise.then(n,r)}).then(t)}use({stack:t,create:n,level:r,name:s}){s&&this.unuse({stack:t,name:s});const i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:n,level:r??10,name:s}),i.sort((o,a)=>o.level-a.level),this}unuse({stack:t,name:n,create:r}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return As(this)}_close(){const t=this._state,n=Je.indexOf(this);if(n>=0&&Je.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new A(r=>{t.dbReadyResolve=r}),t.openCanceller=new A((r,s)=>{t.cancelOpen=s})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new B.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,n=this._state;return new A((r,s)=>{const i=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=U(()=>{(function xs({indexedDB:e,IDBKeyRange:t},n){!mn(e)&&n!==_t&&dn(e,t).delete(n).catch(q)})(this._deps,this.name),r()}),o.onerror=oe(s),o.onblocked=this._fireOnBlocked};if(t)throw new B.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Y(this._allTables).map(t=>this._allTables[t])}transaction(){const t=ks.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,n,r){let s=N.trans;(!s||s.db!==this||-1!==t.indexOf("!"))&&(s=null);const i=-1!==t.indexOf("?");let o,a;t=t.replace("!","").replace("?","");try{if(a=n.map(u=>{var f=u instanceof this.Table?u.name:u;if("string"!=typeof f)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),"r"==t||t===Zt)o=Zt;else{if("rw"!=t&&t!=en)throw new B.InvalidArgument("Invalid transaction mode: "+t);o=en}if(s){if(s.mode===Zt&&o===en){if(!i)throw new B.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&a.forEach(u=>{if(s&&-1===s.storeNames.indexOf(u)){if(!i)throw new B.SubTransaction("Table "+u+" not included in parent transaction.");s=null}}),i&&s&&!s.active&&(s=null)}}catch(u){return s?s._promise(null,(f,c)=>{c(u)}):z(u)}const l=Ts.bind(null,this,o,a,s,r);return s?s._promise(o,l,"lock"):N.trans?Le(N.transless,()=>this._whenReady(l)):this._whenReady(l)}table(t){if(!ne(this._allTables,t))throw new B.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Ws=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Vs{constructor(t){this._subscribe=t}subscribe(t,n,r){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:n,complete:r})}[Ws](){return this}}function ur(e,t){return Y(t).forEach(n=>{At(e[n]||(e[n]=new de),t[n])}),e}let wn;try{wn={indexedDB:H.indexedDB||H.mozIndexedDB||H.webkitIndexedDB||H.msIndexedDB,IDBKeyRange:H.IDBKeyRange||H.webkitIDBKeyRange}}catch{wn={indexedDB:null,IDBKeyRange:null}}const ke=Ae;function kt(e){let t=me;try{me=!0,_e.storagemutated.fire(e)}finally{me=t}}Oe(ke,{...lt,delete:e=>new ke(e,{addons:[]}).delete(),exists:e=>new ke(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function Cs({indexedDB:e,IDBKeyRange:t}){return mn(e)?Promise.resolve(e.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==_t)):dn(e,t).toCollection().primaryKeys()}(ke.dependencies).then(e)}catch{return z(new B.MissingAPI)}},defineClass:()=>function e(t){X(this,t)},ignoreTransaction:e=>N.trans?Le(N.transless,e):e(),vip:pn,async:function(e){return function(){try{var t=gn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:A.resolve(t)}catch(n){return z(n)}}},spawn:function(e,t,n){try{var r=gn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:A.resolve(r)}catch(s){return z(s)}},currentTransaction:{get:()=>N.trans||null},waitFor:function(e,t){const n=A.resolve("function"==typeof e?ke.ignoreTransaction(e):e).timeout(t||6e4);return N.trans?N.trans.waitFor(n):n},Promise:A,debug:{get:()=>ie,set:e=>{kn(e,"dexie"===e?()=>!0:$n)}},derive:De,extend:X,props:Oe,override:Sn,Events:Xe,on:_e,liveQuery:function qs(e){return new Vs(t=>{const n=Bt(e);let s=!1,i={},o={};const a={get closed(){return s},unsubscribe:()=>{s=!0,_e.storagemutated.unsubscribe(c)}};t.start&&t.start(a);let l=!1,u=!1;function f(){return Y(o).some(m=>i[m]&&function Ls(e,t){const n=bn(t);let r=n.next();if(r.done)return!1;let s=r.value;const i=bn(e);let o=i.next(s.from),a=o.value;for(;!r.done&&!o.done;){if(Q(a.from,s.to)<=0&&Q(a.to,s.from)>=0)return!0;Q(s.from,a.from)<0?s=(r=n.next(a.from)).value:a=(o=i.next(s.from)).value}return!1}(i[m],o[m]))}const c=m=>{ur(i,m),f()&&h()},h=()=>{if(l||s)return;i={};const m={},E=function r(m){n&&Be();const E=()=>ye(e,{subscr:m,trans:null}),v=N.trans?Le(N.transless,E):E();return n&&v.then(he,he),v}(m);u||(_e(et,c),u=!0),l=!0,Promise.resolve(E).then(v=>{l=!1,!s&&(f()?h():(i={},o=m,t.next&&t.next(v)))},v=>{l=!1,t.error&&t.error(v),a.unsubscribe()})};return h(),a})},extendObservabilitySet:ur,getByKeyPath:ce,setByKeyPath:re,delByKeyPath:function vr(e,t){"string"==typeof t?re(e,t,void 0):"length"in t&&[].map.call(t,function(n){re(e,n,void 0)})},shallowClone:xn,deepClone:qe,getObjectDiff:yn,cmp:Q,asap:Cn,minKey:Qt,addons:[],connections:Je,errnames:xr,dependencies:wn,semVer:"3.2.0",version:"3.2.0".split(".").map(e=>parseInt(e)).reduce((e,t,n)=>e+t/Math.pow(10,2*n))}),ke.maxKey=tt(ke.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(_e(et,e=>{if(!me){let t;wt?(t=document.createEvent("CustomEvent"),t.initCustomEvent(we,!0,!0,e)):t=new CustomEvent(we,{detail:e}),me=!0,dispatchEvent(t),me=!1}}),addEventListener(we,({detail:e})=>{me||kt(e)}));let me=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel(we);_e(et,t=>{me||e.postMessage(t)}),e.onmessage=t=>{t.data&&kt(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){_e(et,t=>{try{me||(typeof localStorage<"u"&&localStorage.setItem(we,JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:we,changedParts:t})))}catch{}}),addEventListener("storage",t=>{if(t.key===we){const n=JSON.parse(t.newValue);n&&kt(n.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function js({data:e}){e&&e.type===we&&kt(e.changedParts)})}A.rejectionMapper=function Ar(e,t){if(!e||e instanceof Ne||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Pn[e.name])return e;var n=new Pn[e.name](t||e.message,e);return"stack"in e&&le(n,"stack",{get:function(){return this.inner.stack}}),n},kn(ie,$n);var F=(()=>{return(e=F||(F={}))[e.ArmorSlotNone=0]="ArmorSlotNone",e[e.ArmorSlotHelmet=1]="ArmorSlotHelmet",e[e.ArmorSlotGauntlet=2]="ArmorSlotGauntlet",e[e.ArmorSlotChest=3]="ArmorSlotChest",e[e.ArmorSlotLegs=4]="ArmorSlotLegs",e[e.ArmorSlotClass=5]="ArmorSlotClass",F;var e})(),_=(()=>{return(e=_||(_={}))[e.PowerfulFriends=0]="PowerfulFriends",e[e.RadiantLight=1]="RadiantLight",e[e.ProtectiveLight=100]="ProtectiveLight",e[e.ExtraReserves=101]="ExtraReserves",e[e.PreciselyCharged=102]="PreciselyCharged",e[e.StacksOnStacks=103]="StacksOnStacks",e[e.PrecisionCharge=104]="PrecisionCharge",e[e.SurpriseAttack=105]="SurpriseAttack",e[e.EnergyConverter=106]="EnergyConverter",e[e.ChargeHarvester=107]="ChargeHarvester",e[e.WhisperOfDurance=1e3]="WhisperOfDurance",e[e.WhisperOfChains=1001]="WhisperOfChains",e[e.WhisperOfConduction=1002]="WhisperOfConduction",e[e.WhisperOfShards=1003]="WhisperOfShards",e[e.WhisperOfHedrons=1100]="WhisperOfHedrons",e[e.WhisperOfBonds=1101]="WhisperOfBonds",e[e.WhisperOfHunger=1102]="WhisperOfHunger",e[e.WhisperOfFractures=1103]="WhisperOfFractures",e[e.EchoOfExpulsion=1200]="EchoOfExpulsion",e[e.EchoOfProvision=1201]="EchoOfProvision",e[e.EchoOfPersistence=1202]="EchoOfPersistence",e[e.EchoOfLeeching=1203]="EchoOfLeeching",e[e.EchoOfDomineering=1204]="EchoOfDomineering",e[e.EchoOfDilation=1205]="EchoOfDilation",e[e.EchoOfUndermining=1206]="EchoOfUndermining",e[e.EchoOfInstability=1207]="EchoOfInstability",e[e.EchoOfHarvest=1208]="EchoOfHarvest",e[e.EchoOfObscurity=1209]="EchoOfObscurity",e[e.EchoOfStarvation=1210]="EchoOfStarvation",e[e.EmberOfBenelovence=1300]="EmberOfBenelovence",e[e.EmberOfBeams=1301]="EmberOfBeams",e[e.EmberOfEmpyrean=1302]="EmberOfEmpyrean",e[e.EmberOfCombustion=1303]="EmberOfCombustion",e[e.EmberOfChar=1304]="EmberOfChar",e[e.EmberOfTempering=1305]="EmberOfTempering",e[e.EmberOfEruption=1306]="EmberOfEruption",e[e.EmberOfWonder=1307]="EmberOfWonder",e[e.EmberOfSearing=1308]="EmberOfSearing",e[e.EmberOfTorches=1309]="EmberOfTorches",e[e.SparkOfBrilliance=1400]="SparkOfBrilliance",e[e.SparkOfFeedback=1401]="SparkOfFeedback",e[e.SparkOfDischarge=1402]="SparkOfDischarge",e[e.SparkOfFocus=1403]="SparkOfFocus",e[e.SparkOfVolts=1404]="SparkOfVolts",e[e.SparkOfResistance=1405]="SparkOfResistance",e[e.SparkOfShock=1406]="SparkOfShock",e[e.MobileRetrofit=1500]="MobileRetrofit",e[e.ResilientRetrofit=1501]="ResilientRetrofit",_;var e})(),K=(()=>{return(e=K||(K={}))[e.CombatStyleMod=0]="CombatStyleMod",e[e.Stasis=1]="Stasis",e[e.Void=2]="Void",e[e.Solar=3]="Solar",e[e.Arc=4]="Arc",e[e.Strand=5]="Strand",e[e.RetrofitMods=6]="RetrofitMods",K;var e})(),G=(()=>{return(e=G||(G={}))[e.NONE=0]="NONE",e[e.MINOR_MOBILITY=1]="MINOR_MOBILITY",e[e.MAJOR_MOBILITY=2]="MAJOR_MOBILITY",e[e.ARTIFICER_MOBILITY=3]="ARTIFICER_MOBILITY",e[e.MINOR_RESILIENCE=4]="MINOR_RESILIENCE",e[e.MAJOR_RESILIENCE=5]="MAJOR_RESILIENCE",e[e.ARTIFICER_RESILIENCE=6]="ARTIFICER_RESILIENCE",e[e.MINOR_RECOVERY=7]="MINOR_RECOVERY",e[e.MAJOR_RECOVERY=8]="MAJOR_RECOVERY",e[e.ARTIFICER_RECOVERY=9]="ARTIFICER_RECOVERY",e[e.MINOR_DISCIPLINE=10]="MINOR_DISCIPLINE",e[e.MAJOR_DISCIPLINE=11]="MAJOR_DISCIPLINE",e[e.ARTIFICER_DISCIPLINE=12]="ARTIFICER_DISCIPLINE",e[e.MINOR_INTELLECT=13]="MINOR_INTELLECT",e[e.MAJOR_INTELLECT=14]="MAJOR_INTELLECT",e[e.ARTIFICER_INTELLECT=15]="ARTIFICER_INTELLECT",e[e.MINOR_STRENGTH=16]="MINOR_STRENGTH",e[e.MAJOR_STRENGTH=17]="MAJOR_STRENGTH",e[e.ARTIFICER_STRENGTH=18]="ARTIFICER_STRENGTH",G;var e})(),p=(()=>{return(e=p||(p={}))[e.Mobility=0]="Mobility",e[e.Resilience=1]="Resilience",e[e.Recovery=2]="Recovery",e[e.Discipline=3]="Discipline",e[e.Intellect=4]="Intellect",e[e.Strength=5]="Strength",p;var e})();const te={[G.NONE]:[p.Strength,0,0,0],[G.MINOR_MOBILITY]:[p.Mobility,5,1,204137529],[G.MAJOR_MOBILITY]:[p.Mobility,10,3,3961599962],[G.ARTIFICER_MOBILITY]:[p.Mobility,0,3,0],[G.MINOR_RESILIENCE]:[p.Resilience,5,1,3682186345],[G.MAJOR_RESILIENCE]:[p.Resilience,10,3,2850583378],[G.ARTIFICER_RESILIENCE]:[p.Resilience,0,3,0],[G.MINOR_RECOVERY]:[p.Recovery,5,2,555005975],[G.MAJOR_RECOVERY]:[p.Recovery,10,4,2645858828],[G.ARTIFICER_RECOVERY]:[p.Recovery,0,3,0],[G.MINOR_DISCIPLINE]:[p.Discipline,5,1,2623485440],[G.MAJOR_DISCIPLINE]:[p.Discipline,10,3,4048838440],[G.ARTIFICER_DISCIPLINE]:[p.Discipline,0,3,0],[G.MINOR_INTELLECT]:[p.Intellect,5,2,1227870362],[G.MAJOR_INTELLECT]:[p.Intellect,10,5,3355995799],[G.ARTIFICER_INTELLECT]:[p.Intellect,0,3,0],[G.MINOR_STRENGTH]:[p.Strength,5,1,3699676109],[G.MAJOR_STRENGTH]:[p.Strength,10,3,3253038666],[G.ARTIFICER_STRENGTH]:[p.Strength,0,3,0]};var Te=(()=>{return(e=Te||(Te={}))[e.ClassAbilityRegenerationStat=10]="ClassAbilityRegenerationStat",Te;var e})(),T=(()=>{return(e=T||(T={}))[e.None=0]="None",e[e.SlotNightmare=1]="SlotNightmare",e[e.SlotArtificer=2]="SlotArtificer",e[e.SlotLastWish=3]="SlotLastWish",e[e.SlotGardenOfSalvation=4]="SlotGardenOfSalvation",e[e.SlotDeepStoneCrypt=5]="SlotDeepStoneCrypt",e[e.SlotVaultOfGlass=6]="SlotVaultOfGlass",e[e.PerkIronBanner=7]="PerkIronBanner",e[e.PerkUniformedOfficer=8]="PerkUniformedOfficer",e[e.SlotVowOfTheDisciple=9]="SlotVowOfTheDisciple",e[e.SlotKingsFall=10]="SlotKingsFall",e[e.PerkPlunderersTrappings=11]="PerkPlunderersTrappings",e[e.SeraphSensorArray=12]="SeraphSensorArray",e[e.COUNT=13]="COUNT",T;var e})();const Us={[_.PowerfulFriends]:{id:_.PowerfulFriends,name:"Powerful Friends",description:"When you become Charged with Light, nearby allies also become Charged with Light, if they are not already.",type:K.CombatStyleMod,bonus:[{stat:p.Mobility,value:20}],cost:4,requiredArmorAffinity:0,hash:1484685887},[_.RadiantLight]:{id:_.RadiantLight,name:"Radiant Light",description:"Casting your Super causes nearby allies to become Charged with Light.",type:K.CombatStyleMod,bonus:[{stat:p.Strength,value:20}],cost:3,requiredArmorAffinity:0,hash:2979815167},[_.ProtectiveLight]:{id:_.ProtectiveLight,name:"Protective Light",description:"While Charged with Light, you gain significant damage resistance against combatants when your shields are destroyed. This effect consumes all stacks of Charged with Light. The more stacks consumed, the longer the damage resistance lasts.",type:K.CombatStyleMod,bonus:[{stat:p.Strength,value:-10}],cost:2,requiredArmorAffinity:0,hash:3523075120},[_.ExtraReserves]:{id:_.ExtraReserves,name:"Extra Reserves",description:"While Charged with Light, defeating combatants with Void damage grants a chance to drop Special ammo. This effect consumes all stacks of Charged with Light. The more stacks you have, the higher your chance of gaining the ammo drop.",type:K.CombatStyleMod,bonus:[{stat:p.Intellect,value:-10}],cost:3,requiredArmorAffinity:0,hash:3523075121},[_.PreciselyCharged]:{id:_.PreciselyCharged,name:"Precisely Charged",description:"Become Charged with Light by getting multiple rapid precision final blows with Linear Fusion Rifles or Sniper Rifles.",type:K.CombatStyleMod,bonus:[{stat:p.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:3523075122},[_.StacksOnStacks]:{id:_.StacksOnStacks,name:"Stacks on Stacks",description:"Gain an extra stack of Charged with Light for every stack you gain.",type:K.CombatStyleMod,bonus:[{stat:p.Recovery,value:-10}],cost:4,requiredArmorAffinity:0,hash:3523075123},[_.PrecisionCharge]:{id:_.PrecisionCharge,name:"Precision Charge",description:"Become Charged with Light by rapidly defeating combatants with precision kills from Bows, Hand Cannons, and Scout Rifles.",type:K.CombatStyleMod,bonus:[{stat:p.Strength,value:-10}],cost:2,requiredArmorAffinity:0,hash:2263321584},[_.SurpriseAttack]:{id:_.SurpriseAttack,name:"Surprise Attack",description:"While Charged with Light, reloading or readying a Sidearm will consume all stacks of Charged with Light and convert them into stacks of a major damage buff, which are depleted as you damage combatants with that Sidearm.",type:K.CombatStyleMod,bonus:[{stat:p.Intellect,value:-10}],cost:1,requiredArmorAffinity:0,hash:2263321585},[_.EnergyConverter]:{id:_.EnergyConverter,name:"Energy Converter",description:"While Charged with Light, using your grenade attack grants you Super energy, consuming all stacks of Charged with Light. The more stacks you have, the more energy you gain, up to a maximum of 50% of your Super energy.",type:K.CombatStyleMod,bonus:[{stat:p.Discipline,value:-10}],cost:4,requiredArmorAffinity:0,hash:2263321586},[_.ChargeHarvester]:{id:_.ChargeHarvester,name:"Charge Harvester",description:"While you are not Charged with Light, any kill or assist has a small cumulative chance to cause you to become Charged with Light.",type:K.CombatStyleMod,bonus:[{stat:Te.ClassAbilityRegenerationStat,value:-10}],cost:3,requiredArmorAffinity:0,hash:2263321587},[_.WhisperOfDurance]:{id:_.WhisperOfDurance,name:"Whisper Of Durance",description:"Slow from your abilities lasts longer. For those abilities that linger, their duration will also increase.",type:K.Stasis,bonus:[{stat:p.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:3469412969},[_.WhisperOfChains]:{id:_.WhisperOfChains,name:"Whisper Of Chains",description:"While you are near frozen targets or a friendly Stasis crystal, you take reduced damage from targets.",type:K.Stasis,bonus:[{stat:p.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:537774540},[_.WhisperOfShards]:{id:_.WhisperOfShards,name:"Whisper Of Shards",description:"Shattering a Stasis crystal temporarily boosts your grenade recharge rate. Shattering additional Stasis crystals increases the duration of this benefit.",type:K.Stasis,bonus:[{stat:p.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:3469412975},[_.WhisperOfConduction]:{id:_.WhisperOfConduction,name:"Whisper Of Conduction",description:"Nearby Stasis shards track to your position.",type:K.Stasis,bonus:[{stat:p.Resilience,value:10},{stat:p.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2483898429},[_.WhisperOfBonds]:{id:_.WhisperOfBonds,name:"Whisper of Bonds",description:"Defeating frozen targets grants you Super energy.",type:K.Stasis,bonus:[{stat:p.Discipline,value:-10},{stat:p.Intellect,value:-10}],cost:1,requiredArmorAffinity:0,hash:3469412974},[_.WhisperOfHedrons]:{id:_.WhisperOfHedrons,name:"Whisper of Hedrons",description:"Dramatically increases weapon stability, weapon aim assist, Mobility, Resilience, and Recovery after freezing a target with Stasis.",type:K.Stasis,bonus:[{stat:p.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:3469412970},[_.WhisperOfFractures]:{id:_.WhisperOfFractures,name:"Whisper of Fractures",description:"Your melee energy recharges faster when you are near two or more targets.",type:K.Stasis,bonus:[{stat:p.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:537774542},[_.WhisperOfHunger]:{id:_.WhisperOfHunger,name:"Whisper of Hunger",description:"Increases the melee energy gained from picking up Stasis shards.",type:K.Stasis,bonus:[{stat:p.Mobility,value:-10},{stat:p.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:2483898431},[_.EchoOfExpulsion]:{id:_.EchoOfExpulsion,name:"Echo of Expulsion",description:"Void ability final blows cause targets to explode.",type:K.Void,bonus:[{stat:p.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984665},[_.EchoOfProvision]:{id:_.EchoOfProvision,name:"Echo of Provision",description:"Damaging targets with grenades grants melee energy.",type:K.Void,bonus:[{stat:p.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:2272984664},[_.EchoOfPersistence]:{id:_.EchoOfPersistence,name:"Echo of Persistence",description:"Void buffs applied to you (Invisibility, Overshield, and Devour) have increased duration.",type:K.Void,bonus:[{stat:Te.ClassAbilityRegenerationStat,value:-10}],cost:1,requiredArmorAffinity:0,hash:2272984671},[_.EchoOfLeeching]:{id:_.EchoOfLeeching,name:"Echo of Leeching",description:"Melee final blows start health regeneration for you and nearby allies.",type:K.Void,bonus:[{stat:p.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984670},[_.EchoOfDomineering]:{id:_.EchoOfDomineering,name:"Echo of Domineering",description:"After suppressing a target, you gain greatly increased Mobility for a short duration and your equipped weapon is reloaded from reserves.",type:K.Void,bonus:[{stat:p.Discipline,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984657},[_.EchoOfDilation]:{id:_.EchoOfDilation,name:"Echo of Dilation",description:"While crouched, you sneak faster and gain enhanced radar resolution.",type:K.Void,bonus:[{stat:p.Mobility,value:10},{stat:p.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984656},[_.EchoOfUndermining]:{id:_.EchoOfUndermining,name:"Echo of Undermining",description:"Your Void grenades weaken targets.",type:K.Void,bonus:[{stat:p.Discipline,value:-20}],cost:1,requiredArmorAffinity:0,hash:2272984668},[_.EchoOfInstability]:{id:_.EchoOfInstability,name:"Echo of Instability",description:"Defeating targets with grenades grants Volatile Rounds to your Void weapons.",type:K.Void,bonus:[{stat:p.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:2661180600},[_.EchoOfObscurity]:{id:_.EchoOfObscurity,name:"Echo of Obscurity",description:"Finisher final blows grant Invisibility.",type:K.Void,bonus:[{stat:p.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:2661180602},[_.EchoOfHarvest]:{id:_.EchoOfHarvest,name:"Echo of Harvest",description:"Defeating weakened targets with precision final blows will create an Orb of Power.",type:K.Void,bonus:[{stat:p.Intellect,value:-10}],cost:1,requiredArmorAffinity:0,hash:2661180601},[_.EchoOfStarvation]:{id:_.EchoOfStarvation,name:"Echo of Starvation",description:"Picking up an Orb of Power grants Devour.",type:K.Void,bonus:[{stat:p.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:2661180603},[_.EmberOfBenelovence]:{id:_.EmberOfBenelovence,name:"Ember of Benelovence",description:"Applying restoration, cure, or radiant to allies grants increased grenade, melee, and class ability regeneration for a short duration.",type:K.Solar,bonus:[{stat:p.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132292},[_.EmberOfBeams]:{id:_.EmberOfBeams,name:"Ember of Beams",description:"Your Solar Super projectiles have stronger target acquisition.",type:K.Solar,bonus:[{stat:p.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:362132295},[_.EmberOfEmpyrean]:{id:_.EmberOfEmpyrean,name:"Ember of Empyrean",description:"Solar weapon or ability final blows extend the duration of restoration and radiant effects applied to you.",type:K.Solar,bonus:[{stat:p.Resilience,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132294},[_.EmberOfCombustion]:{id:_.EmberOfCombustion,name:"Ember of Combustion",description:"Final blows with your Solar Super cause targets to ignite.",type:K.Solar,bonus:[{stat:p.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:362132289},[_.EmberOfChar]:{id:_.EmberOfChar,name:"Ember of Char",description:"Your Solar ignitions spread scorch to affected targets.",type:K.Solar,bonus:[{stat:p.Discipline,value:10}],cost:1,requiredArmorAffinity:0,hash:362132291},[_.EmberOfTempering]:{id:_.EmberOfTempering,name:"Ember of Tempering",description:"Solar weapon final blows grant you and your allies increased recovery for a short duration. Stacks 3 times.\nWhile Ember of Tempering is active, your weapons have increased airborne effectiveness.",type:K.Solar,bonus:[{stat:p.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132290},[_.EmberOfEruption]:{id:_.EmberOfEruption,name:"Ember of Eruption",description:"Your Solar ignitions have increased area of effect.",type:K.Solar,bonus:[{stat:p.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276348},[_.EmberOfWonder]:{id:_.EmberOfWonder,name:"Ember of Wonder",description:"Rapidly defeating multiple targets with Solar ignitions generates an Orb of Power.",type:K.Solar,bonus:[{stat:p.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276350},[_.EmberOfSearing]:{id:_.EmberOfSearing,name:"Ember of Searing",description:"Defeating scorched targets grants melee energy.",type:K.Solar,bonus:[{stat:p.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276351},[_.EmberOfTorches]:{id:_.EmberOfTorches,name:"Ember of Torches",description:"Powered melee attacks against combatants make you and nearby allies radiant.",type:K.Solar,bonus:[{stat:p.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132288},[_.SparkOfBrilliance]:{id:_.SparkOfBrilliance,name:"Spark of Brilliance",description:"Defeating a blinded target with precision damage creates a blinding explosion.",type:K.Arc,bonus:[{stat:p.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:3277705905},[_.SparkOfFeedback]:{id:_.SparkOfFeedback,name:"Spark of Feedback",description:"Taking melee damage briefly increases your outgoing melee damage.",type:K.Arc,bonus:[{stat:p.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:3277705907},[_.SparkOfDischarge]:{id:_.SparkOfDischarge,name:"Spark of Discharge",description:"Arc weapon final blows have a chance to create an Ionic Trace.",type:K.Arc,bonus:[{stat:p.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:1727069362},[_.SparkOfFocus]:{id:_.SparkOfFocus,name:"Spark of Focus",description:"After sprinting for a short time, your class ability regeneration is increased.",type:K.Arc,bonus:[{stat:Te.ClassAbilityRegenerationStat,value:-10}],cost:1,requiredArmorAffinity:0,hash:1727069360},[_.SparkOfVolts]:{id:_.SparkOfVolts,name:"Spark of Volts",description:"Finishers make you amplified.",type:K.Arc,bonus:[{stat:p.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:3277705904},[_.SparkOfResistance]:{id:_.SparkOfResistance,name:"Spark of Resistance",description:"While surrounded by combatants, you are more resistant to incoming damage.",type:K.Arc,bonus:[{stat:p.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:1727069366},[_.SparkOfShock]:{id:_.SparkOfShock,name:"Spark of Shock",description:"Your Arc grenades jolt targets.",type:K.Arc,bonus:[{stat:p.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:1727069364},[_.MobileRetrofit]:{id:_.MobileRetrofit,name:"Mobile Retrofit",description:"Adds a constant boost of +5 to your mobility.",type:K.RetrofitMods,bonus:[{stat:p.Mobility,value:5}],cost:3,requiredArmorAffinity:0,hash:4058375012},[_.ResilientRetrofit]:{id:_.ResilientRetrofit,name:"Resilient Retrofit",description:"Adds a constant boost of +5 to your resilience.",type:K.RetrofitMods,bonus:[{stat:p.Resilience,value:5}],cost:4,requiredArmorAffinity:0,hash:2092805627}};Array.prototype.addSorted=function(e){var r,t=0,n=this.length,s=!1;if(e>this[n])return this.push(e),this;if(e<this[t])return this.splice(t,0,e),this;for(;0==s;)e>this[r=~~((t+n)/2)]?t=r:n=r,n-t<=1&&(this.splice(n,0,e),s=!0);return this},Array.prototype.where=Array.prototype.where||function(e){for(var t=[],n=this.length,r=0;r<n;r++){var s=this[r];e(s)&&t.push(s)}return t};const fr=function Hs(e){const t=new Ae("d2armorpicker-v2");return t.version(19).stores({manifestArmor:"id++, hash, isExotic",inventoryArmor:"id++, itemInstanceId, isExotic, hash, name, masterworked, clazz, slot"}).upgrade(function(){var n=it(function*(r){yield e()});return function(r){return n.apply(this,arguments)}}()),t}(it(function*(){})),Gs=fr.table("inventoryArmor"),Ys=fr.table("manifestArmor");class Tt{constructor(t){this.items=[],this.mobility={min:0,max:0,sum:0},this.resilience={min:0,max:0,sum:0},this.recovery={min:0,max:0,sum:0},this.discipline={min:0,max:0,sum:0},this.intellect={min:0,max:0,sum:0},this.strength={min:0,max:0,sum:0},this.containsExotics=!1,this.containsLegendaries=!1,this.allMasterworked=!1,this.perks=[],this.allSameElement=!0,this.items=t;const n=this.items.map(l=>l.mobility),r=this.items.map(l=>l.resilience),s=this.items.map(l=>l.recovery),i=this.items.map(l=>l.discipline),o=this.items.map(l=>l.intellect),a=this.items.map(l=>l.strength);this.mobility.min=Math.min(...n),this.mobility.sum=n.reduce((l,u)=>l+u,0),this.resilience.min=Math.min(...r),this.resilience.sum=r.reduce((l,u)=>l+u,0),this.recovery.min=Math.min(...s),this.recovery.sum=s.reduce((l,u)=>l+u,0),this.discipline.min=Math.min(...i),this.discipline.sum=i.reduce((l,u)=>l+u,0),this.intellect.min=Math.min(...o),this.intellect.sum=o.reduce((l,u)=>l+u,0),this.strength.min=Math.min(...a),this.strength.sum=a.reduce((l,u)=>l+u,0),this.containsExotics=this._containsExotics,this.containsLegendaries=this._containsLegendaries,this.allMasterworked=this._allMasterworked,this.perks=t.map(l=>l.perk),this.allSameElement=1==new Set(t).size}get _containsExotics(){return this.items.filter(t=>t.isExotic).length>0}get _containsLegendaries(){return this.items.filter(t=>!t.isExotic).length>0}get _allMasterworked(){return this.items.filter(t=>t.masterworked).length==this.items.length}}function zs(e,t,n,r,s,i,o){var a=e.selectedExotics[0]||0;let l=t.slice();if((a<=0||r.items[0].hash!=a)&&e.armorPerks[F.ArmorSlotHelmet].fixed&&e.armorPerks[F.ArmorSlotHelmet].value!=T.None&&e.armorPerks[F.ArmorSlotHelmet].value!=r.perks[0])return{valid:!1};if((a<=0||s.items[0].hash!=a)&&e.armorPerks[F.ArmorSlotGauntlet].fixed&&e.armorPerks[F.ArmorSlotGauntlet].value!=T.None&&e.armorPerks[F.ArmorSlotGauntlet].value!=s.perks[0])return{valid:!1};if((a<=0||i.items[0].hash!=a)&&e.armorPerks[F.ArmorSlotChest].fixed&&e.armorPerks[F.ArmorSlotChest].value!=T.None&&e.armorPerks[F.ArmorSlotChest].value!=i.perks[0])return{valid:!1};if((a<=0||o.items[0].hash!=a)&&e.armorPerks[F.ArmorSlotLegs].fixed&&e.armorPerks[F.ArmorSlotLegs].value!=T.None&&e.armorPerks[F.ArmorSlotLegs].value!=o.perks[0])return{valid:!1};if(e.armorPerks[F.ArmorSlotClass].fixed&&e.armorPerks[F.ArmorSlotClass].value!=T.None&&!n.has(e.armorPerks[F.ArmorSlotClass].value))return{valid:!1};l[r.perks[0]]--,l[s.perks[0]]--,l[i.perks[0]]--,l[o.perks[0]]--,a>0&&(r.items[0].hash==a?l[e.armorPerks[r.items[0].slot].value]--:s.items[0].hash==a?l[e.armorPerks[s.items[0].slot].value]--:i.items[0].hash==a?l[e.armorPerks[i.items[0].slot].value]--:o.items[0].hash==a&&l[e.armorPerks[o.items[0].slot].value]--);let u=0;for(let h=1;h<T.COUNT;h++)u+=Math.max(0,l[h]);var f=T.None;if(1==u){var c=!1;for(let h=1;h<T.COUNT&&!c;h++)l[h]<=0||n.has(h)&&(c=!0,f=h);c&&u--}else f==T.None&&e.armorPerks[F.ArmorSlotClass].fixed&&(f=e.armorPerks[F.ArmorSlotClass].value);return{valid:u<=0,requiredClassItemType:f}}addEventListener("message",function(){var e=it(function*({data:t}){const n=Date.now();console.debug("START RESULTS BUILDER 2"),console.time("total");const r=t.config;console.log("Using config",t.config);let s=yield Promise.all(r.selectedExotics.filter(d=>-1!=d).map(function(){var d=it(function*(y){return yield Ys.where("hash").equals(y).first()});return function(y){return d.apply(this,arguments)}}()));s=s.filter(d=>!!d);let i=yield Gs.where("clazz").equals(r.characterClass).distinct().toArray();i=i.filter(d=>d.slot!=F.ArmorSlotNone).filter(d=>-1==r.disabledItems.indexOf(d.itemInstanceId)).filter(d=>-1==r.selectedExotics.indexOf(-1)||!d.isExotic).filter(d=>1!=s.length||s[0].slot!=d.slot||s[0].hash==d.hash).filter(d=>!r.onlyUseMasterworkedItems||d.masterworked).filter(d=>r.allowBlueArmorPieces||6==d.rarity||5==d.rarity).filter(d=>!r.ignoreSunsetArmor||!d.isSunset).filter(d=>d.isExotic||!r.armorPerks[d.slot].fixed||r.armorPerks[d.slot].value==T.None||r.armorPerks[d.slot].value==d.perk);let o=i.filter(d=>d.slot==F.ArmorSlotHelmet).filter(d=>!r.useFotlArmor||[199733460,2545426109,3224066584].indexOf(d.hash)>-1).map(d=>new Tt([d])),a=i.filter(d=>d.slot==F.ArmorSlotGauntlet).map(d=>new Tt([d])),l=i.filter(d=>d.slot==F.ArmorSlotChest).map(d=>new Tt([d])),u=i.filter(d=>d.slot==F.ArmorSlotLegs).map(d=>new Tt([d]));const f=t.threadSplit;if(f.count>1){var c=[[o,o.length],[a,a.length],[l,l.length],[u,u.length]].sort((d,y)=>d[1]-y[1])[0][0],h=Math.floor(c.length/f.count),m=h*f.current,E=h*(f.current+1);h*f.count!=c.length&&f.current==f.count-1&&(E+=c.length-h*f.count),c.splice(E),c.splice(0,m)}let v=i.filter(d=>d.slot==F.ArmorSlotClass),S=new Set(v.map(d=>d.perk));console.debug("items",JSON.stringify({helmets:o.length,gauntlets:a.length,chests:l.length,legs:u.length,availableClassItemTypes:S}));const g={maximumPossibleTiers:[0,0,0,0,0,0],statCombo3x100:new Set,statCombo4x100:new Set},R=function $s(e){const t=[0,0,0,0,0,0];for(const r of e.enabledMods)for(const s of Us[r].bonus)t[s.stat==Te.ClassAbilityRegenerationStat?[1,0,2][e.characterClass]:s.stat]+=s.value;return t}(r),x=function Js(e){let t=[];for(let n=0;n<T.COUNT;n++)t.push(0);return t[e.armorPerks[F.ArmorSlotHelmet].value]++,t[e.armorPerks[F.ArmorSlotChest].value]++,t[e.armorPerks[F.ArmorSlotGauntlet].value]++,t[e.armorPerks[F.ArmorSlotLegs].value]++,t[e.armorPerks[F.ArmorSlotClass].value]++,t}(r),w=function Xs(e){var t=[];return t.push(e.maximumModSlots[F.ArmorSlotHelmet].value),t.push(e.maximumModSlots[F.ArmorSlotGauntlet].value),t.push(e.maximumModSlots[F.ArmorSlotChest].value),t.push(e.maximumModSlots[F.ArmorSlotLegs].value),t.push(e.maximumModSlots[F.ArmorSlotClass].value),t.where(n=>n>0).sort()}(r),I=s.length<=1;let C=[],k=0,D=0,M=0,W=!1;console.time("tm");for(let d of o)for(let y of a)if(!(I&&d.containsExotics&&y.containsExotics))for(let b of l)if(!I||!d.containsExotics&&!y.containsExotics||!b.containsExotics)for(let O of u){if(I&&(d.containsExotics||y.containsExotics||b.containsExotics)&&O.containsExotics||!zs(r,x,S,d,y,b,O).valid)continue;const P=ei(g,r,d,y,b,O,R,w.slice(),W);null!=P&&(M++,"DONOTSEND"!==P&&(P.classItem={perk:T.SlotArtificer},C.push(P),k++,D++,W=W||r.limitParsedResults&&D>=5e4/f.count||D>=1e6/f.count)),k>=5e3&&(postMessage({runtime:g,results:C,done:!1,total:0}),C=[],k=0)}console.timeEnd("tm"),console.timeEnd("total"),postMessage({runtime:g,results:C,done:!0,stats:{permutationCount:M,itemCount:i.length-v.length,totalTime:Date.now()-n}})});return function(t){return e.apply(this,arguments)}}());class Zs{constructor(t){this.list=[],this.comparatorList=[],this.length=0,this.comparator=t}insert(t){let r,n=this.comparator(t);for(r=0;r<this.list.length&&this.comparatorList[r]>n;r++);this.length++,this.list.splice(r,0,t),this.comparatorList.splice(r,0,n)}remove(t){let n=-1;for(let r=0;r<this.list.length;r++)if(this.list[r]==t){n=r;break}-1!=n&&(this.list.splice(n,1),this.comparatorList.splice(n,1),this.length--)}}function ei(e,t,n,r,s,i,o,a,l=!1){const u=[n,r,s,i];var f=t.assumeClassItemMasterworked?2:0;for(let d=0;d<u.length;d++){let y=u[d];(y.allMasterworked||y.containsExotics&&!y.containsLegendaries&&t.assumeExoticsMasterworked||!y.containsExotics&&y.containsLegendaries&&t.assumeLegendariesMasterworked||y.containsExotics&&y.containsLegendaries&&t.assumeLegendariesMasterworked&&t.assumeExoticsMasterworked)&&(f+=2)}const c=function Qs(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].items.length>1?1:0;if(t<=1)return[e[0].mobility.min+e[1].mobility.min+e[2].mobility.min+e[3].mobility.min,e[0].resilience.min+e[1].resilience.min+e[2].resilience.min+e[3].resilience.min,e[0].recovery.min+e[1].recovery.min+e[2].recovery.min+e[3].recovery.min,e[0].discipline.min+e[1].discipline.min+e[2].discipline.min+e[3].discipline.min,e[0].intellect.min+e[1].intellect.min+e[2].intellect.min+e[3].intellect.min,e[0].strength.min+e[1].strength.min+e[2].strength.min+e[3].strength.min];{let n=e.filter(s=>1==s.items.length),r=e.filter(s=>s.items.length>1).reduce((s,i)=>(s[0]=i.mobility.sum<s[0]?i.mobility.sum:s[0],s[1]=i.resilience.sum<s[1]?i.resilience.sum:s[1],s[2]=i.recovery.sum<s[2]?i.recovery.sum:s[2],s[3]=i.discipline.sum<s[3]?i.discipline.sum:s[3],s[4]=i.intellect.sum<s[4]?i.intellect.sum:s[4],s[5]=i.strength.sum<s[5]?i.strength.sum:s[5],s),[200,200,200,200,200,200]);for(let s of n)r[0]+=s.mobility.min,r[1]+=s.resilience.min,r[2]+=s.recovery.min,r[3]+=s.discipline.min,r[4]+=s.intellect.min,r[5]+=s.strength.min;return r}}(u);c[0]+=f,c[1]+=f+(!u[2].containsExotics&&t.addConstent1Resilience?1:0),c[2]+=f,c[3]+=f,c[4]+=f,c[5]+=f;const h=[c[0],c[1],c[2],c[3],c[4],c[5]];c[0]+=o[0],c[1]+=o[1],c[2]+=o[2],c[3]+=o[3],c[4]+=o[4],c[5]+=o[5];for(let d=0;d<6;d++)if(t.minimumStatTiers[d].fixed&&c[d]/10>=t.minimumStatTiers[d].value+1)return null;let m=u.filter(d=>d.perks.indexOf(T.SlotArtificer)>-1).length;m+=1;const E=[Math.ceil(Math.max(0,t.minimumStatTiers[0].value-c[0]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[1].value-c[1]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[2].value-c[2]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[3].value-c[3]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[4].value-c[4]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[5].value-c[5]/10))],v=E[0]+E[1]+E[2]+E[3]+E[4]+E[5],S=new Zs(d=>te[d][2]),g=[];let R=a.length;if(v>0){for(let y=0;y<6;y++){if(0==E[y])continue;const b=c[y]%10;b>0&&b%10>=5&&(S.insert(1+3*y),E[y]--,c[y]+=5);for(let O=0;O<E[y];O++)S.insert(2+3*y),c[y]+=10}let d=!0;for(;d;){d=!1;for(let y=0;y<S.length&&S.length<=5;y++){const b=S.list[y],O=te[b][2],L=a.where(P=>P>=O);if(0==L.length){if(b%3!=2)return null;{S.remove(b);let P=b-1;S.insert(P),S.insert(P),y--,d=!0}}else a.splice(a.indexOf(L[0]),1),R--}for(let y=0;y<S.length&&0<m;y++){const b=S.list[y];if(b%3==1){const O=te[b][0],L=c[O]%10;(2==L||3==L)&&(S.remove(b),g.push(3+3*O),m--,c[O]-=2,y--,d=!0)}else if(b%3==2){const O=te[b][0],L=c[O]%10;4==L&&m>1?(S.remove(b),g.push(3+3*O),g.push(3+3*O),m-=2,c[O]-=4,y--,d=!0):(3==L||2==L||1==L)&&m>2&&(S.remove(b),g.push(3+3*O),g.push(3+3*O),g.push(3+3*O),m-=3,c[O]-=1,y--,d=!0)}}}}if(S.length>5)return null;if(t.onlyShowResultsWithNoWastedStats){if(c.where(b=>b>100).length>0||c.where(b=>b%5!=0).length>0)return null;let d=[c[p.Mobility],c[p.Resilience],c[p.Recovery],c[p.Discipline],c[p.Intellect],c[p.Strength]].map((b,O)=>[b%10,O,b]).sort((b,O)=>O[0]-b[0]);for(let b=R-1;b>=0;b--){let O=d.where(P=>a.filter(j=>j>=te[1+3*P[1]][2]).length>0).where(P=>P[0]>=5&&P[2]<100).sort((P,j)=>P[0]-j[0])[0];if(!O)break;const L=a.where(P=>P>=te[1+3*O[1]][2])[0];a.splice(a.indexOf(L),1),R--,c[O[1]]+=5,O[0]-=5,S.insert(1+2*O[1])}if(dr(c)>0)return null}if(S.length>5)return null;const x=3*m,w=10*R+x,I=100-w,C=[];for(let d=0;d<6;d++){let y=c[d];if(y>=I&&C.push([d,100-y]),y+w>=e.maximumPossibleTiers[d]){let b=te[1+3*d][2],O=te[2+3*d][2];for(let L=0;L<R&&y<100;L++)a[L]>=O&&(y+=10),a[L]>=b&&a[L]<O&&(y+=5);y+=x,y>e.maximumPossibleTiers[d]&&(e.maximumPossibleTiers[d]=y)}}if(R>0&&C.length>=3){C.sort((y,b)=>y[1]-b[1]);const d=[];for(let y=0;y<C.length-2;y++){let b=~~((Math.max(0,C[y][1],0)+9)/10);if(b>R)break;for(let O=y+1;O<C.length-1;O++){let L=~~((Math.max(0,C[O][1],0)+9)/10);if(b+L>R)break;for(let P=O+1;P<C.length;P++){let j=~~((Math.max(0,C[P][1],0)+9)/10);if(b+L+j>R)break;var k=!1;for(let V=P+1;V<C.length&&!(b+L+j+~~((Math.max(0,C[V][1],0)+9)/10)>R);V++)d.push([C[y],C[O],C[P],C[V]]),k=!0;k||d.push([C[y],C[O],C[P]])}}}for(let y of d){var D=[0,0,0,0,0,0];let b=0;for(let P=0;P<y.length;P++){if(y[P][1]<=0)continue;const j=y[P],V=j[0];let se=te[1+3*V][2],Z=te[2+3*V][2];const ae=Math.max(0,j[1]);let pe=~~(ae/10),st=ae%10;st>5?pe++:st>0&&(D[se]++,b++);for(let Ot=0;Ot<pe;Ot++)D[Z]++,b++}const O=[0,0,0,1,2,2],L=[!1,!1,!1,!1,!1];if(!(b>R)){for(let P=5;P>=3;P--){let j=D[P];if(0==j)continue;let V=a.map((Z,ae)=>[Z,ae]).filter(([Z,ae])=>!L[ae]&&Z>=P),se=j;for(let Z=0;Z<se&&Z<V.length;Z++)L[V[Z][1]]=!0,j--;for(let Z=0;Z<j;Z++)D[P]--,D[O[P]]+=2,b++;if(b>R)break}b<=R&&(e.statCombo3x100.add((1<<y[0][0])+(1<<y[1][0])+(1<<y[2][0])),y.length>3&&e.statCombo4x100.add((1<<y[0][0])+(1<<y[1][0])+(1<<y[2][0])+(1<<y[3][0])))}}}if(l)return"DONOTSEND";if(t.tryLimitWastedStats&&R>0){let d=[c[p.Mobility],c[p.Resilience],c[p.Recovery],c[p.Discipline],c[p.Intellect],c[p.Strength]].map((y,b)=>[y%10,b,y]).sort((y,b)=>b[0]-y[0]);for(let y=0;y<R;y++){let b=d.where(L=>a.where(P=>P>=te[1+3*L[1]][2]).length>0).filter(L=>L[0]>=5&&L[2]<100).sort((L,P)=>L[0]-P[0])[0];if(!b)break;if(t.minimumStatTiers[b[1]].fixed&&(c[b[1]]+5)/10>=t.minimumStatTiers[b[1]].value+1){b[0]-=5;continue}const O=a.where(L=>L>=te[1+3*b[1]][2])[0];a.splice(a.indexOf(O),1),R--,c[b[1]]+=5,b[0]-=5,S.insert(1+2*b[1])}}const M=dr(c);if(t.onlyShowResultsWithNoWastedStats&&M>0)return null;const W=n.containsExotics?n:r.containsExotics?r:s.containsExotics?s:i.containsExotics?i:null;return{exotic:null==W?[]:[{icon:W?.items[0].icon,watermark:W?.items[0].watermarkIcon,name:W?.items[0].name,hash:W?.items[0].hash}],artificer:g,modCount:S.length,modCost:S.list.reduce((d,y)=>d+te[y][2],0),mods:S.list,stats:c,statsNoMods:h,tiers:ti(c),waste:M,items:u.map(d=>d.items).flat().reduce((d,y)=>(d[y.slot-1].push({energyLevel:y.energyLevel,hash:y.hash,itemInstanceId:y.itemInstanceId,name:y.name,exotic:!!y.isExotic,masterworked:y.masterworked,mayBeBugged:y.mayBeBugged,slot:y.slot,perk:y.perk,transferState:0,stats:[y.mobility,y.resilience,y.recovery,y.discipline,y.intellect,y.strength]}),d),[[],[],[],[]])}}function ti(e){return Math.floor(Math.min(100,e[p.Mobility])/10)+Math.floor(Math.min(100,e[p.Resilience])/10)+Math.floor(Math.min(100,e[p.Recovery])/10)+Math.floor(Math.min(100,e[p.Discipline])/10)+Math.floor(Math.min(100,e[p.Intellect])/10)+Math.floor(Math.min(100,e[p.Strength])/10)}function dr(e){return(e[p.Mobility]>100?e[p.Mobility]-100:e[p.Mobility]%10)+(e[p.Resilience]>100?e[p.Resilience]-100:e[p.Resilience]%10)+(e[p.Recovery]>100?e[p.Recovery]-100:e[p.Recovery]%10)+(e[p.Discipline]>100?e[p.Discipline]-100:e[p.Discipline]%10)+(e[p.Intellect]>100?e[p.Intellect]-100:e[p.Intellect]%10)+(e[p.Strength]>100?e[p.Strength]-100:e[p.Strength]%10)}})();